--2016-06-21开始使用
--修复范围：2016-06-12~~~2016-07-26


--********************************************
--SDE
--********************************************
--1.修改BBG_RA_ITEM_LOC_SOH_V的日期为重导日期
SELECT * FROM RA_RMS.BBG_RA_ITEM_LOC_SOH_V;

SELECT * FROM RADM.BBG_RA_SLS_TRX_JL_FIX_V

--2.BBG_XTERN_RDWT
TRUNCATE TABLE RA_RMS.BBG_XTERN_RDWT;
INSERT /*+PARALLEL(32)*/
INTO RA_RMS.BBG_XTERN_RDWT
  SELECT /*+PARALLEL(32)*/
   *
    FROM RA_RMS.BBG_XTERN_RDWT_HIST
   WHERE BUSINESS_DT = 20160612;
COMMIT;

--3.清除日志
TRUNCATE TABLE RA_RMS.C_LOAD_DATES;

--4.备份W_RTL_SLS_TRX_IT_LC_DY_FS
SELECT /*+PARALLEL(32)*/ DAY_DT,COUNT(1) FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS GROUP BY DAY_DT;

INSERT /*+PARALLEL(32)*/
INTO RADM.W_RTL_SLS_TRX_IT_LC_DY_FS_BAK
  SELECT /*+PARALLEL(32)*/
   *
    FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS;

--********************************************
--SIL
--********************************************
--2016.6.21~2016.7.26
--DELETE
ALTER SESSION ENABLE PARALLEL DML;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160621000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160622000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160623000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160624000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160625000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160626000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160627000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160628000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160629000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160630000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160701000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160702000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160703000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160704000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160705000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160706000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160707000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160708000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160709000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160710000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160711000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160712000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160713000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160714000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160715000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160716000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160717000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160718000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160719000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160720000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160721000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160722000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160723000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160724000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160725000;
COMMIT;
DELETE /*+PARALLEL(4)*/
RADM.W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID = 120160726000;
COMMIT;
ALTER SESSION DISABLE PARALLEL DML;

--INSERT
--1.
TRUNCATE TABLE RADM.W_RTL_SLS_TRX_IT_LC_DY_FS;
TRUNCATE TABLE RADM.C_LOAD_DATES;

INSERT /*+PARALLEL(16)*/
INTO RADM.W_RTL_SLS_TRX_IT_LC_DY_FS T
  SELECT /*+PARALLEL(16)*/
   *
    FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS_BAK S
   WHERE S.DAY_DT BETWEEN DATE '2016-06-21' AND DATE '2016-06-30';
COMMIT;

--2.备份
INSERT /*+PARALLEL(16)*/
INTO RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP_BK
  SELECT /*+PARALLEL(16)*/
   *
    FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP;
COMMIT;


--********************************************
--SIL
--********************************************
--2016.6.21~2016.7.26
begin
  -- Call the procedure
  jin_pkg.p_del_sls_agg(120160621000);
end;

















--TMP
  SELECT /*+PARALLEL(8)*/
   COUNT(1)
    FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS_BAK S
   WHERE S.DAY_DT BETWEEN DATE '2016-06-21' AND DATE '2016-06-30';
