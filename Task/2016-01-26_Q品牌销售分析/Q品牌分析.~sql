--1.Q品牌定义：UDA_ID=902,W_RTL_ITEM_GRP1_D.FLEX_ATTRIB_1_CHAR=902
SELECT /*+PARALLEL(16)*/
DISTINCT A.DT_WID, A.ORG_WID, A.SLS_TRX_ID, A.HYK_NO
  FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_F A
 WHERE A.DT_WID BETWEEN 120150101000 AND 120151231000
   AND EXISTS (SELECT /*+PARALLEL(16)*/
         1
          FROM RADM.W_RTL_ITEM_GRP1_D B
         WHERE A.PROD_WID = B.PROD_WID
           AND B.FLEX_ATTRIB_1_CHAR = 902);

--2.全司统计
SELECT /*+PARALLEL(16)*/
 SUBSTR(C.DT_WID, 2, 6) MONTH,
 COUNT(C.SLS_TRX_ID) ALL_TRX,
 COUNT(CASE
         WHEN C.HYK_NO IS NOT NULL THEN
          1
         ELSE
          NULL
       END) VIP_TRX,
 COUNT(DISTINCT C.HYK_NO) VIP
  FROM (SELECT /*+PARALLEL(16)*/
        DISTINCT A.DT_WID, A.ORG_WID, A.SLS_TRX_ID, A.HYK_NO
          FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_F A
         WHERE A.DT_WID BETWEEN 120150101000 AND 120151231000
           AND EXISTS (SELECT /*+PARALLEL(16)*/
                 1
                  FROM RADM.W_RTL_ITEM_GRP1_D B
                 WHERE A.PROD_WID = B.PROD_WID
                   AND B.FLEX_ATTRIB_1_CHAR = 902)) C
 GROUP BY SUBSTR(C.DT_WID, 2, 6)
 ORDER BY SUBSTR(C.DT_WID, 2, 6);

--3.按门店统计
SELECT /*+PARALLEL(16)*/
 SUBSTR(C.DT_WID, 2, 6) MONTH,
 O.ORG_NUM LOC,
 COUNT(C.SLS_TRX_ID) ALL_TRX,
 COUNT(CASE
         WHEN C.HYK_NO IS NOT NULL THEN
          1
         ELSE
          NULL
       END) VIP_TRX,
 COUNT(DISTINCT C.HYK_NO) VIP
  FROM (SELECT /*+PARALLEL(16)*/
        DISTINCT A.DT_WID, A.ORG_WID, A.SLS_TRX_ID, A.HYK_NO
          FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_F A
         WHERE A.DT_WID BETWEEN 120150101000 AND 120151231000
           AND EXISTS (SELECT /*+PARALLEL(16)*/
                 1
                  FROM RADM.W_RTL_ITEM_GRP1_D B
                 WHERE A.PROD_WID = B.PROD_WID
                   AND B.FLEX_ATTRIB_1_CHAR = 902)) C,
       RADM.W_INT_ORG_D O
 WHERE C.ORG_WID = O.ROW_WID
 GROUP BY SUBSTR(C.DT_WID, 2, 6), O.ORG_NUM
 ORDER BY SUBSTR(C.DT_WID, 2, 6), O.ORG_NUM;
--4.全年统计
SELECT /*+PARALLEL(16)*/
 SUBSTR(C.DT_WID, 2, 4) MONTH,
 COUNT(C.SLS_TRX_ID) ALL_TRX,
 COUNT(CASE
         WHEN C.HYK_NO IS NOT NULL THEN
          1
         ELSE
          NULL
       END) VIP_TRX,
 COUNT(DISTINCT C.HYK_NO) VIP
  FROM (SELECT /*+PARALLEL(16)*/
        DISTINCT A.DT_WID, A.ORG_WID, A.SLS_TRX_ID, A.HYK_NO
          FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_F A
         WHERE A.DT_WID BETWEEN 120150101000 AND 120151231000
           AND EXISTS (SELECT /*+PARALLEL(16)*/
                 1
                  FROM RADM.W_RTL_ITEM_GRP1_D B
                 WHERE A.PROD_WID = B.PROD_WID
                   AND B.FLEX_ATTRIB_1_CHAR = 902)) C
 GROUP BY SUBSTR(C.DT_WID, 2, 4)
 ORDER BY SUBSTR(C.DT_WID, 2, 4);
--5.购买次数排名
SELECT /*+PARALLEL(16)*/
 D.TRX_COUNT, COUNT(D.HYK_NO) HYK
  FROM (SELECT /*+PARALLEL(16)*/
         C.HYK_NO, COUNT(C.SLS_TRX_ID) TRX_COUNT
          FROM (SELECT /*+PARALLEL(16)*/
                DISTINCT A.DT_WID, A.ORG_WID, A.SLS_TRX_ID, A.HYK_NO
                  FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_F A
                 WHERE A.DT_WID BETWEEN 120150101000 AND 120151231000
                   AND EXISTS (SELECT /*+PARALLEL(16)*/
                         1
                          FROM RADM.W_RTL_ITEM_GRP1_D B
                         WHERE A.PROD_WID = B.PROD_WID
                           AND B.FLEX_ATTRIB_1_CHAR = 902)) C
         WHERE C.HYK_NO IS NOT NULL
         GROUP BY C.HYK_NO
         ORDER BY COUNT(C.SLS_TRX_ID)) D
 GROUP BY D.TRX_COUNT;

--6.
--7.
--8.
--9.
--10.
--11.
