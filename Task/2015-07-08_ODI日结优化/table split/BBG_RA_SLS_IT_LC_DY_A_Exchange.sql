-- CREATE PARTITION HIST TABLE 
CREATE TABLE BBG_RA_SLS_IT_LC_DY_A_HIST
(
  ROW_WID                NOT NULL,
  PROD_WID               NOT NULL,
  PROD_SCD1_WID          NOT NULL,
  ORG_WID                NOT NULL,
  ORG_SCD1_WID           NOT NULL,
  ORG_DH_WID             NOT NULL,
  DT_WID                 NOT NULL,
  DATASOURCE_NUM_ID      NOT NULL,
  DELETE_FLG            ,
  DOC_CURR_CODE         ,
  ETL_PROC_WID           NOT NULL,
  GLOBAL1_EXCHANGE_RATE ,
  GLOBAL2_EXCHANGE_RATE ,
  GLOBAL3_EXCHANGE_RATE ,
  INTEGRATION_ID         NOT NULL,
  LOC_CURR_CODE         ,
  LOC_EXCHANGE_RATE     ,
  TENANT_ID             ,
  W_INSERT_DT           ,
  W_UPDATE_DT           ,
  X_CUSTOM              ,
  BBG_ITEM_LOC_WID       NOT NULL,
  BBG_ITEM_LOC_SUPP_WID ,
  SUPPLIER_WID           NOT NULL,
  SUPP_SALES_QTY        ,
  SUPP_SALES_COST       ,
  SUPP_SALES_AMT        ,
  BBG_REFERENCE_DO1     ,
  BBG_REFERENCE_DO2     ,
  BBG_REFERENCE_DO3     ,
  BBG_REFERENCE_DO4     ,
  BBG_REFERENCE_DO5     ,
  BBG_REFERENCE_FO1     ,
  BBG_REFERENCE_FO2     ,
  BBG_REFERENCE_FO3     ,
  BBG_REFERENCE_FO4     ,
  BBG_REFERENCE_FO5     ,
  BBG_REFERENCE_FO6     ,
  BBG_REFERENCE_FO7     ,
  BBG_REFERENCE_FO8     ,
  BBG_REFERENCE_FO9     ,
  BBG_REFERENCE_FO10    
)
PARTITION BY RANGE (DT_WID)
(  PARTITION BBG_RA_SLS_IT_LC_DY_A_201201 VALUES LESS THAN (120120200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201202 VALUES LESS THAN (120120300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201203 VALUES LESS THAN (120120400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201204 VALUES LESS THAN (120120500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201205 VALUES LESS THAN (120120600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201206 VALUES LESS THAN (120120700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201207 VALUES LESS THAN (120120800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201208 VALUES LESS THAN (120120900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201209 VALUES LESS THAN (120121000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201210 VALUES LESS THAN (120121100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201211 VALUES LESS THAN (120121200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201212 VALUES LESS THAN (120130100000) TABLESPACE RETAIL_DATA,
	 PARTITION BBG_RA_SLS_IT_LC_DY_A_201301 VALUES LESS THAN (120130200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201302 VALUES LESS THAN (120130300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201303 VALUES LESS THAN (120130400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201304 VALUES LESS THAN (120130500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201305 VALUES LESS THAN (120130600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201306 VALUES LESS THAN (120130700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201307 VALUES LESS THAN (120130800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201308 VALUES LESS THAN (120130900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201309 VALUES LESS THAN (120131000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201310 VALUES LESS THAN (120131100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201311 VALUES LESS THAN (120131200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201312 VALUES LESS THAN (120140100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201401 VALUES LESS THAN (120140200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201402 VALUES LESS THAN (120140300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201403 VALUES LESS THAN (120140400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201404 VALUES LESS THAN (120140500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201405 VALUES LESS THAN (120140600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201406 VALUES LESS THAN (120140700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201407 VALUES LESS THAN (120140800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201408 VALUES LESS THAN (120140900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201409 VALUES LESS THAN (120141000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201410 VALUES LESS THAN (120141100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201411 VALUES LESS THAN (120141200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201412 VALUES LESS THAN (120150100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201501 VALUES LESS THAN (120150200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201502 VALUES LESS THAN (120150300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201503 VALUES LESS THAN (120150400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201504 VALUES LESS THAN (120150500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201505 VALUES LESS THAN (120150600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201506 VALUES LESS THAN (120150700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201507 VALUES LESS THAN (120150800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201508 VALUES LESS THAN (120150900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201509 VALUES LESS THAN (120151000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201510 VALUES LESS THAN (120151100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201511 VALUES LESS THAN (120151200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201512 VALUES LESS THAN (120160100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201601 VALUES LESS THAN (120160200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201602 VALUES LESS THAN (120160300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201603 VALUES LESS THAN (120160400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201604 VALUES LESS THAN (120160500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201605 VALUES LESS THAN (120160600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201606 VALUES LESS THAN (120160700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201607 VALUES LESS THAN (120160800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201608 VALUES LESS THAN (120160900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201609 VALUES LESS THAN (120161000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201610 VALUES LESS THAN (120161100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201611 VALUES LESS THAN (120161200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201612 VALUES LESS THAN (120170100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201701 VALUES LESS THAN (120170200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201702 VALUES LESS THAN (120170300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201703 VALUES LESS THAN (120170400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201704 VALUES LESS THAN (120170500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201705 VALUES LESS THAN (120170600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201706 VALUES LESS THAN (120170700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201707 VALUES LESS THAN (120170800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201708 VALUES LESS THAN (120170900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201709 VALUES LESS THAN (120171000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201710 VALUES LESS THAN (120171100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201711 VALUES LESS THAN (120171200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201712 VALUES LESS THAN (120180100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_MAX VALUES LESS THAN (MAXVALUE) TABLESPACE RETAIL_DATA),
TABLESPACE RETAIL_DATA
COMPRESS 
NOLOGGING 
PARALLEL 10 AS SELECT /*+ PARALLEL(T 10)*/  * FROM BBG_RA_SLS_IT_LC_DY_A T WHERE T.DT_WID<'120160800000';
    
ALTER TABLE BBG_RA_SLS_IT_LC_DY_A_HIST LOGGING;
ALTER TABLE BBG_RA_SLS_IT_LC_DY_A_HIST PARALLEL 1;  

--CREATE PARTITION TABLE 
CREATE TABLE BBG_RA_SLS_IT_LC_DY_A_PAR
(
  ROW_WID                NOT NULL,
  PROD_WID               NOT NULL,
  PROD_SCD1_WID          NOT NULL,
  ORG_WID                NOT NULL,
  ORG_SCD1_WID           NOT NULL,
  ORG_DH_WID             NOT NULL,
  DT_WID                 NOT NULL,
  DATASOURCE_NUM_ID      NOT NULL,
  DELETE_FLG            ,
  DOC_CURR_CODE         ,
  ETL_PROC_WID           NOT NULL,
  GLOBAL1_EXCHANGE_RATE ,
  GLOBAL2_EXCHANGE_RATE ,
  GLOBAL3_EXCHANGE_RATE ,
  INTEGRATION_ID         NOT NULL,
  LOC_CURR_CODE         ,
  LOC_EXCHANGE_RATE     ,
  TENANT_ID             ,
  W_INSERT_DT           ,
  W_UPDATE_DT           ,
  X_CUSTOM              ,
  BBG_ITEM_LOC_WID       NOT NULL,
  BBG_ITEM_LOC_SUPP_WID ,
  SUPPLIER_WID           NOT NULL,
  SUPP_SALES_QTY        ,
  SUPP_SALES_COST       ,
  SUPP_SALES_AMT        ,
  BBG_REFERENCE_DO1     ,
  BBG_REFERENCE_DO2     ,
  BBG_REFERENCE_DO3     ,
  BBG_REFERENCE_DO4     ,
  BBG_REFERENCE_DO5     ,
  BBG_REFERENCE_FO1     ,
  BBG_REFERENCE_FO2     ,
  BBG_REFERENCE_FO3     ,
  BBG_REFERENCE_FO4     ,
  BBG_REFERENCE_FO5     ,
  BBG_REFERENCE_FO6     ,
  BBG_REFERENCE_FO7     ,
  BBG_REFERENCE_FO8     ,
  BBG_REFERENCE_FO9     ,
  BBG_REFERENCE_FO10    
)
PARTITION BY RANGE (DT_WID)
(  PARTITION BBG_RA_SLS_IT_LC_DY_A_201605 VALUES LESS THAN (120160600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201606 VALUES LESS THAN (120160700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201607 VALUES LESS THAN (120160800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201608 VALUES LESS THAN (120160900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201609 VALUES LESS THAN (120161000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201610 VALUES LESS THAN (120161100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201611 VALUES LESS THAN (120161200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201612 VALUES LESS THAN (120170100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201701 VALUES LESS THAN (120170200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201702 VALUES LESS THAN (120170300000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201703 VALUES LESS THAN (120170400000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201704 VALUES LESS THAN (120170500000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201705 VALUES LESS THAN (120170600000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201706 VALUES LESS THAN (120170700000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201707 VALUES LESS THAN (120170800000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201708 VALUES LESS THAN (120170900000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201709 VALUES LESS THAN (120171000000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201710 VALUES LESS THAN (120171100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201711 VALUES LESS THAN (120171200000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_201712 VALUES LESS THAN (120180100000) TABLESPACE RETAIL_DATA,
   PARTITION BBG_RA_SLS_IT_LC_DY_A_MAX VALUES LESS THAN (MAXVALUE) TABLESPACE RETAIL_DATA),
TABLESPACE RETAIL_DATA
COMPRESS 
NOLOGGING 
PARALLEL 10 AS SELECT /*+ PARALLEL(T 10)*/  * FROM BBG_RA_SLS_IT_LC_DY_A T WHERE T.DT_WID>'120160731000';
    
ALTER TABLE BBG_RA_SLS_IT_LC_DY_A_PAR LOGGING;
ALTER TABLE BBG_RA_SLS_IT_LC_DY_A_PAR PARALLEL 1; 

--***********************************************************
--DROP INDEX 
--***********************************************************
ALTER TABLE RADM.BBG_RA_SLS_IT_LC_DY_A
 DROP PRIMARY KEY CASCADE;
 
DROP INDEX PK_BBG_RA_SLS_IT_LC_DY_A;


--***********************************************************
--CHANGE TABLE NAME
--***********************************************************

ALTER TABLE BBG_RA_SLS_IT_LC_DY_A RENAME TO BBG_RA_SLS_IT_LC_DY_A_BAK;
ALTER TABLE BBG_RA_SLS_IT_LC_DY_A_PAR RENAME TO BBG_RA_SLS_IT_LC_DY_A;

--***********************************************************
--CREATE  INDEX 
--***********************************************************
CREATE UNIQUE INDEX RADM.PK_BBG_RA_SLS_IT_LC_DY_A ON RADM.BBG_RA_SLS_IT_LC_DY_A
(PROD_WID, ORG_WID, DT_WID, SUPPLIER_WID)
NOLOGGING
TABLESPACE DM_FACT_INDEX
PCTFREE    10
INITRANS   12
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
PARALLEL 10
INVISIBLE;


ALTER TABLE RADM.BBG_RA_SLS_IT_LC_DY_A ADD (
  CONSTRAINT PK_BBG_RA_SLS_IT_LC_DY_A
 PRIMARY KEY
 (PROD_WID, ORG_WID, DT_WID, SUPPLIER_WID)
    USING INDEX 
    TABLESPACE DM_FACT_INDEX
    PCTFREE    10
    INITRANS   12
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
               ));

ALTER INDEX PK_BBG_RA_SLS_IT_LC_DY_A LOGGING;
ALTER INDEX PK_BBG_RA_SLS_IT_LC_DY_A PARALLEL 1;


CREATE UNIQUE INDEX RADM.PK_BBG_RA_SLS_IT_LC_DY_A_HIST ON RADM.BBG_RA_SLS_IT_LC_DY_A_HIST
(PROD_WID, ORG_WID, DT_WID, SUPPLIER_WID)
NOLOGGING
TABLESPACE DM_FACT_INDEX
PCTFREE    10
INITRANS   12
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
PARALLEL 10
INVISIBLE;


ALTER TABLE RADM.BBG_RA_SLS_IT_LC_DY_A_HIST ADD (
  CONSTRAINT PK_BBG_RA_SLS_IT_LC_DY_A_HIST
 PRIMARY KEY
 (PROD_WID, ORG_WID, DT_WID, SUPPLIER_WID)
    USING INDEX 
    TABLESPACE DM_FACT_INDEX
    PCTFREE    10
    INITRANS   12
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
               ));

ALTER INDEX PK_BBG_RA_SLS_IT_LC_DY_A_HIST LOGGING;
ALTER INDEX PK_BBG_RA_SLS_IT_LC_DY_A_HIST PARALLEL 1;



--***********************************************************
--ANALYZE TABLE
--***********************************************************

--DBMS.STATS

BEGIN
DBMS_STATS.GATHER_TABLE_STATS(OWNNAME => 'RADM',
                                      TABNAME => 'BBG_RA_SLS_IT_LC_DY_A',
                                      GRANULARITY=>'ALL',
                                      DEGREE=>8,
                                      ESTIMATE_PERCENT  => SYS.DBMS_STATS.AUTO_SAMPLE_SIZE,
                                      CASCADE=>TRUE);
DBMS_STATS.GATHER_TABLE_STATS(OWNNAME => 'RADM',
                                      TABNAME => 'BBG_RA_SLS_IT_LC_DY_A_HIST',
                                      GRANULARITY=>'ALL',
                                      DEGREE=>8,
                                      CASCADE=>TRUE,
                                      ESTIMATE_PERCENT  => SYS.DBMS_STATS.AUTO_SAMPLE_SIZE);                                                                                                              
END;
/
