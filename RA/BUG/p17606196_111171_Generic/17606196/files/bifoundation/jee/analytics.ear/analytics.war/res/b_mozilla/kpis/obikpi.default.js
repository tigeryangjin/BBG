obips.ResourceManager.getSingleton().load(obibsc.scorecardResourceBundle);window.onload=function(){new obikpi.Default()};obikpi.Default=function(){var i=obips.getSingleton(obikpi.Default.SINGLETON_NAME);if(i){return i}obikpi.Default.baseConstructor.call(this);var b=obibsc.common.getDecodedURLParms();this.documentModelPath=b.itemPath;this.action=b.action;if(!this.documentModelPath||this.documentModelPath==""){var h=obikpiWatchlistNumCols;this.documentModelPath=obikpiWatchlistRequestParmItemPath;this.action=obikpiWatchlistRequestParmAction}this.dimensionContext=new Array();var j=1;var g=b["col"+j];while(g&&g!=""){var l=b["op"+j];var f=b["val"+j];var a;if(f.indexOf("levelID:")!=-1){var n=f.indexOf("[");var c=f.indexOf("]");var e=f.substring(n+1,c).split(":")[1];var d=f.substring(c+1,f.length);a=new obibsc.DimensionBar.DimensionValue(g,d,d,e)}else{a=new obibsc.DimensionBar.DimensionValue(g,f,f)}this.dimensionContext.push(a);j++;g=b["col"+j]}var k=obips.ResourceManager.getSingleton();var m=k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardOracleBIKPIWatchlist").getString();document.title=m;this.dragDropController=saw.dnd.getController();globalRegister.addObject("dragDropController",this.dragDropController);if((this.action=="new")||(this.action=="edit")){this.dragDropController.unlock()}else{this.dragDropController.lock()}this.setupPage();globalRegister.addObject(obikpi.Default.SINGLETON_NAME,this)};extend(obikpi.Default,obips.Observable);obikpi.Default.getSingleton=function(){return obips.getSingleton(obikpi.Default.SINGLETON_NAME)};obikpi.Default.SINGLETON_NAME="obikpi.Default";function getFilenamesInUse(b){var a=new Array();return a}obikpi.Default.prototype.doneLoadingResources=function(){};obikpi.Default.prototype.setupPage=function(){var f=obips.ResourceManager.getSingleton();this.webCatalogManager=new obips.WebCatalog.Manager();globalRegister.addObject("webCatalogManager",this.webCatalogManager);this.contextMenuManager=obips.ContextMenu.Manager.getSingleton();this.kpiEngineManager=new obibsc.KPIEngine.Manager();globalRegister.addObject("kpiEngineManager",this.kpiEngineManager);this.annotationEngineManager=new obibsc.AnnotationEngine.Manager();globalRegister.addObject("annotationEngineManager",this.annotationEngineManager);this.assessmentOverrideManager=new obibsc.AssessmentOverrideEngine.Manager();globalRegister.addObject("assessmentOverrideManager",this.assessmentOverrideManager);if(this.action=="new"){var c=obibsc.Synchronizer.getUniqueFilename(tSessionInfos.user.homeDir,obips.ResourceManager.getSingleton().getResource(obibsc.scorecardResourceBundle,"kmsgScorecardNewKPIWatchlist").getString(),getFilenamesInUse(tSessionInfos.user.homeDir));this.documentModelPath=obips.catalog.Path.concat(tSessionInfos.user.homeDir,c)}this.actionExecuter=new obiaf.ExecuteAction();globalRegister.addObject("obiaf.ExecuteAction",this.actionExecuter);var b=document.getElementById("applicationTabBody");saw.componentheader.layoutOuterDiv();var g=saw.componentheader.getPageContentOuterDiv();saw.setOuterHeight(b,saw.cssLengthToInt(g.style.height));this.mainTabBodyDiv=document.createElement("div");b.appendChild(this.mainTabBodyDiv);new obips.BrowserEventFramework.Resizable(this.mainTabBodyDiv);if((this.action=="new")||(this.action=="edit")){var a=new obips.Splitter.Model(false,180);this.splitterView=new obips.Splitter.View(a,this.mainTabBodyDiv,"mainLayout");var e=new Array();e.push(new obips.accordion2.PaneModel("catalog",null,f.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardCatalog").getString(),true,1,80,false));var d=new obips.accordion2.Model("accordion",e,true);var d=new obips.accordion2.Model("accordion",e,true);this.accordionViewer=new obips.accordion2.View(d,this.splitterView.pane1)}else{}this.dimensionBarModel=new obikpi.DimensionBar.Model(this.kpiEngineManager,this.documentModelPath,this.dimensionContext);this.dimensionBarModel.addEventListener(new obips.Observable.EventListener(obikpi.DimensionBar.Model.EventType.DIMENSION_BAR_INITIALIZED,new obips.Callback(this,this.postDimensionBarInitializedSetup)));this.dimensionBarViewer=new obikpi.DimensionBar.Viewer(this.dimensionBarModel,document.getElementById("dimensionBar"));saw.ondemandload.retrieveAndAddResources({messageTemplate:"kuiKPIWatchlistLoadMoreCSSFiles"},null,new obips.Callback(this,this.doneLoadingResources))};obikpi.Default.prototype.postDimensionBarInitializedSetup=function(){var k=obips.ResourceManager.getSingleton();var u=null;var t=new obips.catalog.ItemInfoDetailLevel(null,true,true);var F=obips.catalog.Path.getItemName(this.documentModelPath);var l=null;var q=null;if((this.action=="open")||(this.action=="edit")){var b=new obids.AjaxRequest("readKPIWatchlist");b.getRequest().addArg("itemPath",this.documentModelPath);var d=saw.ajax.createConnection(b.getRequest());d.setSync(true);var m=d.post();if(m&&m.response){var r=m.response.getJSON();l=obips.XMLDOM.parseXML(r.data);var n=obips.catalog.ItemInfo.parseJSON(r.itemInfo);q=obibsc.MetadataDocument.ItemInfo.createFromCatalogItemInfo(n)}}if(l){var v=new obibsc.watchlists.kpiwatchlist.DocumentModel(q);v.parseXML(l);u=new obikpi.KPIWatchlist.Editor.Model(this.webCatalogManager,this.kpiEngineManager,this.annotationEngineManager,this.dimensionBarModel,v,this.actionExecuter)}else{var F=obips.catalog.Path.getItemName(this.documentModelPath);var w=obips.catalog.Path.getParentPath(this.documentModelPath);var A=obips.catalog.Catalog.getSingleton().getItemInfo(w,true,t);var C=A.itemInfo;q=new obibsc.MetadataDocument.ItemInfo(this.documentModelPath,obips.catalog.ItemType.OBJECT,F,obips.WebCatalogService.ObjectSignature.SCORECARD_KPI_WATCHLIST);var v=new obibsc.watchlists.kpiwatchlist.DocumentModel(q);u=new obikpi.KPIWatchlist.Editor.Model(this.webCatalogManager,this.kpiEngineManager,this.annotationEngineManager,this.dimensionBarModel,v);u.changedSinceLastSave=true;u.isNew=true;var j=saw.getSessionInfos();var y=j.user.guid;q.setBusinessOwnerID(y);if(C){q.acl=obips.WebCatalog.Manager.cloneACL(C.acl);q.permissions=C.permissions}}if((!saw.userAgent.is_smrtphone)&&saw.header){saw.header.FavoriteHeaderMenu.getSingleton().setCurrentItemPath(q.path)}if(saw.header&&saw.header.viewer){saw.header.getViewer().setTitle(obips.catalog.Path.getItemName(q.path))}this.bForceReadOnly=((this.action=="edit")||(this.action=="new"))?false:true;var s=(this.splitterView)?this.splitterView.pane2:this.mainTabBodyDiv;this.watchlistViewer=new obikpi.KPIWatchlist.Editor.Viewer(u,s,this.bForceReadOnly,this.actionExecuter);globalRegister.addObject("kpiWatchlistEditorViewer",this.watchlistViewer);document.getElementById("splash").style.display="none";document.getElementById("application").style.display="block";var x=new obips.Callback(this,this.resize);x.kpiWatchlistScorecardResizeCallback=true;this.resizeEventListener=new obips.Observable.EventListener(null,x);this.resizeEventListener.kpiWatchlistScorecardResizeListener=true;obips.BrowserEventFramework.EventRouter.getEventRouter(window,"onresize").addEventListener(this.resizeEventListener);if((this.action=="new")||(this.action=="edit")){var a=obips.Array.clone(obips.WebCatalogTree.treeNodeViewerTypeInfos);for(nodeTypeName in a){a[nodeTypeName].setIsDraggable(true);a[nodeTypeName].setIsDropTarget(false)}var B=new obips.Tree.Node("/",k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardRoot").getString(),k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardRootNode").getString(),"Folder",null);var z=new Array();var i=new obips.Tree.Node("/shared",k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardShared").getString(),k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardSharedFolder").getString(),"Folder","/");var p=saw.getSessionInfos().user.homeDir;var h=saw.catalog.getLocalizedString("kmsgCatalogFavoriteFolderMyFolder");var f=new obips.Tree.Node(p,h,h,"Folder","/");z.push(f);z.push(i);var c=new Array();c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_SETTINGS);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_VISION);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_MISSION);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_OBJECTIVE);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_PERSPECTIVE);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_PERSPECTIVE_LIST);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_STRATEGIC_THEME);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_INITIATIVE);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_INITIATIVE_TREE);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_CAUSE_EFFECT_LINKAGES);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_STRATEGY_TREE);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_STRATEGY_TREE_VIEW);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_STRATEGY_MAP);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_CUSTOM_VIEW);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_CAUSE_EFFECT_MAP);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_KPI_WATCHLIST);c.push(obips.WebCatalogService.ObjectSignature.DASHBOARD);c.push(obips.WebCatalogService.ObjectSignature.DASHBOARD_PROMPT);c.push(obips.WebCatalogService.ObjectSignature.SAVED_FILTER);c.push(obips.WebCatalogService.ObjectSignature.IBOT);c.push(obips.WebCatalogService.ObjectSignature.ACTION);c.push(obips.WebCatalogService.ObjectSignature.CONDITION);c.push(obips.WebCatalogService.ObjectSignature.CUSTOMGROUP);c.push(obips.WebCatalogService.ObjectSignature.GENERIC);c.push(obips.WebCatalogService.ObjectSignature.SCORECARD_PERSPECTIVE_LIST);var E=new Array();E.push(new obips.UberBar.IconTextMenuOption("folder",new obips.UberBar.IconSet(obips.WebCatalogTree.treeNodeViewerTypeInfos.Folder.urlIcon,obips.WebCatalogTree.treeNodeViewerTypeInfos.Folder.urlIcon,obips.WebCatalogTree.treeNodeViewerTypeInfos.Folder.urlIcon,obips.WebCatalogTree.treeNodeViewerTypeInfos.Folder.urlIcon),k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardNewFolder").getString(),k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardNewFolder").getString(),new obips.Callback(null,newFolder)));var o=new obips.UberBar.IconSet(k.getURL(obibsc.scorecardResourceBundle,"newObjectEnabled").url,k.getURL(obibsc.scorecardResourceBundle,"newObjectDisabled").url,k.getURL(obibsc.scorecardResourceBundle,"newObjectOver").url,k.getURL(obibsc.scorecardResourceBundle,"newObjectDown").url);var D=new obips.WebCatalogTree.Model(this.webCatalogManager,B,null,openWebCatalogTreeNode,null,c,z,true);var g=new obips.WebCatalogTree.Viewer(D,this.accordionViewer.getPaneViewBodyElementByID("catalog"),this.accordionViewer.getPaneViewUberBarElementByID("catalog"),k);obips.CSS.addClassToElement(g.uberBarViewer.uberBarDiv,"paneToolBarUberBarDiv");g.uberBarDiv.className="paneToolBarContainerDiv";globalRegister.addObject("catalogTreeViewer",g);var e=k.getResource(obibsc.scorecardResourceBundle,"kmsgScorecardThereAreUnsavedChanges").getString();obips.launcher.addPageUnloadGuard(new obips.Callback(this,this.handleUnload),e)}obips.asyncCall(new obips.Callback(this,this.resize),100);obips.asyncCall(new obips.Callback(null,obibsc.common.loadActionFrameworkFiles),1);obips.asyncCall(new obips.Callback(null,obibsc.common.loadOpenSaveDialogFiles),2)};obikpi.Default.prototype.handleUnload=function(){var a=false;if(this.watchlistViewer.model.changedSinceLastSave){a=true}return a};obikpi.Default.prototype.resize=function(){var a=document.getElementById("applicationTabBody");saw.componentheader.layoutOuterDiv();var d=saw.componentheader.getPageContentOuterDiv();saw.setOuterHeight(a,saw.cssLengthToInt(d.style.height));var c=obips.HTMLDOM.getFrameHeight(self);var b=obips.HTMLDOM.calculateAbsoluteOffsetTop(this.mainTabBodyDiv)+26;this.mainTabBodyDiv.style.height=Math.max(0,c-b-2)+"px";this.mainTabBodyDiv.resizable.notifyResize();var e=globalRegister.getObject("secondaryTabsViewer");if(e){b=obips.HTMLDOM.calculateAbsoluteOffsetTop(e.tabBodiesDiv);e.tabBodiesDiv.style.height=Math.max(0,c-b-6)+"px";this.watchlistViewer.controller.resize()}};obikpi.Default._getWebCatalogTreeViewFromUberBarElement=function(b){var a=obips.BrowserEventFramework.getViewerFromElement(b,"paneView");var c=a.bodyDiv.firstChild.webCatalogTreeViewer;return c};function openWebCatalogTreeNode(b){var a=b.treeNode.type;var c=b.treeNode.id;openWebCatalogObject(c,a)}function openWebCatalogObject(c,a){var b=new obips.Callback(this,this.openWebCatalogObjectStep2);obibsc.Synchronizer.getExistingItemInfoAsync(c,{webCatalogPath:c,signature:a},b)}function openWebCatalogObjectStep2(c,b){if(c&&b&&c.webCatalogPath&&c.signature){var d=c.webCatalogPath;var a=c.signature;saw.catalogaction.getActionManager().handleAction(saw.catalogaction.ActionId.OPEN,b.path,b.signature,b,null,new saw.catalogaction.ActionContext("_blank"))}}function newFolder(a){var e=obikpi.Default._getWebCatalogTreeViewFromUberBarElement(a.context.menuViewer.buttonViewer.uberBarViewer.uberBarDiv);var f=getParentFolder(e);var d=globalRegister.getObject("webCatalogManager");var b=obibsc.Synchronizer.getUniqueFilename(f,obips.ResourceManager.getSingleton().getResource(obibsc.scorecardResourceBundle,"kmsgScorecardNewFolder").getString());var c=obips.catalog.Path.concat(f,b);d.createFolder(c)}function getParentFolder(c){var e=c;var a=e.treeViewer;var b=a.viewModel.selectedNodes[0];var d=null;if(b){if(b.treeNode.type=="Folder"){d=b.treeNode.id}else{d=b.treeNode.parentID}}else{d=a.model.rootNode.id}return d};