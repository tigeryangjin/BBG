if(typeof(pivotview_js)=="undefined"){pivotview_js=true;if(typeof(obips)=="undefined"){obips=function(){}}obips.PivotTable=function(h,m,n,u,o,l,w,r,s,p,e,j,f,k,c,d,b,t,a,v){obips.PivotTable.baseConstructor.call(this,h,o,n,u,l,w,r,p,v);this.promptSearchID=s;this.setArrayEdgesContainingOrderedLayers(t);this.masterClientId=h;this.addTestViewMapping(h);this.containerId=m;this.idList=n.split(",");this.supportedFeatures=f;this.supportedFeaturesInit=false;this.actionLinksXmlId=c;this.startRow=a;this.isChartOnly=k==true;this.model=new Object();this.model.colEdgeEffectiveRows=e;this.model.rowEdgeEffectiveColumns=j;this.registerMasterView(h,w);this.clientEventListeners=[];for(var q=0;q<this.idList.length;q++){this.registerChildView(h,this.idList[q])}this.registerChildView(h,u);var x=this.getHtmlElement();if(x){this.ddTableTarget=new obips.PivotTable.DropTarget(x,obips.PivotTable.ksAvailableDataGroup);this.ddTableTarget.bTarget=true;this.ddTableTarget.bDraggable=false;saw.addEventListener(document.body,"mouseup",obips.PivotTable.onMouseUp);saw.addEventListener(document.body,"mouseout",obips.PivotTable.onMouseOut);saw.addEventListener(x,"mouseover",obips.PivotTable.onPivotContainerDragOver);saw.addEventListener(x,"mouseout",obips.PivotTable.onPivotContainerDragOut);saw.addEventListener(x,"mousemove",obips.PivotTable.onMouseMove);saw.addEventListener(x,"mouseup",obips.PivotTable.onDragEnd);saw.addEventListener(x,"mousedown",obips.PivotTable.onMouseDown);saw.addEventListener(x,"click",obips.PivotTable.onClick);saw.addEventListener(x,"keydown",obips.PivotTable.onKeyDown);if(saw.userAgent.is_touchdevice){saw.addEventListener(x,"touchstart",obips.PivotTable.onTouchStart);saw.addEventListener(x,"touchmove",obips.PivotTable.onTouchMove);saw.addEventListener(x,"touchend",obips.PivotTable.onTouchEnd)}this.disableSelectionOnNode()}this.addClientEventListener(d,b);obips.views.registerIsViewExpandableCallback(w,new obips.Callback(this,this.isViewExpandable));this.viewExpandEventListener=new obips.views.ViewExpandEventListener(new obips.Callback(this,this.viewExpandHandler),w);this.viewRestoreEventListener=new obips.views.ViewRestoreEventListener(new obips.Callback(this,this.viewRestoreHandler),w);var g=obips.views.ViewController.getController(w);g.addEventListener(this.viewExpandEventListener);g.addEventListener(this.viewRestoreEventListener);this.addTouchHandlers(h);obips.PivotTable.ptDragCoords=new Object();obips.PivotTable.ptDropCoords=new Object();this.focusedCellCoords=new Object();this.registerStaticEvents()};extend(obips.PivotTable,obips.ViewModel);obips.PivotTable.TOUCH_RADIUS_FOR_LONG_TOUCH=0;obips.PivotTable.mouseDragOffset=5;obips.PivotTable.ptDragCoords=new Object();obips.PivotTable.ptDragCoords.inUse=false;obips.PivotTable.ptDropCoords=new Object();obips.PivotTable.ptDropCoords.inUse=false;obips.PivotTable.ptLastVisibleObj=new Object();obips.PivotTable.ptLastVisibleObj.layer=-1;obips.PivotTable.ptLastVisibleObj.edge=-1;obips.PivotTable.ptLastVisibleObj.sourceId="";obips.PivotTable.ptLastVisibleGrabHandle=null;obips.PivotTable.ptLastVisibleScrollImages=new Object();obips.PivotTable.ptColumnBeingDragged=null;obips.PivotTable.ptProcessingEvent=false;obips.PivotTable.ksAvailableDataGroup="availDataDnDGroup";obips.PivotTable.DROP_BEFORE_CENTER=1;obips.PivotTable.DROP_IN_CENTER=2;obips.PivotTable.DROP_AFTER_CENTER=3;obips.PivotTable.ptCurrentEvent=new Object();obips.PivotTable.ptCurrentEvent.eventType=obips.ViewModel.EventType.NO_EVENT;obips.PivotTable.ptCurrentEvent.eventSrc="";obips.PivotTable.cellSelectionColor="#9CACC9";obips.PivotTable.cellSelectionUnfocusedColor="#DDDDDD";obips.PivotTable.selectionChildPivotID="";obips.PivotTable.selectionRowStart=-1;obips.PivotTable.selectionColStart=-1;obips.PivotTable.selectionEdgeStart=-1;obips.PivotTable.selectionLayerStart=-1;obips.PivotTable.selectionSliceStartSlice=-1;obips.PivotTable.selectionSliceEndSlice=-1;obips.PivotTable.selectionLastFocus="";obips.PivotTable.SORT_ASC="ascending";obips.PivotTable.SORT_DESC="descending";obips.PivotTable.SORT_NONE="none";obips.PivotTable.kKeys=new Object();obips.PivotTable.kKeys.nLeftArrowKey=37;obips.PivotTable.kKeys.nUpArrowKey=38;obips.PivotTable.kKeys.nRightArrowKey=39;obips.PivotTable.kKeys.nDownArrowKey=40;obips.PivotTable.kKeys.nF10Key=121;obips.PivotTable.kKeys.nEnterKey=13;obips.PivotTable.interPropSettingsMap=new Object();obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_DRILL]="drill";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_MOVE_COLS]="movecolumns";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_SORT]="sortcolumns";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_ADD_REMOVE_VALUES]="addremovevalues";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_GROUP_OPERATIONS]="groupoperations";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_CALCITEM_OPERATIONS]="calcitemoperations";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_SHOW_HIDE_TOTALS]="showhidesubtotal";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_SHOW_HIDE_RUNNINGSUM]="showhiderunningsum";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_INCL_EXCL_COLS]="inclexclcolumns";obips.PivotTable.interPropSettingsMap[obips.ViewRightClickMenu.FEATURE_HIDE_COLS]="hidecolumns";obips.PivotTable.FOCUSED_CELL_TYPE_EDGE="edge";obips.PivotTable.FOCUSED_CELL_TYPE_DATA="data";obips.PivotTable.focusNodeNames=[];obips.PivotTable.focusNodeNames.push("INPUT");obips.PivotTable.focusNodeNames.push("TEXTAREA");obips.PivotTable.focusNodeNames.push("IMG");obips.PivotTable.focusNodeNames.push("A");obips.PivotTable.focusNodeNames.push("SELECT");obips.PivotTable.nodeAllowsFocus=function(b){if(b){for(var a=0;a<obips.PivotTable.focusNodeNames.length;a++){if(b.nodeName==obips.PivotTable.focusNodeNames[a]){if(b.onclick){return true}if(b.nodeName=="IMG"){if(b.parentNode.nodeName=="A"){return true}}else{return true}}}}return false};obips.PivotTable.onKeyDown=function(f){var c=saw.getEventTarget(f);if(obips.PivotTable.nodeAllowsFocus(c)){return}var e=c.id;var g=obips.EdgeCoords.findCoords(c);if(g){var a=g.getEdge();if(a==obips.JSDataLayout.PAGE_EDGE){return}e=g.getId()}var b=obips.DatabodyCoords.findCoords(c);if(b){e=b.getId()}if(!e){return}var d=obips.ViewModel.getViewModelById(e);if(!d){return}var h=obips.PivotTable.isCtrlKeyPressed(f);var i=obips.PivotTable.isShiftKeyPressed(f);switch(f.keyCode){case obips.PivotTable.kKeys.nLeftArrowKey:d.navigateToCell(f,"left",e,h,i);break;case obips.PivotTable.kKeys.nUpArrowKey:d.navigateToCell(f,"up",e,h,i);break;case obips.PivotTable.kKeys.nRightArrowKey:d.navigateToCell(f,"right",e,h,i);break;case obips.PivotTable.kKeys.nDownArrowKey:d.navigateToCell(f,"down",e,h,i);break;case obips.PivotTable.kKeys.nF10Key:if(i){d.launchContextMenuForFocusedCell(f,e)}break;case obips.PivotTable.kKeys.nEnterKey:f.childPivotClientId=e;d.launchContextMenuForFocusedCell(f,e);break;default:break}};obips.PivotTable.setGrandTotalID=function(c,a){var b=XUIGetAttributeString(c,"id");if(b==""){XUISetAttributeString(c,"id","gt_"+a)}};obips.PivotTable.setSubTotalID=function(f,d){var e=XUIGetAttributeString(d,"type");if(e=="column"){var b=XUIGetAttributeString(d,"columnID");var a=XUIGetAttributeString(d,"duplicateID");var c="st_"+b;if(a!=""){c+="_"+a}XUISetAttributeString(f,"id",c)}};obips.PivotTable.prototype.launchContextMenuForFocusedCell=function(m){if(this.focusedCellType==obips.PivotTable.FOCUSED_CELL_TYPE_EDGE){var b=this.focusedCellCoords.edge;var g=this.focusedCellCoords.layer;var k=this.focusedCellCoords.slice;var h=obips.PivotTable.getCellId(m.childPivotClientId,b,g,k);var f=document.getElementById(h);var n=obips.EdgeCoords.findCoords(f);if(!n){return}n.bDatabody=false;var j=n.getId();var i=obips.ViewModel.getViewModelById(j);var d=new obips.PivotViewRightClickMenu(i);var e=d.onEdgeContextMenu(n,m);var l=new obips.ContextMenu.Manager();l.displayAtPosition(d.contextMenuModel,saw.Position.createByDOMElement(f,"down",15))}else{if(this.focusedCellType=obips.PivotTable.FOCUSED_CELL_TYPE_DATA){var o=this.focusedCellCoords.row;var c=this.focusedCellCoords.col;var h="db_"+m.childPivotClientId+"_"+o+"_"+c;var f=document.getElementById(h);var a=obips.DatabodyCoords.findCoords(f);obips.PivotTable.onDatabodyContextMenu(a,m,f,false)}}};obips.PivotTable.prototype.navigateToCell=function(m,h,i,o,p){if(saw.isRToL()){if(h=="left"){h="right"}else{if(h=="right"){h="left"}}}saw.stopEvent(saw.getEvent(m));var c=this.getPivotViewXML();var l=obips.PivotTable.isTable(c);var k=this.getEdgeDefinition(i);var g=obips.ViewModel.getViewModelById(i);this.unhighlightCellsAndClearSel(i);if(!this.focusedCellType){if(l){this.highlightEdgeCell(i,obips.JSDataLayout.ROW_EDGE,0,0)}else{this.highlightBodyCell(i,0,0)}}else{if(this.focusedCellType==obips.PivotTable.FOCUSED_CELL_TYPE_EDGE){var a=this.focusedCellCoords.edge;var e=this.focusedCellCoords.layer;var j=this.focusedCellCoords.slice;var d=a;var f=e;var n=j;e=g.getPhysicalLayer(a,e);switch(h){case"up":if(a==obips.JSDataLayout.COLUMN_EDGE){if(e>0){f=e-1;n=k.getStartSlice(a,e-1,j)}else{n=k.getStartSlice(a,e,j)}}else{if(j>0){n=k.getStartSlice(a,e,j-1)}else{if(e==0){d=obips.JSDataLayout.ROW_EDGE;n=k.getStartSlice(obips.JSDataLayout.ROW_EDGE,e,j)}else{n=k.getStartSlice(a,e,j)}}}if(n===undefined){if((d>obips.JSDataLayout.COLUMN_EDGE)&&(j>0)){n=j-1}else{n=j}}this.highlightEdgeCell(i,d,f,n);break;case"down":if(a==obips.JSDataLayout.COLUMN_EDGE){if(e<k.getLayerCount(a)-1){this.highlightEdgeCell(i,a,f+1,k.getStartSlice(a,e+1,j))}else{if(k.getEdgeExtent(obips.JSDataLayout.ROW_EDGE)>0){this.highlightBodyCell(i,0,k.getStartSlice(a,e,j))}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}}else{if(k.itemIsGrandTotal(a,e,j)){this.highlightEdgeCell(i,a,f,k.getEndSlice(a,e,j))}else{if(k.getEndSlice(a,e,j)<k.getEdgeExtent(a)-1){this.highlightEdgeCell(i,a,f,k.getEndSlice(a,e,j)+1)}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}}break;case"left":if(a==obips.JSDataLayout.COLUMN_EDGE){if(j>0){this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j-1))}else{if(e==k.getLayerCount(a)-1){this.highlightEdgeCell(i,obips.JSDataLayout.ROW_EDGE,k.getLayerCount(obips.JSDataLayout.ROW_EDGE)-1,k.getStartSlice(obips.JSDataLayout.ROW_EDGE,k.getLayerCount(obips.JSDataLayout.ROW_EDGE)-1,j))}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}}else{if(a==obips.JSDataLayout.ROW_EDGE){if(f>0){this.highlightEdgeCell(i,a,f-1,k.getStartSlice(a,e-1,j))}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}break;case"right":if(a==obips.JSDataLayout.COLUMN_EDGE){if(k.getEndSlice(a,e,j)<k.getEdgeExtent(a)-1){this.highlightEdgeCell(i,a,f,k.getEndSlice(a,e,j)+1)}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}else{if(a==obips.JSDataLayout.ROW_EDGE){if(e<k.getLayerCount(a)-1){this.highlightEdgeCell(i,a,f+1,k.getStartSlice(a,e+1,j))}else{if(k.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE)>0){this.highlightBodyCell(i,j,0)}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}}else{this.highlightEdgeCell(i,a,f,k.getStartSlice(a,e,j))}}break}}else{if(this.focusedCellType==obips.PivotTable.FOCUSED_CELL_TYPE_DATA){var q=this.focusedCellCoords.row;var b=this.focusedCellCoords.col;switch(h){case"up":if(o){if(k.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE)>0){this.highlightEdgeCell(i,obips.JSDataLayout.COLUMN_EDGE,k.getLayerCount(obips.JSDataLayout.COLUMN_EDGE)-1,b)}}else{if(q>0){this.highlightBodyCell(i,q-1,b)}else{if(k.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE)>0){this.highlightEdgeCell(i,obips.JSDataLayout.COLUMN_EDGE,k.getLayerCount(obips.JSDataLayout.COLUMN_EDGE)-1,b)}}}break;case"down":if(q<k.getEdgeExtent(obips.JSDataLayout.ROW_EDGE)-1){this.highlightBodyCell(i,q+1,b)}else{this.highlightBodyCell(i,q,b)}break;case"left":if(o){if(k.getLayerCount(obips.JSDataLayout.ROW_EDGE)>0){this.highlightEdgeCell(i,obips.JSDataLayout.ROW_EDGE,g.getPhysicalLayer(obips.JSDataLayout.ROW_EDGE,k.getLayerCount(obips.JSDataLayout.ROW_EDGE)-1)-1,q)}}else{if(b>0){this.highlightBodyCell(i,q,b-1)}else{if(k.getLayerCount(obips.JSDataLayout.ROW_EDGE)>0){this.highlightEdgeCell(i,obips.JSDataLayout.ROW_EDGE,g.getPhysicalLayer(obips.JSDataLayout.ROW_EDGE,k.getLayerCount(obips.JSDataLayout.ROW_EDGE)-1)-1,q)}else{this.highlightBodyCell(i,q,b)}}}break;case"right":if(b<k.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE)-1){this.highlightBodyCell(i,q,b+1)}else{this.highlightBodyCell(i,q,b)}break}}}}};obips.PivotTable.prototype.addTestViewMapping=function(a){var b=globalRegister.getObject("viewModelRegister");if(b&&b.testViewMapping){b.testViewMapping.registerView(this);obips.selenium.registerObject(a,b.testViewMapping)}};obips.PivotTable.prototype.registerStaticEvents=function(){if(obips.gridview&&obips.AnalysisEventManager){var h=new obips.Callback(this,this.handleAddColumnToView);var g=new obips.AnalysisEventListener(obips.gridview.AddColumnToViewEvent.EVENT_TYPE,h);obips.AnalysisEventManager.getInstance().addEventListener(g);var e=new obips.Callback(this,this.handleAddMemberToView);var c=new obips.AnalysisEventListener(obips.gridview.AddMemberToViewEvent.EVENT_TYPE,e);obips.AnalysisEventManager.getInstance().addEventListener(c);var a=new obips.Callback(this,this.viewUpdated);var d=new obips.AnalysisEventListener(obips.gridview.ViewXmlUpdatedEvent.EVENT_TYPE,a);obips.AnalysisEventManager.getInstance().addEventListener(d);var f=new obips.Callback(this,this.addCustomMemberHandler);var b=obips.AnalysisEventManager.getInstance();b.addEventListener(new obips.AnalysisEventListener(obips.CustomMemberEvent.ADD_CUSTOM_MEMBER_TO_VIEW_EVENT,f))}};obips.PivotTable.prototype.addClientEventListener=function(f,a){if(f&&a){var e=f.split(",");for(var d=0;d<e.length;d++){var c=saw.trim(e[d]);var b=new obips.views.MaterDetailEventListener(c,new obips.Callback(this,this.clientEventHandler));this.clientEventListeners.push(b);obips.views.ViewController.getController(this.getViewID()).addEventListener(b)}}};obips.PivotTable.prototype.removeClientEventListeners=function(){for(var a=0;a<this.clientEventListeners.length;a++){obips.views.ViewController.getController(this.getViewID()).removeEventListener(this.clientEventListeners[a])}};obips.PivotTable.prototype.addCustomMemberHandler=function(b){if(b.viewID==null||this.viewName!=b.eventContext.viewName){return}var a=obips.Analysis.getReport(b.viewID);if(!a){return}obips.PivotTable.updateEdgeLayerWithViewOpts(a.getXML(),b)};obips.PivotTable.updateEdgeLayerWithViewOpts=function(e,i){var c=i.eventContext.viewName;var h=i.eventContext.customMemberId;var d=i.eventContext.column;var f=null;if(d){f=XUIGetAttributeString(d,"columnID","")}if(!f){return}var j=e.selectSingleNode(".//saw:column[@xsi:type='saw:switchGroupColumn'][//saw:choice/saw:column[@columnID="+saw.createXPathStringLiteral(f)+"]]");if(j){f=XUIGetAttributeString(j,"columnID")}var k=e.selectSingleNode("./saw:views");if(k){var g=e.selectSingleNode("./saw:views/saw:view[@name="+saw.createXPathStringLiteral(c)+"]");if(g){var l=g.selectSingleNode("./saw:edges//saw:edgeLayer[@columnID="+saw.createXPathStringLiteral(f)+"]");if(l){var b=XUIForceSingleNode(l,saw.xml.kSawNamespace,"customMembers");var a=XUIAppendNewElement(b,saw.xml.kSawNamespace,"customMember");XUISetAttributeString(a,"customMemberID",h);XUISetAttributeBool(a,"displayCustomMember",true)}}}};obips.PivotTable.prototype.includeCustomMemberToViewHandler=function(c,a){var g=this.getViewXML();var f=g.selectSingleNode(".//saw:edgeLayers/saw:edgeLayer[@columnID="+saw.createXPathStringLiteral(a.columnID)+"]//saw:customMember[@customMemberID="+saw.createXPathStringLiteral(a.custMemberId)+"]");if(f){XUISetAttributeBool(f,"displayCustomMember",true)}if(!f){var e=g.selectSingleNode("./saw:edges//saw:edgeLayer[@columnID="+saw.createXPathStringLiteral(a.columnID)+"]");var b=XUIForceSingleNode(e,saw.xml.kSawNamespace,"customMembers");var d=XUIAppendNewElement(b,saw.xml.kSawNamespace,"customMember");XUISetAttributeString(d,"customMemberID",a.custMemberId);XUISetAttributeBool(d,"displayCustomMember",true)}this.updateReport(true)};obips.PivotTable.prototype.excludeCustomMemberFromViewHandler=function(c,a){var g=this.getViewXML();var f=g.selectSingleNode(".//saw:edgeLayers/saw:edgeLayer[@columnID="+saw.createXPathStringLiteral(a.columnID)+"]//saw:customMember[@customMemberID="+saw.createXPathStringLiteral(a.custMemberId)+"]");if(f){XUISetAttributeBool(f,"displayCustomMember",false)}if(!f){var e=g.selectSingleNode("./saw:edges//saw:edgeLayer[@columnID="+saw.createXPathStringLiteral(a.columnID)+"]");var b=XUIForceSingleNode(e,saw.xml.kSawNamespace,"customMembers");var d=XUIAppendNewElement(b,saw.xml.kSawNamespace,"customMember");XUISetAttributeString(d,"customMemberID",a.custMemberId);XUISetAttributeBool(d,"displayCustomMember",false)}this.updateReport(true)};obips.PivotTable.prototype.clientEventHandler=function(a){var b=this.selectPageForMasterDetailEvent(this.getMasterClientID(),a);if(b){this.removeClientEventListeners()}};obips.PivotTable.prototype.addTouchHandlers=function(b){if(saw.userAgent.is_touchdevice){var c=this.getHtmlElement();var a=new obips.view.TouchTapAndLongPressHandler(null,null,obips.PivotTable.handleTouchLongPress);a.addTouchTapAndLongPressSupport(c)}};obips.PivotTable.prototype.addLeftClickBlockingDiv=function(a){var c=this.getHtmlElement();var b=document.getElementById(a+"leftClickBlockingDiv");if(!b){b=document.createElement("div");b.id=a+"leftClickBlockingDiv";b.style.position="absolute";b.style.top="0px";b.style.left="0px";b.style.width=c.offsetWidth+"px";b.style.height=c.offsetHeight+"px";b.style.backgroundColor="blue";b.style.opacity="0";b.style.zIndex=1001;saw.disableSelectionOnNode(b);c.appendChild(b)}obips.PivotTable.lastLeftClickBlockingDiv=b;saw.addEventListener(b,"click",obips.PivotTable.clearLeftClickBlockingDiv)};obips.PivotTable.clearLeftClickBlockingDiv=function(){if(obips.PivotTable.lastLeftClickBlockingDiv){obips.PivotTable.lastLeftClickBlockingDiv.parentNode.removeChild(obips.PivotTable.lastLeftClickBlockingDiv);obips.PivotTable.lastLeftClickBlockingDiv=null}};obips.PivotTable.onTouchStart=function(b){obips.PivotTable.lastTouchX=b.touches[0].pageX;obips.PivotTable.lastTouchY=b.touches[0].pageY;var d=saw.getEventTarget(b);if(d){var a=obips.EdgeCoords.findCoords(d);obips.PivotTable.hideLastRolloverLabel();if(a){var f=a.getId();var e=a.getEdge();var c=a.getLayer();masterPivotTable.showRolloverLabel(f,e,c)}}};obips.PivotTable.onTouchMove=function(a){};obips.PivotTable.onTouchEnd=function(a){obips.PivotTable.hideLastRolloverLabel()};obips.PivotTable.isLongTouchWithinRadius=function(b,a){if(b<a-obips.PivotTable.TOUCH_RADIUS_FOR_LONG_TOUCH||b>a+obips.PivotTable.TOUCH_RADIUS_FOR_LONG_TOUCH){return false}return true};obips.PivotTable.handleTouchLongPress=function(d){var c=d.touches[0].pageX;var a=d.touches[0].pageY;if(!obips.PivotTable.isLongTouchWithinRadius(c,obips.PivotTable.lastTouchX)||!obips.PivotTable.isLongTouchWithinRadius(a,obips.PivotTable.lastTouchY)){return}var e=saw.getEventTarget(d);var b=obips.EdgeCoords.findCoords(e);if(b){var g=obips.ViewModel.getViewModelById(b.getId());if(g){g.addLeftClickBlockingDiv(b.getId());obips.PivotTable.onContextMenu(d);return false}}var f=obips.DatabodyCoords.findCoords(e);if(f){var g=obips.ViewModel.getViewModelById(f.getId());if(g){g.addLeftClickBlockingDiv(f.getId());obips.PivotTable.onContextMenu(d);return false}}};obips.PivotTable.prototype.registerChildView=function(b,a){obips.PivotTable.superClass.registerChildView.call(this,b,a);this.checkLegendLoadedAndSize(a)};obips.PivotTable.notifyLegendImgLoaded=function(a,b){var c=obips.ViewModel.getViewModelById(a);if(c){c.checkLegendLoadedAndSize(a)}};obips.PivotTable.prototype.checkLegendLoadedAndSize=function(a){var c=document.getElementById(a+"Legend");if(c){var b=this;if(!saw.userAgent.is_touchdevice){b.registerAndSizeLegend(a)}else{window.setTimeout(function(){b.registerAndSizeLegend(a)},1)}}};obips.PivotTable.prototype.registerAndSizeLegend=function(e){var i=e+"Legend";var b=document.getElementById(i);var g=document.getElementById(e);if(g){var h=g.offsetHeight;if(typeof(h)!="undefined"){var f=(XUIGetAttributeString(b,"tob","f")=="t");if(!saw.userAgent.is_touchdevice){b.style.overflow="hidden"}else{b.style.overflow="scroll"}b.style.position="relative";b.style.border="1px solid #CCCCCC";var a=b.childNodes[0];a.cellPadding="0";a.width="100%";if(!f){h-=2;for(var d=0;d<a.rows.length;d++){a.rows[d].cells[0].style.borderLeft="none";a.rows[d].cells[0].style.borderRight="none";if(d==0){a.rows[d].cells[0].style.borderTop="none"}if(d==a.rows.length-1){a.rows[d].cells[0].style.borderBottom="none"}}}else{for(var d=0;d<a.rows.length;d++){for(var j=0;j<a.rows[d].cells.length;j++){a.rows[d].cells[j].style.border="none";if(d!=0){a.rows[d].cells[j].style.borderTop="1px solid #CCCCCC"}}}}if(f&&h>75){h=75}if(h<b.offsetHeight){b.style.height=h+"px";if(!saw.userAgent.is_touchdevice){saw.addEventListener(b,"mouseover",obips.PivotTable.onLegendMouseOver);saw.addEventListener(b,"mouseout",obips.PivotTable.onLegendMouseOut)}}if(saw.userAgent.is_touchdevice){var k={onScrollStart:function(c){obips.PivotTable.legendMoveStart(b)},onScrollEnd:function(c){obips.PivotTable.legendMoveEnd(b)}};new iScroll(i,k)}}}};obips.PivotTable.legendMoveStart=function(a){};obips.PivotTable.legendMoveEnd=function(a){};obips.PivotTable.getLegendElement=function(a){var b=saw.getEventTarget(a);while((b&&b.tagName!="DIV"&&b.parentNode)||b.id==""){b=b.parentNode}return b};obips.PivotTable.onLegendMouseOver=function(a){var b=obips.PivotTable.getLegendElement(a);if(b){if(b.style.border){b.oldBorder=b.style.border}b.style.border="1px solid #84BAE7";if(!saw.userAgent.is_touchdevice){b.style.overflowY="scroll"}}};obips.PivotTable.onLegendMouseOut=function(a){var b=obips.PivotTable.getLegendElement(a);if(b){if(b.oldBorder){b.style.border="1px solid #CCCCCC"}if(!saw.userAgent.is_touchdevice){b.style.overflowY="hidden"}}};obips.PivotTable.DropTarget=function(b,a){obips.PivotTable.DropTarget.baseConstructor.call(this,b,a);if(b){this.setIsTarget(true)}this.scrollableElements=[document.getElementById("idViewPreviewDiv")]};saw.extend(obips.PivotTable.DropTarget,saw.dnd.SimpleDragObj);obips.PivotTable.prototype.getHtmlElement=function(){if(this.pivotContainer&&this.pivotContainer.id==this.containerId){return this.pivotContainer}this.pivotContainer=document.getElementById(this.containerId);return this.pivotContainer};obips.PivotTable.prototype.disableSelectionOnNode=function(){var a=this.getHtmlElement();if(saw.userAgent.is_ie){a.onselectstart=function(){var b=saw.getEventTarget(event);if(!obips.PivotTable.nodeAllowsFocus(b)){return false}}}if(is_nav){a.onmousedownFunc=a.onmousedown;a.onmousedown=function(b){var c=saw.getEventTarget(b);if(!obips.PivotTable.nodeAllowsFocus(c)){b.preventDefault()}}}};obips.PivotTable.prototype.getPageEdgeClientID=function(){return this.pageEdgeId};obips.PivotTable.getViewName=function(b){var a=obips.ViewModel.getViewModelById(b);if(a){return a.getViewName()}return null};obips.PivotTable.prototype.getMasterClientID=function(){return this.masterClientId};obips.PivotTable.isTable=function(b){var a=XUIGetAttributeString(b,"xsi:type");if(a=="saw:tableView"){return true}else{return false}};obips.PivotTable.containsNestedViews=function(b){var a=XUIGetAttributeString(b,"xsi:type");if(a=="saw:trellisView"){return true}else{return false}};obips.PivotTable.countNestedViews=function(c){var a=XUIGetAttributeString(c,"xsi:type");if(a=="saw:trellisView"){var b=c.selectNodes("saw:nestedViews/saw:nestedView[@position='embedded']/saw:view");return b.length}else{return 0}};obips.PivotTable.prototype.getColEdgeEffectiveRows=function(){return this.model.colEdgeEffectiveRows};obips.PivotTable.prototype.getRowEdgeEffectiveCols=function(){return this.model.rowEdgeEffectiveColumns};obips.PivotTable.prototype.getReportXML=function(){var a=obips.Analysis.getReport(this.reportStatePath);return a.getXML()};obips.PivotTable.prototype.getPivotViewXML=function(){var a=obips.Analysis.getReport(this.reportStatePath);if(a){var b=a.getView(this.getViewName());if(b){return b.getXML()}}return null};obips.PivotTable.prototype.getViewXML=function(){return this.getPivotViewXML()};obips.PivotTable.prototype.makeNewEdgeLayerElement=function(b,c){var a=XUICreateElement(saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(a,"type",b);XUISetAttributeString(a,"columnID",c);return a};obips.PivotTable.prototype.getMeasuresList=function(){var a=this.getPivotViewXML();return a.selectSingleNode("saw:measuresList")};obips.PivotTable.prototype.makeNewMeasure=function(b){var a=XUICreateElement(saw.xml.kSawNamespace,"measure");XUISetAttributeString(a,"columnID",b);return a};obips.PivotTable.prototype.getEdgeLayerElement=function(d,b,c,h){var g=this.getPivotViewXML();var a=null;if(c&&h){a=g.selectSingleNode(".//saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@columnID='"+c+"' and @duplicateID='"+h+"']")}else{var f=obips.JSDataLayout.getViewXMLEdgeName(d);var e=g.selectSingleNode("saw:edges/saw:edge[@axis='"+f+"']/saw:edgeLayers");a=XUIGetChildElement(e,b)}return a};obips.PivotTable.prototype.getMeasureLayerElement=function(b,d){var c=this.getPivotViewXML();var a=null;if(c){if(d){a=c.selectSingleNode(".//saw:measuresList/saw:measure[@columnID='"+b+"' and @duplicateID='"+d+"']")}else{a=c.selectSingleNode(".//saw:measuresList/saw:measure[@columnID='"+b+"']")}}return a};obips.PivotTable.prototype.viewSetGrandTotal=function(j,e,l){var h=j.getId();var i=this.getEdgeDefinition(h);var g=i.getLayerID(j.edge,j.layer);var f=obips.ViewModel.getReport(j);var k=f.getView(this.getViewName());var b=null;if(k){b=k.getXML();var n=b.selectSingleNode(".//saw:edges/saw:edge[@axis='"+l+"']");if(!n){var d=b.selectNodes(".//saw:edges");if(d){n=XUICreateFullXMLPath(d,"saw:edge[@axis='"+l+"']",true)}}var c=XUIForceSingleNode(n,saw.xml.kSawNamespace,"displayGrandTotals");var a=XUIForceSingleNode(c,saw.xml.kSawNamespace,"displayGrandTotal");obips.PivotTable.setGrandTotalID(a,l);var m=XUIGetAttributeString(a,"grandTotalPosition");if(m==""){XUISetAttributeString(a,"grandTotalPosition","none")}if(e){XUISetAttributeString(a,"grandTotalPosition",e)}this.updateReport(true)}return};obips.PivotTable.prototype.getGrandTotalChoice=function(a){var d=this.getViewXML();var c=d.selectSingleNode(".//saw:edges/saw:edge[@axis='"+a+"']");if(c){var b=c.selectSingleNode("./saw:displayGrandTotals/saw:displayGrandTotal");if(b){return XUIGetAttributeString(b,"grandTotalPosition")}}return null};obips.PivotTable.prototype.getSubTotalChoice=function(b){var d=this.getViewXML();var c=d.selectSingleNode(".//saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@columnID='"+b+"']");if(c){var a=c.selectSingleNode(".//saw:displaySubTotal");if(a){return XUIGetAttributeString(a,"subTotalPosition")}}return null};obips.PivotTable.prototype.viewSetLayerTotal=function(j,d){var h=j.getId();var i=this.getEdgeDefinition(h);var g=i.getLayerID(j.edge,j.layer);var e=obips.ViewModel.getReport(j);var k=e.getView(this.getViewName());var c=null;if(k){c=k.getXML();var n=c.selectSingleNode(".//saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@columnID='"+g+"']");var m=XUIForceSingleNode(n,saw.xml.kSawNamespace,"levels");var f=XUIForceSingleNode(m,saw.xml.kSawNamespace,"level");var a=XUIForceSingleNode(f,saw.xml.kSawNamespace,"displaySubTotal");var b=XUIGetAttributeString(a,"id");if(b==""){obips.PivotTable.setSubTotalID(a,n)}var l=XUIGetAttributeString(a,"subTotalPosition");if(l==""){XUISetAttributeString(a,"subTotalPosition","none")}if(d){XUISetAttributeString(a,"subTotalPosition",d)}this.updateReport(true)}return};obips.PivotTable.prototype.setToggleRunningSum=function(f,e){var g=f.getId();var h=null;var b=obips.ViewModel.getReport(f);var c=b.getView(this.getViewName());if(c){h=c.getXML();var d=this.getMeasureLayerElement(e);if(d){var a=d.getAttribute("running");a=(a==null||a=="false")?"true":"false";d.setAttribute("running",a)}this.updateReport(true)}};obips.PivotTable.prototype.isRunningSumEnabled=function(b){var c=this.getViewXML();var a=this.getMeasureLayerElement(b);if(a){return XUIGetAttributeBool(a,"running",false)}return false};obips.PivotTable.prototype.getDrillStateElement=function(b,a,f){if(this.getViewType()=="pivotchart"&&(b==obips.JSDataLayout.ROW_EDGE||b==obips.JSDataLayout.COLUMN_EDGE)){if(b==obips.JSDataLayout.ROW_EDGE){b=obips.JSDataLayout.COLUMN_EDGE}else{b=obips.JSDataLayout.ROW_EDGE}}var g=this.getPivotViewXML();var e=obips.JSDataLayout.getViewXMLEdgeName(b);var d=g.selectSingleNode("saw:edges/saw:edge[@axis='"+e+"']/saw:edgeLayers");var c=XUIGetChildElement(d,a);return this.forceOrRetrieveDrillStateNode(c,f)};obips.PivotTable.prototype.RegularColumnLayerDrill=function(c,b,a){if(!this.supportsFeature(obips.ViewRightClickMenu.FEATURE_DRILL)){return null}return obips.PivotTable.superClass.RegularColumnLayerDrill.call(this,c,b,a)};obips.PivotTable.prototype.RegularColumnDrill=function(d,c,b,e,a){if(!this.supportsFeature(obips.ViewRightClickMenu.FEATURE_DRILL)){return null}return obips.PivotTable.superClass.RegularColumnDrill.call(this,d,c,b,e,a)};obips.PivotTable.prototype.HierCollapse=function(e,d,b,f,c){var g=this.getPivotViewXML();if(!g){return}if(!this.supportsFeature(obips.ViewRightClickMenu.FEATURE_DRILL)){return}var a=obips.PivotTable.superClass.HierCollapse.call(this,e,d,b,f,c);this.updateReport(true,"hierDrill",{startRow:this.startRow})};obips.PivotTable.prototype.HierDrill=function(g,a,e,i,f,b,h){var d=this.getPivotViewXML();if(!d){return}if(!this.supportsFeature(obips.ViewRightClickMenu.FEATURE_DRILL)){return}var c=obips.PivotTable.superClass.HierDrill.call(this,g,a,e,i,f,b);this.removeInvalidDrillsIfHiddenLevelsExist(c,g,a,e);if(typeof(h)=="undefined"||h){this.updateReport(true,"hierDrill",{startRow:this.startRow})}};obips.PivotTable.onMouseOut=function(c){if(obips.PivotTable.ptDragCoords&&obips.PivotTable.ptDragCoords.inUse){var d=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);if(d){var f=saw.getEventTarget(c);if(f==obips.PivotTable.ptColumnBeingDragged){return}var g=d.getHtmlElement();var a=c.relatedTarget?c.relatedTarget:c.toElement;if(a==obips.PivotTable.ptColumnBeingDragged){return}while(a&&a.nodeName!="BODY"&&a!=g&&a!=obips.PivotTable.ptColumnBeingDragged){a=a.parentNode}if(a&&(a==g||a==obips.PivotTable.ptColumnBeingDragged)){return}var e=d.getChildViewModelIdList();d.clearLastVisibleDropLayer(e);d.unhighlightCellsAndClearSel(obips.PivotTable.ptDragCoords.childPivotClientId)}}var f=saw.getEventTarget(c);var b=obips.EdgeCoords.findCoords(f);if(!b){obips.PivotTable.hideLastRolloverLabel();obips.PivotTable.hideLastGrabHandle()}};obips.PivotTable.onMouseUp=function(b){if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.SELECTION_EVENT){obips.PivotTable.eventComplete()}if(obips.PivotTable.ptDragCoords&&obips.PivotTable.ptDragCoords.inUse){var e=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);if(e){var f=e.getChildViewModelIdList();e.clearLastVisibleDropLayer(f);e.unhighlightCellsAndClearSel(obips.PivotTable.ptDragCoords.childPivotClientId);if(obips.PivotTable.ptColumnBeingDragged){e.getHtmlElement().removeChild(obips.PivotTable.ptColumnBeingDragged);obips.PivotTable.ptColumnBeingDragged=null}obips.PivotTable.ptDragCoords.inUse=false;obips.PivotTable.ptDropCoords.inUse=false;obips.PivotTable.eventComplete()}}var d=saw.getEventTarget(b);var a=obips.EdgeCoords.findCoords(d);if(a!=undefined){var e=obips.ViewModel.getViewModelById(a.getId());if(e&&e.handleEndRowColResize){e.handleEndRowColResize(b,d,true,a)}}else{var c=obips.DatabodyCoords.findCoords(d);if(c!=undefined){var e=obips.ViewModel.getViewModelById(c.getId());if(e&&e.handleEndRowColResize){e.handleEndRowColResize(b,d,false,c)}}}};obips.PivotTable.onMouseMove=function(b){if(obips.PivotTable.mouseMove){return}obips.PivotTable.mouseMove=true;var d=saw.getEventTarget(b);if(obips.PivotTable.ptDragCoords.inUse&&obips.PivotTable.ptColumnBeingDragged){var e=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);var f=e.getHtmlElement();obips.PivotTable.ptColumnBeingDragged.style.top=saw.calcRelativePositionY(f,b)+5+"px";obips.PivotTable.ptColumnBeingDragged.style.left=saw.calcRelativePositionX(f,b)+5+"px"}if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.SELECTION_EVENT){obips.PivotTable.handleSelectionDrag(b,d)}else{if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.DROP_COLUMN_MEMBER_EVENT){}else{if(obips.EdgeCoords.findCoords(d)!=null){var a=obips.EdgeCoords.findCoords(d);obips.PivotTable.handlePivotSwapDrag(b,d,a,"edge");var e=obips.ViewModel.getViewModelById(a.getId());if(e){e.handleMouseMoveRowColResize(b,d,true,a)}}else{if(obips.DatabodyCoords.findCoords(d)!=null){var c=obips.DatabodyCoords.findCoords(d);obips.PivotTable.handlePivotSwapDrag(b,d,c,"databody");var e=obips.ViewModel.getViewModelById(c.getId());if(e){e.handleMouseMoveRowColResize(b,d,false,c)}}}}}obips.PivotTable.mouseMove=false};obips.PivotTable.onPivotContainerDragOut=function(b){var c=saw.getEventTarget(b);var a=obips.EdgeCoords.findCoords(c);if(a){var d=obips.ViewModel.getViewModelById(a.getId());if(d){if(d.fetchViewModelTimeout){obips.ViewModelBase.log("Adding timeout to clear fetch view models");d.clearFetchViewModelTimeout=window.setTimeout(function(){obips.PivotTable.clearFetchViewModelTimeout(d)},5)}}}};obips.PivotTable.clearFetchViewModelTimeout=function(a){if(a.fetchViewModelTimeout){obips.ViewModelBase.log("Clearing fetch view model timeout");clearTimeout(a.fetchViewModelTimeout);a.fetchViewModelTimeout=null}};obips.PivotTable.onPivotContainerDragOver=function(j){var e=saw.getEventTarget(j);var k=obips.EdgeCoords.findCoords(e);if(k){var g=obips.ViewModel.getViewModelById(k.getId());if(g){if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.NO_EVENT){var c=k.getEdge();var f=k.getLayer();var h=k.getSlice();var d=g.getPivotViewXML();var i=obips.PivotTable.isTable(d);g.showSortsIfNecessary(j,i,c,f,h,e,k)}var a=g.getMasterClientID();obips.PivotTable.resetSelectionFocus(a)}}else{var b=obips.DatabodyCoords.findCoords(e);if(b){var g=obips.ViewModel.getViewModelById(b.getId());if(g){var a=g.getMasterClientID();obips.PivotTable.resetSelectionFocus(a)}}}obips.PivotTable.hideSortIcons(e,k)};obips.PivotTable.prototype.showSortsIfNecessary=function(h,g,a,c,f,b,i){if(i){var e=i.getId();var d=obips.ViewModel.getViewModelById(e);if(d&&!d.supportsFeature(obips.ViewRightClickMenu.FEATURE_SORT)){return}}obips.PivotTable.showSortIcons(h,b,i)};obips.PivotTable.prototype.shouldAllowSorts=function(l,b,e,j,k){if(!k){return false}var a=k.isMeasureLabelsLayer(b,e);var d=k.isLayerLevelAttribute(b,e);if(d){return false}var g=k.getLayerCount(b)-1;var f=false;if(b==obips.JSDataLayout.SECTION_EDGE||b==obips.JSDataLayout.PAGE_EDGE){f=true}if(f){if(j==-1&&!a){return true}else{return false}}var i=k.itemIsSubTotal(b,e,j);var c=k.itemIsGrandTotal(b,e,j);var h=(i||c);if(h||k.isItemCalcItem(b,e,j)||k.isItemCustomGroup(b,e,j)){return false}if(j==-1&&!a){return true}if(j==-1&&a){return false}if(l){return false}if((b==obips.JSDataLayout.ROW_EDGE&&k.getColLayerCount()>1)||(b==obips.JSDataLayout.COLUMN_EDGE&&k.getRowLayerCount()>1)||(b==obips.JSDataLayout.ROW_EDGE&&g==e&&k.getColLayerCount()==1&&!k.isMeasureLabelsLayer(obips.JSDataLayout.COLUMN_EDGE,0))||(b==obips.JSDataLayout.COLUMN_EDGE&&g==e&&k.getRowLayerCount()==1&&!k.isMeasureLabelsLayer(obips.JSDataLayout.ROW_EDGE,0))||(b==obips.JSDataLayout.ROW_EDGE&&j==-1)){if(j!=-1){if(b==obips.JSDataLayout.ROW_EDGE&&k.getRowLayerCount()==(e+1)||b==obips.JSDataLayout.COLUMN_EDGE&&k.getColLayerCount()==(e+1)){return true}else{return false}}return true}return false};PTPSS=function(l,d){var m=obips.EdgeCoords.findCoords(d);var h=m.getId();var c=m.getEdge();var e=m.getLayer();var j=m.getSlice();var g=obips.ViewModel.getViewModelById(h);if(!g||(g&&obips.PivotTable.isRuntimeMode()&&!g.supportsFeature(obips.ViewRightClickMenu.FEATURE_PIVOT_SWAP))){return}obips.PivotTable.ptCurrentEvent.eventType=obips.ViewModel.EventType.PIVOT_SWAP_EVENT;obips.PivotTable.ptCurrentEvent.eventSrc=h;obips.PivotTable.ptDragCoords.inUse=true;obips.PivotTable.ptDragCoords.edge=c;obips.PivotTable.ptDragCoords.layer=e;obips.PivotTable.ptDragCoords.slice=j;obips.PivotTable.ptDragCoords.childPivotClientId=h;var k=d;var b=obips.PivotTable.resolveMouseX(l.clientX);var n=obips.PivotTable.resolveMouseY(l.clientY);while(k&&k.tagName!="TABLE"){k=k.parentNode}var a=document.createElement("span");a.style.position="absolute";a.style.padding="0px";a.style.margin="0px";a.style.top="0px";a.style.left="0px";a.style.padding="0px";a.style.zIndex=4;var i=k.cloneNode(true);if(c==obips.JSDataLayout.COLUMN_EDGE||c==obips.JSDataLayout.SECTION_EDGE||c==obips.JSDataLayout.PAGE_EDGE){a.style.width="9px";a.style.height="17px";i.rows[0].cells[1].style.display=""}else{if(c==obips.JSDataLayout.ROW_EDGE){a.style.width="150px";i.rows[1].style.display=""}}a.appendChild(i);obips.PivotTable.ptColumnBeingDragged=a;var f=g.getHtmlElement();obips.PivotTable.ptColumnBeingDragged.style.top=saw.calcRelativePositionY(f,l)+5+"px";obips.PivotTable.ptColumnBeingDragged.style.left=saw.calcRelativePositionX(f,l)+5+"px";f.appendChild(a)};obips.PivotTable.hideSortIcons=function(c,a){if(obips.PivotTable.ptLastVisibleScrollImages.one!=null){var b=obips.PivotTable.ptLastVisibleScrollImages.one.edgeCoords;if(!a||a.getEdge()!=b.getEdge()||a.getLayer()!=b.getLayer()||a.getSlice()!=b.getSlice()){if(XUIGetAttributeString(obips.PivotTable.ptLastVisibleScrollImages.one,"p","f")!="t"||XUIGetAttributeString(obips.PivotTable.ptLastVisibleScrollImages.two,"p","f")!="t"){obips.PivotTable.ptLastVisibleScrollImages.one.src=WebScriptMapGet(obips.PivotTable.SORT_IMAGE_PLACEHOLDER);obips.PivotTable.ptLastVisibleScrollImages.two.src=WebScriptMapGet(obips.PivotTable.SORT_IMAGE_PLACEHOLDER)}else{obips.PivotTable.ptLastVisibleScrollImages.one.src=obips.PivotTable.ptLastVisibleScrollImages.one.oldSrc;obips.PivotTable.ptLastVisibleScrollImages.two.src=obips.PivotTable.ptLastVisibleScrollImages.two.oldSrc}obips.PivotTable.ptLastVisibleScrollImages.one.alt="";obips.PivotTable.ptLastVisibleScrollImages.two.alt="";var d=obips.PivotTable.ptLastVisibleScrollImages.one.parentNode;if(d&&d.nodeName=="DIV"){d.style.display="none"}obips.PivotTable.ptLastVisibleScrollImages.one=null;obips.PivotTable.ptLastVisibleScrollImages.two=null}}};PTSrtLyr=function(b,g){saw.stopEventPropagationAndNotify(g);var h=obips.EdgeCoords.findCoords(b);var e=h.getId();var a=h.getEdge();var c=h.getLayer();var f=h.getSlice();var d=obips.ViewModel.getViewModelById(e);if(!d||!d.supportsFeature(obips.ViewRightClickMenu.FEATURE_SORT)){return}c=d.getPhysicalLayer(a,c);var i=b;if(XUIGetAttributeString(i,"si","")!=""){if(XUIGetAttributeString(i,"f","f")=="t"){d.SortLayer(e,a,c,obips.PivotTable.SORT_ASC,true)}else{d.SortLayer(e,a,c,obips.PivotTable.SORT_DESC,true)}}};obips.PivotTable.prototype.sortMenuHandler=function(c,l,i,g){var k=c;var f=k.getId();var a=k.getEdge();var d=k.getLayer();var h=h?h:k.getSlice();var e=obips.ViewModel.getViewModelById(f);if(!e||!e.supportsFeature(obips.ViewRightClickMenu.FEATURE_SORT)){NQWClearActiveMenu();return}d=e.getPhysicalLayer(a,d);var b=e.getPivotViewXML();if(!b){return}var j=obips.PivotTable.isTable(b);if(h==-1||j||a==obips.JSDataLayout.PAGE_EDGE||a==obips.JSDataLayout.SECTION_EDGE){e.SortLayer(f,a,d,l,i)}else{e.Sort(f,a,d,h,l,i,g)}NQWClearActiveMenu()};obips.PivotTable.prototype.SortLayer=function(v,f,t,n,u){var p=obips.ViewModel.getViewModelById(v);var c=p.getPivotViewXML();if(!c){return}var s=obips.PivotTable.isTable(c);var e=this.getEdgeDefinition(v);var o=e.getLayerCount(f);if(u){this.removeSorts(f,o,e,c)}var k=obips.JSDataLayout.getViewXMLEdgeName(f);var q=c.selectSingleNode("saw:edges/saw:edge[@axis='"+k+"']");var h=XUIForceSingleNode(q,saw.xml.kSawNamespace,"columnOrder");var d=e.isMeasureLayer(f,t);var l=false;if(s&&(f==obips.JSDataLayout.ROW_EDGE||f==obips.JSDataLayout.COLUMN_EDGE)){var g=e.getLayerCount(obips.JSDataLayout.ROW_EDGE);for(var m=0;m<g;m++){var j=e.isLayerHierarchical(obips.JSDataLayout.ROW_EDGE,m);if(j){l=true;break}}}if(s&&d&&l){var r=XUICreateElement(saw.xml.kSawNamespace,"QDR");var b=XUICreateElement(saw.xml.kSawNamespace,"selectionGroups");this._addQDRDefinitionForLayer(e,r,b,f,t,0,true,false);var g=e.getLayerCount(obips.JSDataLayout.ROW_EDGE);for(var m=0;m<g;m++){var i=XUICreateElement(saw.xml.kSawNamespace,"columnOrderRef");var a=e.getLayerID(f,m);XUISetAttributeString(i,"columnID",a);if(n==obips.PivotTable.SORT_ASC){XUISetAttributeString(i,"direction",obips.PivotTable.SORT_ASC)}else{XUISetAttributeString(i,"direction",obips.PivotTable.SORT_DESC)}i.appendChild(r.cloneNode(true));h.appendChild(i)}}else{var i=XUICreateElement(saw.xml.kSawNamespace,"columnOrderRef");var a=e.getLayerID(f,t);if(a==""){return}XUISetAttributeString(i,"columnID",a);if(n==obips.PivotTable.SORT_ASC){XUISetAttributeString(i,"direction",obips.PivotTable.SORT_ASC)}else{XUISetAttributeString(i,"direction",obips.PivotTable.SORT_DESC)}h.appendChild(i)}this.updateReport(true,"xmlAndStateAction",{gridViewEvent:"sortLayer"})};PTSrt=function(c,j){saw.stopEventPropagationAndNotify(j);var k=obips.EdgeCoords.findCoords(c);var f=k.getId();var a=k.getEdge();var d=k.getLayer();var g=k.getSlice();var e=obips.ViewModel.getViewModelById(f);if(!e||!e.supportsFeature(obips.ViewRightClickMenu.FEATURE_SORT)){return}var b=e.getPivotViewXML();if(!b){return}d=e.getPhysicalLayer(a,d);var i=obips.PivotTable.isTable(b);var h=e.getEdgeDefinition(f);if(i||a==obips.JSDataLayout.ROW_EDGE&&h.getColLayerCount()>1||a==obips.JSDataLayout.COLUMN_EDGE&&h.getRowLayerCount()>1||a==obips.JSDataLayout.ROW_EDGE&&h.getColLayerCount()==1&&!h.isMeasureLabelsLayer(obips.JSDataLayout.COLUMN_EDGE,0)||a==obips.JSDataLayout.COLUMN_EDGE&&h.getRowLayerCount()==1&&!h.isMeasureLabelsLayer(obips.JSDataLayout.ROW_EDGE,0)||a==obips.JSDataLayout.ROW_EDGE&&k.getSlice()==-1){var l=c;if(XUIGetAttributeString(l,"si","")!=""){if(XUIGetAttributeString(l,"f","f")=="t"){e.Sort(f,a,d,g,obips.PivotTable.SORT_ASC,true)}else{e.Sort(f,a,d,g,obips.PivotTable.SORT_DESC,true)}}}};obips.PivotTable.handleMasterDetail=function(l,p){if(l&&!p){var a=l;var s=a.getId();var g=a.getEdge();var q=a.getLayer();var k=a.getSlice();var b=a.getElement();var n=obips.ViewModel.getViewModelById(s);if(n){var e=n.getEdgeDefinition(s);if(b){var j=saw.json.parse(b.getAttribute("obips-clevt"),true);if(j){obips.ViewModelBase.log("handle master-detail edge");var d=new obips.QDR();var o=d.getQDR(e,null,e.getColLayerCount(),e.getRowLayerCount(),g,q,k,true);var r=new obips.views.MasterDetailEvent(n.getViewID(),o);obips.views.ViewController.getController(n.getViewID()).postClientEvent(j.ch,r)}}}}else{if(l&&p){var i=l;var s=i.getId();var h=i.getRow();var f=i.getCol();var b=i.getElement();var n=obips.ViewModel.getViewModelById(s);if(n){var c=n.getViewXML();var m=n.getBodyDefinition(s);if(obips.PivotTable.containsNestedViews(c)&&!obips.PivotTable.isShowingNumbers(c,m.getID(h,f))){return}var e=n.getEdgeDefinition(s);if(b){var j=saw.json.parse(b.getAttribute("obips-clevt"),true);if(j){obips.ViewModelBase.log("handle master-detail body");var d=new obips.QDR();var o=d.getQDR(e,null,e.getColLayerCount(),e.getRowLayerCount(),obips.JSDataLayout.DATA_EDGE,h,f,true);var r=new obips.views.MasterDetailEvent(n.getViewID(),o);obips.views.ViewController.getController(n.getViewID()).postClientEvent(j.ch,r)}}}}}};obips.PivotTable.masterDetailMenuHandler=function(){var a=obips.PivotTable.ptCurrentEvent.eventData;obips.PivotTable.handleMasterDetail(a,a.bDatabody)};obips.PivotTable.removeUserState=function(c){var a=obips.ViewModel.getViewModelById(c);var d=a.getPivotViewXML();if(c){var b=XUIForceSingleNode(d,saw.xml.kSawNamespace,"pageEdgeState");if(b){b.parentNode.removeChild(b)}}obips.ViewModel.removeHierDrills(c)};obips.PivotTable.prototype.getSelectedMembersFromView=function(h,p,k,f,g){var i=h.getUniqueSelectedCells();var n=0;for(var l in i){var c=i[l];var a=obips.EdgeCoords.findCoords(c);var r=a.getId();var d=obips.ViewModel.getViewModelById(r);var h=d.getEdgeDefinition(r);var q=d.getPhysicalLayer(a.edge,a.layer);var j=h.isItemCustomGroup(a.edge,q,a.slice);var o=h.isItemCalcItem(a.edge,q,a.slice);var m=h.getLayerID(a.edge,q);if(j||o){var e=h.getID(a.edge,q,a.slice);var b=new Object();b.itemID=e;b.columnID=m;b.isCustomGroup=j;b.isCalcItem=o;k.push(b);continue}var b=new Object();b.keyValue=h.getID(a.edge,q,a.slice);b.displayValue=h.getSliceValue(a.edge,q,a.slice);b.name=b.displayValue;if(f){b.levelId=h.getLevelID(a.edge,q,a.slice,d.reportStatePath,m);b.levelName=b.levelId;if(g){p.push(b)}else{p[n]=new Array();p[n].push(b)}n++}else{p.push(b)}}};obips.PivotTable.prototype.addQDRDefinitionForFirstVisibleMeasure=function(f,h,d,a){var c=this.findFirstMeasureEdgeAndLayer(f,h);var b=c.l;var e=c.e;if(b!=-1){var g=0;if(e==obips.JSDataLayout.SECTION_EDGE){g=h.getCurrentSectionSlice()}else{g=this.findFirstSliceStartingAtSpecifiedLayer(h,e,b,g)}this._addQDRDefinitionForLayer(h,d,a,e,b,g,true,false)}else{alert("Error: Unable to add measure column to sort")}};obips.PivotTable.prototype.findFirstSliceStartingAtSpecifiedLayer=function(e,b,a,d){var c=e.getStartLayer(b,a,d);while(c!=a&&d<e.getEdgeExtent(b)){d++;c=e.getStartLayer(b,a,d)}if(c!=a){return 0}return d};obips.PivotTable.prototype.findFirstSliceAtSpecifiedLayer=function(f,d,c){var g=d==obips.JSDataLayout.ROW_EDGE?this.model.rowEdgeEffectiveColumns:this.model.colEdgeEffectiveRows;for(var b=0;b<=g;b++){var e="e_"+f+"_"+d+"_"+c+"_"+b;var a=document.getElementById(e);if(a){if(d==obips.JSDataLayout.ROW_EDGE&&(!a.colSpan||a.colSpan==1)||d==obips.JSDataLayout.COLUMN_EDGE&&(!a.rowSpan||a.rowSpan==1)){return b}}}return 0};obips.PivotTable.prototype.findFirstMeasureEdgeAndLayer=function(c,d){var b=obips.JSDataLayout.COLUMN_EDGE;var a=this.getLayerPosIfMeasureLabelsOnEdge(d,b);if(a==-1){b=obips.JSDataLayout.ROW_EDGE;a=this.getLayerPosIfMeasureLabelsOnEdge(d,b)}if(a==-1){b=obips.JSDataLayout.SECTION_EDGE;a=this.getLayerPosIfMeasureLabelsOnEdge(d,b)}if(a==-1){b=obips.JSDataLayout.PAGE_EDGE;a=this.getLayerPosIfMeasureLabelsOnEdge(d,b)}return{e:b,l:a}};obips.PivotTable.prototype.getLayerPosIfMeasureLabelsOnEdge=function(d,b){var c=d.getLayerCount(b);for(var a=0;a<c;a++){if(d.isMeasureLabelsLayer(b,a)){return a}}return -1};obips.PivotTable.prototype.isMeasureLabelsLayerOnSameEdge=function(d,b,e){var c=(b==obips.JSDataLayout.ROW_EDGE)?e.getRowLayerCount():e.getColLayerCount();for(var a=0;a<c;a++){if(e.isMeasureLabelsLayer(b,a)){return true}}return false};obips.PivotTable.prototype.Sort=function(u,g,s,k,n,t,b){var o=obips.ViewModel.getViewModelById(u);var d=o.getPivotViewXML();if(!d){return}var f=this.getEdgeDefinition(u);var r=(g==obips.JSDataLayout.ROW_EDGE)?obips.JSDataLayout.COLUMN_EDGE:obips.JSDataLayout.ROW_EDGE;var m=(g==obips.JSDataLayout.ROW_EDGE)?f.getColLayerCount():f.getRowLayerCount();if(t){this.removeSorts(r,m,f,d)}var j=obips.JSDataLayout.getViewXMLEdgeName(r);var p=d.selectSingleNode("saw:edges/saw:edge[@axis='"+j+"']");var h=XUIForceSingleNode(p,saw.xml.kSawNamespace,"columnOrder");var q=XUICreateElement(saw.xml.kSawNamespace,"QDR");var c=XUICreateElement(saw.xml.kSawNamespace,"selectionGroups");for(var l=0;l<=s;l++){this._addQDRDefinitionForLayer(f,q,c,g,l,k,true,false)}if(!this.isMeasureLabelsLayerOnSameEdge(u,g,f)){if(b==null){this.addQDRDefinitionForFirstVisibleMeasure(u,f,q,c)}else{this.addQDRDefinitionForSpecificMeasure(q,b)}}for(var l=0;l<m;l++){var e=f.isMeasureLabelsLayer(r,l);if(e){continue}var i=XUICreateElement(saw.xml.kSawNamespace,"columnOrderRef");var a=f.getLayerID(r,l);if(a==""){continue}XUISetAttributeString(i,"columnID",a);if(n==obips.PivotTable.SORT_ASC){XUISetAttributeString(i,"direction",obips.PivotTable.SORT_ASC)}else{XUISetAttributeString(i,"direction",obips.PivotTable.SORT_DESC)}i.appendChild(q.cloneNode(true));h.appendChild(i)}this.updateReport(true,"xmlAndStateAction",{gridViewEvent:"sortMember"})};obips.PivotTable.prototype.removeSorts=function(b,j,l,f){var c=obips.JSDataLayout.getViewXMLEdgeName(b);var h=f.selectSingleNode("saw:edges/saw:edge[@axis='"+c+"']");var e=h.selectSingleNode(".//saw:columnOrder");var n=[];if(e){var m=e.selectNodes("saw:columnOrderRef");if(m.length>0){for(var a=0;a<j;a++){var k=l.getLayerID(b,a);for(var g=0;g<m.length;g++){var d=m[g];if(XUIGetAttributeString(d,"columnID","")==k){n.push(d)}}}}}for(var g=0;g<n.length;g++){e.removeChild(n[g])}};obips.PivotTable.prototype.getSortIconPosition=function(e,b){var a=this.getHtmlElement();var c=obips.PivotTable.calcTopBetweenElements(e,a);var d=obips.PivotTable.calcLeftBetweenElements(e,a);return{xPos:d,yPos:c}};obips.PivotTable.prototype.positionSortIcons=function(e,a){var f=e.parentNode;if(f.nodeName!="DIV"){return}var g=f.parentNode;while(g&&g.id==""){g=g.parentNode}var c=this.getSortIconPosition(g,a);var d=g.offsetWidth;var b=28;if(e.offsetWidth&&e.offsetWidth>0){b=e.offsetWidth*2}var f=e.parentNode;f.style.top=c.yPos+3+"px";f.style.left=c.xPos+d-(b+1)+"px";f.style.width=b+"px";f.style.position="absolute";f.style.display="";f.style.zIndex="3"};obips.PivotTable.showSortIcons=function(j,d,k){obips.PivotTable.hideSortIcons(d,k);var f=k.getId();var e=obips.ViewModel.getViewModelById(f);if(!e||!e.supportsFeature(obips.ViewRightClickMenu.FEATURE_SORT)){return}var a=k.getEdge();var c=k.getSlice()==-1;var h=k.getElement();var g=h.getElementsByTagName("img");if(g.length>=2){for(var b=0;b<g.length;b++){var l=g[b];if(XUIGetAttributeString(l,"si","")!=""){if(b==0){e.positionSortIcons(l,k)}if(!l.oldSrc){l.oldSrc=l.src}if(XUIGetAttributeString(l,"f","f")=="t"){obips.PivotTable.ptLastVisibleScrollImages.one=l;obips.PivotTable.ptLastVisibleScrollImages.one.edgeCoords=k;if((a==obips.JSDataLayout.ROW_EDGE&&!c)||(c&&a==obips.JSDataLayout.COLUMN_EDGE)){if(l==d){l.src=WebScriptMapGet(obips.PivotTable.SORT_IMAGE_LT_MO)}else{l.src=l.oldSrc}}else{if(l==d){l.src=WebScriptMapGet(obips.PivotTable.SORT_IMAGE_ASC_MO)}else{l.src=l.oldSrc}}}else{obips.PivotTable.ptLastVisibleScrollImages.two=l;if((a==obips.JSDataLayout.ROW_EDGE&&!c)||(c&&a==obips.JSDataLayout.COLUMN_EDGE)){if(l==d){l.src=WebScriptMapGet(obips.PivotTable.SORT_IMAGE_RT_MO)}else{l.src=l.oldSrc}}else{if(l==d){l.src=WebScriptMapGet(obips.PivotTable.SORT_IMAGE_DES_MO)}else{l.src=l.oldSrc}}}}}l.alt=""}};obips.PivotTable.prototype.getColumnIdValuePairList=function(k,n,f,j,m){var l="";for(var c=0;c<=j;c++){var e=n.getID(f,c,m);var b=n.isMeasureLabelsLayer(f,c);var g=n.isLayerHierarchical(f,c);var d=n.getLayerID(f,c);if(b){d="ML"}l+="~"+d+"_"+e+"_";if(g){var h=n.getLevelID(f,c,m);l+="_"+h+"_"}}if(!this.isMeasureLabelsLayerOnSameEdge(k,f,n)){var a=0;if(f==obips.JSDataLayout.SECTION_EDGE){a=n.getCurrentSectionSlice()}var i=this.findFirstMeasureEdgeAndLayer(k,n);var e=n.getID(i.e,i.l,a);var d="ML";l+="~"+d+"_"+e+"_"}return l};obips.PivotTable.prototype.getQDRXmlColumnIdValuePairList=function(e){var k="";var g=e.selectNodes("saw:staticMemberGroup");for(var f=0;f<g.length;f++){var a="";var b="";var h=g[f];var m=XUIGetAttributeString(h,"specialDimension","");if(m=="measure"){b="ML"}else{var j=h.selectSingleNode(".//sawx:columnRefExpr");if(j){b=XUIGetAttributeString(j,"columnID","")}}var l=h.selectSingleNode(".//saw:value");var a=XUIGetElementText(l);k+="~"+b+"_"+a+"_";var c=h.selectSingleNode(".//saw:hierarchyLevel");if(c){var d=XUIGetAttributeString(c,"levelID","");k+="_"+d+"_"}}return k};PTPageSel=function(b){var f=saw.getEventTarget(b);var a=obips.EdgeCoords.findCoords(f);var e=a.getId();var d=obips.ViewModel.getViewModelById(e);var h=d.getEdgeDefinition(e);var g=d.getPivotViewXML();if(!g){return}var c=h.getLayerCount(obips.JSDataLayout.PAGE_EDGE);d.SelectPage(f,e,c,a.getLayer())};obips.PivotTable.prototype.SelectPage=function(b,f,d,c,g,e){var a=obips.PivotTable.superClass.SelectPage.call(this,b,f,d,c,g);if(typeof(e)=="undefined"){e=true}if(e){this.updateReport(true)}};obips.PivotTable.handlePivotSwapDrag=function(p,f,l,h){if(obips.PivotTable.ptProcessingEvent==true){return false}if(saw.userAgent.is_touchdevice){return}if(h=="edge"){var k=l.getId();var b=l.getEdge();var g=l.getLayer();var m=l.getSlice();var j=obips.ViewModel.getViewModelById(k);if(!obips.PivotTable.ptDragCoords.inUse&&obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.NO_EVENT){obips.PivotTable.hideLastRolloverLabel();j.showRolloverLabel(k,b,g)}if(!j||(obips.PivotTable.isRuntimeMode()&&!j.supportsFeature(obips.ViewRightClickMenu.FEATURE_PIVOT_SWAP))){return}obips.PivotTable.ptDropCoords.inUse=true;obips.PivotTable.ptDropCoords.edge=b;obips.PivotTable.ptDropCoords.layer=g;obips.PivotTable.ptDropCoords.slice=m;obips.PivotTable.ptDropCoords.childPivotClientId=k;j.hideGrabHandle(k,b,g,true);if(!obips.PivotTable.ptDragCoords.inUse&&obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.NO_EVENT){j.showGrabHandle(k,b,g)}if(obips.PivotTable.ptDragCoords.inUse){var e=obips.ViewModel.getViewModelById(obips.PivotTable.ptDropCoords.childPivotClientId);var d=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);if(e.getStatePath()!=d.getStatePath()){obips.PivotTable.ptProcessingEvent=false;return false}var o=j.getMouseDropPosition(p,l.getElement(),b);obips.PivotTable.ptDropCoords.mouseDropPosition=o;obips.PivotTable.handleShowLayerDropFeedback(k,b,g,m,o)}}else{var k=l.getId();var j=obips.ViewModel.getViewModelById(k);if(!j||(obips.PivotTable.isRuntimeMode()&&!j.supportsFeature(obips.ViewRightClickMenu.FEATURE_PIVOT_SWAP))){return}var c=j.getPivotViewXML();if(obips.PivotTable.containsNestedViews(c)){return}if(obips.PivotTable.ptDragCoords.inUse){var n=j.getEdgeDefinition(k);var i=n.isMeasureLayer(obips.PivotTable.ptDragCoords.edge,obips.PivotTable.ptDragCoords.layer);if(i){obips.PivotTable.ptDropCoords.inUse=true;obips.PivotTable.ptDropCoords.childPivotClientId=k;obips.PivotTable.ptDropCoords.edge=obips.JSDataLayout.DATA_EDGE;var e=obips.ViewModel.getViewModelById(obips.PivotTable.ptDropCoords.childPivotClientId);var d=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);if(e.getStatePath()!=d.getStatePath()){obips.PivotTable.ptProcessingEvent=false;return false}obips.PivotTable.ptProcessingEvent=true;var a=j.getChildViewModelIdList();j.clearLastVisibleDropLayer(a);j.highlightBodyCellRange(k,0,n.getEdgeExtent(obips.JSDataLayout.ROW_EDGE),0,n.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE));obips.PivotTable.ptProcessingEvent=false}}}return false};obips.Tree.NodeDragDropObject.prototype.autoOffset=function(b,a){this.setDelta(0,0)};obips.Tree.NodeDragDropObject.prototype.setDragObjPos=function(b,a){this.alignObjWithMouse(this.getDragObj(),b,a+obips.PivotTable.mouseDragOffset)};obips.PivotTable.DropTarget.prototype.onDragOver=function(p,d){var n=this.getSource();if(n==d.getSource()){return false}if(d.isInGroup(ksAvailableDataGroup)){obips.PivotTable.ptCurrentEvent.eventType=obips.ViewModel.EventType.DROP_COLUMN_MEMBER_EVENT;var c=document.getElementById(this.sDragObjID);var a=c.style.top;var h=c.style.left;var f=saw.getEventTarget(p);var m=obips.DatabodyCoords.findCoords(f);var b=obips.EdgeCoords.findCoords(f);if(b){var o=d.draggedNodes;var j=b.getEdge();var v=b.getLayer();var q=b.getSlice();var w=b.getId();var s=obips.ViewModel.getViewModelById(w);var e=s.getMouseDropPosition(p,b.getElement(),j,false);var g=o.length==1?s.columnExistsInPivot(o[0].treeNode):false;obips.PivotTable.ptCurrentEvent.eventSrc=w;obips.PivotTable.ptDragCoords.childPivotClientId=w;obips.PivotTable.ptDragCoords.selectedNodes=o;obips.PivotTable.ptDragCoords.inUse=true;s.hideGrabHandle(w,j,v,false);obips.PivotTable.ptCurrentEvent.eventData={type:"edge",data:b};var u=saw.availabledata.AvailableDataBrowser.createColumnDefFromSelectedNode(o[0].treeNode);if(g&&(u.GetColumnType()==NQWColumnDef.HIERARCHICAL_COLUMN||saw.availabledata.AvailableDataBrowser.isMemberNode(o[0].treeNode))){var r=obips.Analysis.getReport(s.reportStatePath);var l=r.getCriteria();var t=l.getColumnIdForTreeNode(o[0].treeNode);obips.PivotTable.handleShowExistingLayerDropFeedback(w,t)}else{if(!b.isStaticDropCell()){obips.PivotTable.handleShowLayerDropFeedback(w,j,v,q,e)}}}else{if(m){var o=d.draggedNodes;var w=m.getId();obips.PivotTable.ptCurrentEvent.eventSrc=w;obips.PivotTable.ptDragCoords.childPivotClientId=w;obips.PivotTable.ptDragCoords.selectedNodes=o;var s=obips.ViewModel.getViewModelById(w);if(s){var k=s.getChildViewModelIdList();s.clearLastVisibleDropLayer(k);var i=s.getEdgeDefinition(w);if(o.length==1&&o[0].treeNode.type=="Measure"){obips.PivotTable.ptCurrentEvent.eventData={type:"databody",data:m};obips.PivotTable.ptProcessingEvent=true;s.highlightBodyCellRange(w,0,i.getEdgeExtent(obips.JSDataLayout.ROW_EDGE),0,i.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE));obips.PivotTable.ptProcessingEvent=false}else{obips.PivotTable.ptCurrentEvent.eventData=null}}}}return true}return true};obips.PivotTable.shouldIncrementLayerBasedOnPos=function(c,e,b,a,d){if(d==obips.PivotTable.DROP_AFTER_CENTER){if(b==obips.JSDataLayout.COLUMN_EDGE&&c.getJSDataLayout().getVisColumnLayerCount()!=0&&a<e.getColLayerCount()||b==obips.JSDataLayout.ROW_EDGE&&c.getJSDataLayout().getVisRowLayerCount()!=0&&a<e.getRowLayerCount()||b==obips.JSDataLayout.PAGE_EDGE&&c.getJSDataLayout().getVisPageLayerCount()!=0&&a<e.getPageLayerCount()||b==obips.JSDataLayout.SECTION_EDGE&&c.getJSDataLayout().getVisSectionLayerCount()!=0&&a<e.getSectionLayerCount()){return true}}return false};obips.PivotTable.handleShowExistingLayerDropFeedback=function(h,f){var g=obips.ViewModel.getViewModelById(h);var d=g.getPivotViewXML();var i=d.selectSingleNode(".//saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@columnID='"+f+"']");if(i){var c=XUIGetAttributeString(i.parentNode.parentNode,"axis","");var b=obips.JSDataLayout.getEdgePosFromEdgeName(c);var e=0;var a=i.previousSibling;while(a!=null){e++;a=a.previousSibling}g.highlightLayer(h,b,e)}};obips.PivotTable.prototype.shouldAllowDraggingLayerToEdge=function(f,b,a,c){var e=f.isMeasureLabelsLayer(b,a);if(e&&(c==obips.JSDataLayout.SECTION_EDGE||c==obips.JSDataLayout.PAGE_EDGE)){var d=this.getPivotViewXML();if(obips.PivotTable.containsNestedViews(d)){obips.PivotTable.ptProcessingEvent=false;return false}}return true};obips.PivotTable.handleShowLayerDropFeedback=function(h,c,d,i,k){obips.PivotTable.ptProcessingEvent=true;var g=obips.ViewModel.getViewModelById(h);var j=g.getEdgeDefinition(h);var b=g.getChildViewModelIdList();var a=d;var f=j.getLayerCount(c);if(k==obips.PivotTable.DROP_IN_CENTER){}else{if(obips.PivotTable.shouldIncrementLayerBasedOnPos(g,j,c,d,k)){a++}}if(!g.shouldAllowDraggingLayerToEdge(j,obips.PivotTable.ptDragCoords.edge,obips.PivotTable.ptDragCoords.layer,c)){obips.PivotTable.ptProcessingEvent=false;return false}if(c==obips.JSDataLayout.COLUMN_EDGE){if(obips.PivotTable.ptLastVisibleObj.edge==c&&obips.PivotTable.ptLastVisibleObj.layer==a&&k!=obips.PivotTable.DROP_IN_CENTER){obips.PivotTable.ptProcessingEvent=false;return false}g.clearLastVisibleDropLayer(b);if(k==obips.PivotTable.DROP_IN_CENTER){g.highlightLayer(h,c,a)}else{g.unhighlightCellsAndClearSel(h);g.displayDropLayer(b,c,a)}}else{if(c==obips.JSDataLayout.ROW_EDGE){if(obips.PivotTable.ptLastVisibleObj.edge==c&&obips.PivotTable.ptLastVisibleObj.layer==a&&k!=obips.PivotTable.DROP_IN_CENTER){obips.PivotTable.ptProcessingEvent=false;return false}g.clearLastVisibleDropLayer(b);if(k==obips.PivotTable.DROP_IN_CENTER){g.highlightLayer(h,c,a)}else{g.unhighlightCellsAndClearSel(h);g.displayDropLayer(b,c,a)}}else{if(c==obips.JSDataLayout.SECTION_EDGE){if(obips.PivotTable.ptLastVisibleObj.edge==c&&obips.PivotTable.ptLastVisibleObj.layer==a&&k!=obips.PivotTable.DROP_IN_CENTER){obips.PivotTable.ptProcessingEvent=false;return false}g.clearLastVisibleDropLayer(b);if(k==obips.PivotTable.DROP_IN_CENTER){g.highlightLayer(h,c,a)}else{g.unhighlightCellsAndClearSel(h);g.displayDropLayer(b,c,a)}}else{if(c==obips.JSDataLayout.PAGE_EDGE){if(obips.PivotTable.ptLastVisibleObj.edge==c&&obips.PivotTable.ptLastVisibleObj.layer==a&&k!=obips.PivotTable.DROP_IN_CENTER){obips.PivotTable.ptProcessingEvent=false;return false}var e=new Array();e.push(h);g.clearLastVisibleDropLayer(b);if(k==obips.PivotTable.DROP_IN_CENTER){g.highlightLayer(h,c,a)}else{g.unhighlightCellsAndClearSel(h);g.displayDropLayer(e,c,a)}}}}}obips.PivotTable.ptProcessingEvent=false};obips.PivotTable.prototype.isElementClipped=function(b){var a=b.style.overflow;if(!a||a==="visible"){b.style.overflow="hidden"}var c=b.offsetWidth<b.scrollWidth||b.offsetHeight<b.scrollHeight;b.style.overflow=a;return c};obips.PivotTable.prototype.sizeAndPositionRolloverDiv=function(a,k,m,c,i){var f=this.findFirstSliceAtSpecifiedLayer(m,c,i);var o="e_"+m+"_"+c+"_"+i+"_"+f;var j=document.getElementById(o);var n="e_"+m+"_"+c+"_0_0";var l=document.getElementById(n);if(!j||!l){return}if(c==obips.JSDataLayout.ROW_EDGE){var b=a.offsetHeight;var g=obips.PivotTable.calcLeftBetweenElements(j,k);var e=0;if(g<0){e=g-1;g=1}a.children[0].style.width=j.offsetWidth+e+1+"px";var d=obips.PivotTable.calcTopBetweenElements(l,k);d-=a.offsetHeight;d+=1;a.style.left=g+"px";a.style.top=d+"px"}else{var d=obips.PivotTable.calcTopBetweenElements(j,k);var h=0;if(d<0){h=d-1;d=1}var g=obips.PivotTable.calcLeftBetweenElements(l,k);g-=a.offsetWidth-1;if(g<-5){a.children[0].style.width=Math.max(5,j.offsetWidth+g)+"px";g=-5}a.children[0].style.height=j.offsetHeight+"px";a.style.left=g+"px";a.style.top=d+"px"}};obips.PivotTable.prototype.isRolloverEnabledForEdge=function(b){var d=this.getViewXML();var c=obips.JSDataLayout.getViewXMLEdgeName(b);var a=d.selectSingleNode("./saw:edges/saw:edge[@axis='"+c+"' and @showColumnHeader='rollover']");return a};obips.PivotTable.prototype.showRolloverLabel=function(i,c,e){if(c!=obips.JSDataLayout.ROW_EDGE&&c!=obips.JSDataLayout.COLUMN_EDGE){return}if(!this.isRolloverEnabledForEdge(c)){return}var a=this.getMasterClientID();var g="hl_roll"+a+"_"+c+"_"+e;var j="hl_"+i+"_"+c+"_"+e;var d=document.getElementById(g);if(d){var h=this.getHtmlElement();var k=i+"RolloverDiv";var b=document.getElementById(k);if(!b){b=document.createElement("div");b.id=k;b.style.top="-100000px";b.style.left="0px";b.style.position="absolute";b.style.overflow="hidden";b.style.zIndex="3"}h.appendChild(b);b.style.display="";var l=d.cloneNode(true);l.className=l.className+" PTLR PTLC";l.id=j;if(l.setAttribute){l.setAttribute("cid",i)}var f=document.createElement("tr");f.appendChild(l);b.innerHTML='<table cellspacing="0" cellpadding="0"><tr>'+f.innerHTML+"</tr></table>";this.sizeAndPositionRolloverDiv(b,h,i,c,e);obips.PivotTable.lastRolloverDiv=b}};obips.PivotTable.prototype.showGrabHandle=function(g,a,c){var e=obips.ViewModel.getViewModelById(g);if(e&&!e.supportsFeature(obips.ViewRightClickMenu.FEATURE_MOVE_COLS)){return}if(a==obips.JSDataLayout.ROW_EDGE||a==obips.JSDataLayout.COLUMN_EDGE){var d=this.getHtmlElement();var b="ptFloatingGrabHandle"+g+"_"+a+"_"+c;var i=document.getElementById(b);if(i&&i.style.display==""){return}if(!i){i=document.createElement("div");i.id=b;i.style.top="0px";i.style.left="0px";i.style.position="absolute";i.style.overflow="hidden";i.style.display="none";i.style.zIndex="3";d.appendChild(i)}this.positionFloatingGrabHandle(i,d,g,a,c);obips.PivotTable.ptLastVisibleGrabHandle=i}else{var h=document.getElementById(g+"_"+a+"_"+c);if(h&&h.style.visibility!="visible"){h.style.visibility="visible";obips.PivotTable.ptLastVisibleGrabHandle=h;var f=document.getElementById(g+"_"+a+"_"+c+"_Tbl");if(f){f.className="PTDragCompMouseOver"}}}if(obips.PivotTable.ptLastVisibleGrabHandle){obips.PivotTable.ptLastVisibleGrabHandle.edge=a}};obips.PivotTable.prototype.positionFloatingGrabHandle=function(e,q,s,g,r){var p="hl_"+s+"_"+g+"_"+r;var i=document.getElementById(p);var a=0;var d=XUIGetAttributeString(this.getViewXML(),"headingDisplay","");if(d=="table2Rows"){var b="htl_"+s+"_"+g+"_0";var n=document.getElementById(b);if(n){a=n.offsetHeight}}e.style.display="";var f=i;if(!i){var h=this.findFirstSliceAtSpecifiedLayer(s,g,r);var o="e_"+s+"_"+g+"_"+r+"_"+h;i=document.getElementById(o);var m="e_"+s+"_"+g+"_0_0";f=document.getElementById(m)}if(!i||!q){return}if(g==obips.JSDataLayout.ROW_EDGE){this.createHorizontalFloatingGrabHandleTable(e,q,s,g,r);var l=obips.PivotTable.calcTopBetweenElements(f,q);l-=(e.offsetHeight+a);var j=obips.PivotTable.calcLeftBetweenElements(i,q);var k=0;if(j<0){k=j-1;j=1}e.style.width=i.offsetWidth+k+"px";e.style.left=j+"px";e.style.top=l+"px"}else{this.createVerticalFloatingGrabHandleTable(e,q,s,g,r);var l=obips.PivotTable.calcTopBetweenElements(i,q);var c=0;if(l<0){c=l-1;l=1}var j=obips.PivotTable.calcLeftBetweenElements(f,q);j-=10;e.style.width="12px";e.style.height=Math.max(16,i.offsetHeight-c)+"px";e.style.left=j+"px";e.style.top=l+"px"}};obips.PivotTable.prototype.addGrabHandleCoords=function(b,d,c,a){b.id=d+"_"+c+"_"+a;b.setAttribute("cid",d);b.setAttribute("e",c+"");b.setAttribute("l",a+"");b.setAttribute("s","-1")};obips.PivotTable.prototype.createHorizontalFloatingGrabHandleTable=function(b,h,f,e,c){var g=f+"_"+e+"_"+c+"_floatingLabel";var d='<table cellspacing="0px" cellpadding="0px" border="0" onmousedown="PTPSS(event, this); return false" class="PT_HGHT"><tbody><tr border="0" class="PT_HGHR"><td class="PT_RHPHL">&nbsp;</td><td class="PT_RHPHC">&nbsp;</td><td class="PT_RHPHR">&nbsp;</td></tr><tr style="display:none" class="PT_HGHRL"><td colspan="3" id="'+g+'"></td></tr></tbody></table>';b.innerHTML=d;var a=b.children[0];this.addGrabHandleCoords(a,f,e,c)};obips.PivotTable.prototype.createVerticalFloatingGrabHandleTable=function(b,h,f,e,c){var g=f+"_"+e+"_"+c+"_floatingLabel";var d='<table cellspacing="0px" cellpadding="0px" border="0" onmousedown="PTPSS(event, this); return false" class="PT_VGHTC" ><tbody><tr align="right" style="width:10px;"><td class="PT_CHPHT">&nbsp;</td><td rowspan="3" style="display:none" class="PT_VGHL" id="'+g+'"></td></tr><tr align="right" style="width:10px;"><td class="PT_CHPHC">&nbsp;</td></tr><tr align="right" style="width:10px;"><td class="PT_CHPHB">&nbsp;</td></tr></tbody></table>';b.innerHTML=d;var a=b.children[0];this.addGrabHandleCoords(a,f,e,c)};obips.PivotTable.prototype.hideGrabHandle=function(d,c,a,b){var e=null;if(c==obips.JSDataLayout.ROW_EDGE||c==obips.JSDataLayout.COLUMN_EDGE){e=document.getElementById("ptFloatingGrabHandle"+d+"_"+c)}else{e=document.getElementById(d+"_"+c+"_"+a)}if(obips.PivotTable.ptLastVisibleGrabHandle&&(e!=obips.PivotTable.ptLastVisibleGrabHandle||!b)){obips.PivotTable.hideLastGrabHandle()}};obips.PivotTable.hideLastGrabHandle=function(){if(obips.PivotTable.ptLastVisibleGrabHandle){if(obips.PivotTable.ptLastVisibleGrabHandle.edge==obips.JSDataLayout.ROW_EDGE||obips.PivotTable.ptLastVisibleGrabHandle.edge==obips.JSDataLayout.COLUMN_EDGE){obips.PivotTable.ptLastVisibleGrabHandle.style.display="none"}else{obips.PivotTable.ptLastVisibleGrabHandle.style.visibility="hidden";var a=document.getElementById(obips.PivotTable.ptLastVisibleGrabHandle.getAttribute("id")+"_Tbl");if(a){a.className="PTDragComp"}}obips.PivotTable.ptLastVisibleGrabHandle=null}};obips.PivotTable.hideLastRolloverLabel=function(){if(obips.PivotTable.lastRolloverDiv){obips.PivotTable.lastRolloverDiv.style.display="none"}obips.PivotTable.lastRolloverDiv=null};obips.PivotTable.onClick=function(c){var a=saw.getEventTarget(c);var b=obips.EdgeCoords.findCoords(a);if(b){obips.ViewModelBase.log("on click edge");obips.PivotTable.handleMasterDetail(b,false);obips.PivotTable.handleInitialSelectionEdge(c,a,b);obips.PivotTable.eventComplete()}var d=obips.DatabodyCoords.findCoords(a);if(d){obips.ViewModelBase.log("on click body");obips.PivotTable.handleMasterDetail(d,true);obips.PivotTable.handleInitialSelectionDatabody(c,a,d);obips.PivotTable.eventComplete()}};obips.PivotTable.onDragEnd=function(k){var a=saw.getEventTarget(k);if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.PIVOT_SWAP_EVENT){if(obips.PivotTable.ptDragCoords.inUse&&obips.PivotTable.ptDropCoords.inUse){var e=obips.ViewModel.getViewModelById(obips.PivotTable.ptDropCoords.childPivotClientId);var d=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);if(e.getStatePath()==d.getStatePath()){var b=obips.PivotTable.ptDropCoords.mouseDropPosition;obips.PivotTable.onPivotOrSwapLayer(obips.PivotTable.ptDragCoords.childPivotClientId,obips.PivotTable.ptDragCoords,obips.PivotTable.ptDropCoords,b)}}if(obips.PivotTable.ptColumnBeingDragged){var u=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);u.getHtmlElement().removeChild(obips.PivotTable.ptColumnBeingDragged);obips.PivotTable.ptColumnBeingDragged=null}d.unhighlightCellsAndClearSel(obips.PivotTable.ptDragCoords.childPivotClientId);obips.PivotTable.ptDragCoords.inUse=false;obips.PivotTable.ptDropCoords.inUse=false}else{if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.SELECTION_EVENT){}else{if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.DROP_COLUMN_MEMBER_EVENT&&obips.PivotTable.ptDragCoords.selectedNodes){var j=obips.PivotTable.ptDragCoords.selectedNodes;var c=obips.PivotTable.ptCurrentEvent.eventData;if(c&&c.type=="edge"){edgeCoords=c.data;databodyCoords=null}else{if(c&&c.type=="databody"){databodyCoords=c.data;edgeCoords=null}}if(edgeCoords){var u=obips.ViewModel.getViewModelById(edgeCoords.getId());u.unhighlightCellsAndClearSel(edgeCoords.getId());var p=u.getReportXML();var w=p.selectSingleNode(".//saw:criteria");for(var o=0;o<j.length;o++){var q=(o==(j.length-1));var r=j[o].treeNode;if(r.type=="RegularColumn"||r.type=="Measure"||r.type=="HierarchicalColumn"||r.type=="ValueHierarchicalColumn"){var m=new obips.gridview.AddColumnToViewEvent(u.getViewID(),u.reportStatePath,k,r,edgeCoords,q);obips.AnalysisEventManager.raiseEvent(m)}else{if(saw.availabledata.AvailableDataBrowser.isMemberNode(r)){var n=r.keyValue;var g=r.displayValue;var s=r.levelId;var h=r.levelName;var m=new obips.gridview.AddColumnToViewEvent(u.getViewID(),u.reportStatePath,k,r,edgeCoords,false);obips.AnalysisEventManager.raiseEvent(m);var l=m.bAdded;var v=new obips.gridview.AddMemberToViewEvent(u.getViewID(),u.reportStatePath,k,r,edgeCoords,n,g,s,h,l,q);obips.AnalysisEventManager.raiseEvent(v)}else{alert("Tree node type not handled: "+r.type)}}}obips.PivotTable.ptDragCoords.selectedNodes=null}else{if(databodyCoords){var u=obips.ViewModel.getViewModelById(databodyCoords.getId());u.unhighlightCellsAndClearSel(databodyCoords.getId());var t=false;for(var o=0;o<j.length;o++){var q=(o==(j.length-1));var r=j[o].treeNode;if(r.aggType=="agg"){if(r.type=="RegularColumn"||r.type=="Measure"){t=true;var m=new obips.gridview.AddColumnToViewEvent(u.getViewID(),u.reportStatePath,k,r,databodyCoords,q);obips.AnalysisEventManager.raiseEvent(m)}}else{if(t&&q){u.updateReport()}}}obips.PivotTable.ptDragCoords.selectedNodes=null}}}}}if(obips.PivotTable.ptDragCoords){var u=obips.ViewModel.getViewModelById(obips.PivotTable.ptDragCoords.childPivotClientId);if(u){var f=u.getChildViewModelIdList();u.clearLastVisibleDropLayer(f)}}obips.PivotTable.eventComplete()};obips.PivotTable.onContextMenuItemSelected=function(d){var e=d.context;var b=e.menuOption;var a=b.eventType;var c=b.eventData;if(!a||!c){return}obips.PivotTable.ptCurrentEvent.eventType=a;obips.PivotTable.ptCurrentEvent.eventData=c;switch(a){case obips.ViewModel.EventType.MASTER_DETAIL_MENU_EVENT:obips.PivotTable.masterDetailMenuHandler();break;case obips.ViewModel.EventType.DRILL_REG_COL_MENU_EVENT:break;case obips.ViewModel.EventType.INCLUDE_COLUMN_MENU_EVENT:obips.ViewModel.includeColumnMenuHandler(c,b.columnID);break;case obips.ViewModel.EventType.RUNNING_SUM_COLUMN_MENU_EVENT:obips.ViewModel.setToggleRunning(c,b.columnID);break;default:break}};obips.PivotTable.prototype.moveMenuHandler=function(c,d,b,e){var a=c;obips.PivotTable.ptDragCoords.edge=a.edge;obips.PivotTable.ptDragCoords.layer=a.layer;obips.PivotTable.ptDragCoords.slice=a.slice;obips.PivotTable.ptDragCoords.childPivotClientId=a.getId();obips.PivotTable.ptDropCoords.edge=d;obips.PivotTable.ptDropCoords.layer=b;obips.PivotTable.ptDropCoords.slice=0;obips.PivotTable.ptDropCoords.childPivotClientId=a.getId();obips.PivotTable.onPivotOrSwapLayer(a.getId(),obips.PivotTable.ptDragCoords,obips.PivotTable.ptDropCoords,e);obips.PivotTable.ptDropCoords=new Object();obips.PivotTable.ptDragCoords=new Object()};obips.PivotTable.onContextMenu=function(m){var j=saw.getEventTarget(m);var e=new obips.gridview.ContextMenuEvent(null,null,obips.PivotTable.cloneEvent(saw.getEvent(m)),j);var n=obips.EdgeCoords.findCoords(e.eventTarget);if(n){saw.stopEventPropagationAndNotify(m);var l=n;n.bDatabody=false;var b=n.getEdge();var f=n.getLayer();var i=n.getSlice();var h=n.getId();var g=obips.ViewModel.getViewModelById(h);var c=new obips.PivotViewRightClickMenu(g);obips.PivotTable.handleInitialSelectionEdge(m,j,n);var d=c.onEdgeContextMenu(n,e.evt);if(!d||d.length==0){return}var k=new obips.ContextMenu.Manager();if(!m.keyCode&&m.button){k.display(c.contextMenuModel,m)}else{k.displayAtPosition(c.contextMenuModel,saw.Position.createByDOMElement(e.eventTarget,"down",15))}}else{var a=obips.DatabodyCoords.findCoords(e.eventTarget);if(a){obips.PivotTable.handleInitialSelectionDatabody(m,j,a);obips.PivotTable.onDatabodyContextMenu(a,e.evt,e.eventTarget,true)}}};obips.PivotTable.onDatabodyContextMenu=function(j,q,w,r){var i=new Array();var k=obips.ViewModel.EventType.NO_EVENT;var y="views/pivot/obips.gridview.xml";var m=obips.ResourceManager.getSingleton();var g=obips.PivotTable.isRuntimeMode();if(j){j.bDatabody=true;var f=j;var I=j.getRow();var F=j.getCol();var H=j.getId();var B=obips.ViewModel.getViewModelById(H);var C=B.getBodyDefinition(H);var u=C.getValue(I,F);var v=C.getID(I,F);var c=B.getPivotViewXML();var t=obips.PivotTable.containsNestedViews(c);if(t&&!obips.PivotTable.isShowingNumbers(c,v)){return}var s=j.getElement();var G=obips.PivotTable.getActionLinkIdsFromElement(s);var p=new ActionLinksModel(B,H,obips.JSDataLayout.DATA_EDGE,I,F,false,B.actionLinksXmlId);p.setDataValue(v,u);var a=new ActionLinksRenderer(p,G);var l=a.getContextMenuOptions(q);if(l.length>0){linkText=m.getResource(y,"kmsgGridViewActionLinks").getString();var A=m.getURL(y,"kfileAction").url;var n=obips.PivotTable.CreateContextMenuOption(linkText,linkText,A,l,null);i.push(n)}var D=s.getAttribute("obips-clevt");if(D){linkText=m.getResource(y,"kmsgGridViewSendMasterDetailEvent").getString();k=obips.ViewModel.EventType.MASTER_DETAIL_MENU_EVENT;var n=obips.PivotTable.CreateContextMenuOption(linkText,linkText,null,null,k,f);i.push(n)}y="views/obips.viewrightclickmenu.xml";var z=obips.PivotTable.fillIncludeColumnMenuOption(H,f,B.reportStatePath,true);if(z.length){linkText=m.getResource(y,"kmsgViewBaseIncludeColumn").getString();var n=obips.PivotTable.CreateContextMenuOption(linkText,linkText,null,z,null,f);i.push(n)}var x=obips.Analysis.getReport(B.reportStatePath);var h=x.getCriteria();var o=obips.PivotTable.getColumnById(h.getXML(),v);if(XUIGetXsiType(o)=="switchGroupColumn"){var d=SelectionsModel.getSwitchGroupChoiceColumn(o,x.getXML());v=XUIGetAttributeString(d,"columnID")}var E=obips.ReportMetadata.GetInstanceByStatePath(B.reportStatePath).getColumnInfoByID(v);if(E&&E.isMeasure()){var b=new obips.PivotViewRightClickMenu(B);b.showRunningSumMenu(true,v,m,y,f,g,i)}}if(i.length==0){return}if(r){saw.stopEventPropagationAndNotify(q)}q=obips.BrowserEventFramework.normalizeEvent(q);cmm=new obips.ContextMenu.Manager();var e=new obips.ContextMenu.Model(q.target,i);if(!q.keyCode&&q.button){cmm.display(e,q)}else{cmm.displayAtPosition(e,saw.Position.createByDOMElement(w,"down",15))}};obips.PivotTable.CreateContextMenuOption=function(c,j,d,e,a,i,f,h,b){var g=new obips.ContextMenu.MenuOption(c,j,d,new obips.Callback(null,obips.PivotTable.onContextMenuItemSelected),e,false,f,h,b);if(a){g.eventType=a}if(i){g.eventData=i}return g};obips.PivotTable.eventComplete=function(){obips.PivotTable.ptCurrentEvent.eventType=obips.ViewModel.EventType.NO_EVENT;obips.PivotTable.ptCurrentEvent.eventSrc=""};obips.PivotTable.onPivotOrSwapLayer=function(G,t,p,f){var F=p.layer;var l=t.layer;var b=p.layer;if(t.edge==p.edge){if((l==b)){return}if(f==obips.PivotTable.DROP_AFTER_CENTER&&(l==b+1)){return}}if(f==obips.PivotTable.DROP_BEFORE_CENTER&&(p.edge==obips.JSDataLayout.ROW_EDGE||p.edge==obips.JSDataLayout.COLUMN_EDGE||p.edge==obips.JSDataLayout.SECTION_EDGE||p.edge==obips.JSDataLayout.PAGE_EDGE)){b=p.layer-1;if(b==l&&(t.edge==p.edge)){return}}var y=obips.ViewModel.getViewModelById(G);var e=y.getPivotViewXML(G);if(!e){return}var g=y.getEdgeDefinition(G);if(!y.shouldAllowDraggingLayerToEdge(g,t.edge,t.layer,p.edge)){return}y.removeAllSorts(e);if(t.edge==obips.JSDataLayout.PAGE_EDGE&&p.edge!=t.edge){var s=g.getLayerID(t.edge,t.layer);var v=XUIForceSingleNode(e,saw.xml.kSawNamespace,"pageEdgeState");var m=v.selectNodes(".//sawx:columnRefExpr");if(m&&m.length>0){for(var w=0;w<m.length;w++){if(XUIGetAttributeString(m[w],"columnID","")==s){var D=m[w].parentNode.parentNode;D.parentNode.removeChild(D)}}}var x=v.selectNodes(".//saw:QDR");if(x&&x.length>0){for(var w=0;w<x.length;w++){if(x[w]&&obips.PivotTable.countChildNodes(x[w])==0){x[w].parentNode.removeChild(x[w])}}}var B=v.selectNodes(".//saw:selectionGroup");if(B&&B.length>0){for(var w=0;w<B.length;w++){if(XUIGetAttributeString(B[w],"columnID","")==s){B[w].parentNode.removeChild(B[w])}}}var r=v.selectNodes(".//saw:selectionGroups");if(r&&r.length>0){for(var w=0;w<r.length;w++){if(r[w]&&obips.PivotTable.countChildNodes(r[w])==0){r[w].parentNode.removeChild(r[w])}}}if(obips.PivotTable.countChildNodes(v)==0){v.parentNode.removeChild(v)}}var u=f==obips.PivotTable.DROP_IN_CENTER;var j=y.getPhysicalLayer(t.edge,l);var A=y.getPhysicalLayer(p.edge,b);var k=obips.JSDataLayout.getViewXMLEdgeName(t.edge);var d=e.selectSingleNode("saw:edges/saw:edge[@axis='"+k+"']/saw:edgeLayers");var a=XUIGetChildElement(d,j);if(p.edge==obips.JSDataLayout.DATA_EDGE){var E=XUIGetAttributeString(a,"columnID","");if(E){var h=e.selectSingleNode("saw:measuresList");var q=XUIAppendNewElement(h,saw.xml.kSawNamespace,"measure");XUISetAttributeString(q,"columnID",E)}else{return}}else{var o=obips.JSDataLayout.getViewXMLEdgeName(p.edge);var z=e.selectSingleNode("saw:edges/saw:edge[@axis='"+o+"']/saw:edgeLayers");if(!z){var c=e.selectSingleNode("saw:edges/saw:edge[@axis='"+o+"']");z=XUIForceSingleNode(c,saw.xml.kSawNamespace,"edgeLayers")}var C=XUIGetChildElement(z,A+1);if(C){z.insertBefore(a.cloneNode(true),C)}else{z.appendChild(a.cloneNode(true))}if(u){var n=XUIGetChildElement(z,A);if(n){var C=XUIGetChildElement(d,j+1);if(C){d.insertBefore(n.cloneNode(true),C)}else{d.appendChild(n.cloneNode(true))}}z.removeChild(n)}}d.removeChild(a);y.updateReport(true)};obips.PivotTable.addHierColumn=function(s,u,g,m,r){var o=XUIGetAttributeString(g,"name","");var j="";if(obips.PivotTable.ptCurrentEvent.eventSrc!=""){j=obips.PivotTable.getViewName(obips.PivotTable.ptCurrentEvent.eventSrc)}if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.DROP_COLUMN_MEMBER_EVENT&&o==j){if(r&&s&&s!=""){var f=saw.getEventTarget(r);var b=obips.PivotTable.ptCurrentEvent.eventData.data;if(b){var w=b.getId();var t=obips.ViewModel.getViewModelById(w);var h=t.getEdgeDefinition(w);var d=t.getPivotViewXML();var n=obips.JSDataLayout.getViewXMLEdgeName(b.getEdge());var c=d.selectSingleNode("saw:edges/saw:edge[@axis='"+n+"']/saw:edgeLayers");if(!c){var i=d.selectSingleNode("saw:edges/saw:edge[@axis='"+n+"']");c=XUIForceSingleNode(i,saw.xml.kSawNamespace,"edgeLayers")}var v=parseInt(b.getLayer());var e=t.getMouseDropPosition(r,b.getElement(),b.getEdge());if(obips.PivotTable.shouldIncrementLayerBasedOnPos(t,h,b.getEdge(),b.getLayer(),e)){v++}var a=XUIInsertNewElement(c,saw.xml.kSawNamespace,"edgeLayer",v);XUISetAttributeString(a,"type","column");XUISetAttributeString(a,"columnID",s);obips.PivotTable.addExistingMeasureBasedSortsToLayer(c.parentNode,a)}}}else{if(s&&s!=""){var p=obips.JSDataLayout.getViewXMLEdgeName(obips.JSDataLayout.ROW_EDGE);var l=g.selectSingleNode("saw:edges/saw:edge[@axis='"+p+"']");if(l!=null){var q=XUIForceSingleNode(l,saw.xml.kSawNamespace,"edgeLayers");if(q!=null){var k=XUIAppendNewElement(q,saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(k,"type","column");XUISetAttributeString(k,"columnID",s);obips.PivotTable.addExistingMeasureBasedSortsToLayer(q.parentNode,k)}}}}};obips.PivotTable.prototype.viewUpdated=function(a){};obips.PivotTable.prototype.handleAddColumnToView=function(l){if(this.statePath!=l.viewID){return}var g=l.selectedNode;var k=l.edgeCoords;var a=l.mouseEvent;var h=obips.ViewModel.getViewModelById(k.getId());var d=h.columnExistsInReport(g);var b=saw.availabledata.AvailableDataBrowser.createColumnDefFromSelectedNode(g);if(d&&b.GetColumnType()==NQWColumnDef.HIERARCHICAL_COLUMN){l.serverSyncRequired=false}else{if(d&&saw.availabledata.AvailableDataBrowser.isMemberNode(g)){return}else{var c=obips.Analysis.getReport(h.reportStatePath);var i=c.getCriteria();var f=i.addColumnFromTree(g);l.newColumnID=f;l.bAdded=true;var e=h.getPivotViewXML();var j=i.getXML();var b=saw.availabledata.AvailableDataBrowser.createColumnDefFromSelectedNode(g);if(b.GetColumnType()==NQWColumnDef.REGULAR_COLUMN){obips.PivotTable.addColumn(a,f,b,e,j)}else{if(b.GetColumnType()==NQWColumnDef.HIERARCHICAL_COLUMN){obips.PivotTable.addHierColumn(f,b,e,j,a)}}}}};obips.PivotTable.addMeasureForOrToNestedView=function(g,f,i){var o=(XUIGetAttributeString(f,"type","")=="singleviz");var k=(XUIGetAttributeString(f,"type","")=="multiviz");var h=XUIForceSingleNode(f,saw.xml.kSawNamespace,"measuresList");var c=f.selectSingleNode("saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@type='measure']");if(!c){var e=f.selectSingleNode("saw:edges/saw:edge[@axis='column']");var d=XUIForceSingleNode(e,saw.xml.kSawNamespace,"edgeLayers");var b=XUIAppendNewElement(d,saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(b,"type","measure");if(o){XUISetAttributeString(b,"visibility","hidden")}}if(k){n=XUIAppendNewElement(h,saw.xml.kSawNamespace,"measure");XUISetAttributeString(n,"columnID",g)}else{if(o){var m=f.selectNodes("saw:nestedViews/saw:nestedView[@position='embedded']/saw:view");for(var l=0;l<m.length;l++){var a=m[l];if(i==null){i=obips.Analysis.getCurrentReport().reportXML}DVTChartView.prototype.appendColumn(g,a,i);var j=XUIGetAttributeString(a,"name","");var n=h.selectSingleNode("//saw:measure[@name='"+j+"']");if(!n){n=XUIAppendNewElement(h,saw.xml.kSawNamespace,"measure");XUISetAttributeString(n,"columnID",g);XUISetAttributeString(n,"type","view");XUISetAttributeString(n,"name",j)}}}}};obips.PivotTable.addColumn=function(z,l,F,g,r,f){var t=XUIGetAttributeString(g,"name","");var n="";if(obips.PivotTable.ptCurrentEvent.eventSrc!=""){n=obips.PivotTable.getViewName(obips.PivotTable.ptCurrentEvent.eventSrc)}var H=XUIColumn.getTableHeadingFromFormula(F.GetSQLFormula());var I=(F.GetAggregateType()=="agg");if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.DROP_COLUMN_MEMBER_EVENT&&t==n){var e=saw.getEventTarget(z);var h=obips.PivotTable.ptCurrentEvent.eventData;if(h.type=="edge"){edgeCoords=h.data;databodyCoords=null}else{if(h.type=="databody"){databodyCoords=h.data;edgeCoords=null}}if(edgeCoords){var G=edgeCoords.getId();var A=obips.ViewModel.getViewModelById(G);var k=A.getEdgeDefinition(G);var c=A.getPivotViewXML();var s=obips.JSDataLayout.getViewXMLEdgeName(edgeCoords.getEdge());var b=c.selectSingleNode("saw:edges/saw:edge[@axis='"+s+"']/saw:edgeLayers");if(!b){var m=c.selectSingleNode("saw:edges/saw:edge[@axis='"+s+"']");b=XUIForceSingleNode(m,saw.xml.kSawNamespace,"edgeLayers")}var E=parseInt(edgeCoords.getLayer());var d=A.getMouseDropPosition(z,edgeCoords.getElement(),edgeCoords.getEdge());if(obips.PivotTable.shouldIncrementLayerBasedOnPos(A,k,edgeCoords.getEdge(),edgeCoords.getLayer(),d)){E++}var a=XUIInsertNewElement(b,saw.xml.kSawNamespace,"edgeLayer",E);XUISetAttributeString(a,"type","column");XUISetAttributeString(a,"columnID",l);obips.PivotTable.addExistingMeasureBasedSortsToLayer(b.parentNode,a)}else{if(databodyCoords){obips.PivotTable.addMeasure(l,g,f)}}}else{var o=null;if(H!=""){var D=g.selectNodes("saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@type='column']");for(var x=0;x<D.length;x++){var C=D[x];var B=r.selectSingleNode("saw:columns/saw:column[@columnID='"+XUIGetAttributeString(C,"columnID")+"']");if(B!=null){var v=obips.ReportMetadata.GetInstance().getRegularColumnInfoByExpr(B.selectSingleNode("saw:columnFormula/sawx:expr"));var i=v?v.getBaseFormula():"";if(XUIColumn.getTableHeadingFromFormula(i)==H){o=C}}}}if(I){obips.PivotTable.addMeasure(l,g,f)}else{if(o!=null){var y=XUICreateElement(saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(y,"type","column");XUISetAttributeString(y,"columnID",l);o.parentNode.appendChild(y);obips.PivotTable.addExistingMeasureBasedSortsToLayer(y.parentNode.parentNode,y)}else{var u=obips.JSDataLayout.getViewXMLEdgeName(obips.JSDataLayout.ROW_EDGE);var q=g.selectSingleNode("saw:edges/saw:edge[@axis='"+u+"']");if(q!=null){var w=XUIForceSingleNode(q,saw.xml.kSawNamespace,"edgeLayers");if(w!=null){var p=XUIAppendNewElement(w,saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(p,"type","column");XUISetAttributeString(p,"columnID",l);obips.PivotTable.addExistingMeasureBasedSortsToLayer(w.parentNode,p)}}}}}};obips.PivotTable.addMeasure=function(g,f,i){if(obips.PivotTable.containsNestedViews(f)){obips.PivotTable.addMeasureForOrToNestedView(g,f,i);return}var k=obips.PivotTable.isTable(f);if(k){var e=obips.JSDataLayout.getViewXMLEdgeName(obips.JSDataLayout.ROW_EDGE);var j=f.selectSingleNode("saw:edges/saw:edge[@axis='"+e+"']");if(j!=null){var a=XUIForceSingleNode(j,saw.xml.kSawNamespace,"edgeLayers");if(a!=null){var l=XUIAppendNewElement(a,saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(l,"type","column");XUISetAttributeString(l,"columnID",g);obips.PivotTable.addExistingMeasureBasedSortsToLayer(a.parentNode,l)}}return}var h=XUIForceSingleNode(f,saw.xml.kSawNamespace,"measuresList");var b=f.selectSingleNode(".//saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@type='measure']");if(b==null){var d=obips.JSDataLayout.getViewXMLEdgeName(obips.JSDataLayout.COLUMN_EDGE);var c=f.selectSingleNode("saw:edges/saw:edge[@axis='"+d+"']");var a=XUIForceSingleNode(c,saw.xml.kSawNamespace,"edgeLayers");var l=XUIAppendNewElement(a,saw.xml.kSawNamespace,"edgeLayer");XUISetAttributeString(l,"type","measure")}var m=XUIAppendNewElement(h,saw.xml.kSawNamespace,"measure");XUISetAttributeString(m,"columnID",g)};obips.PivotTable.prototype.handleAddMemberToView=function(o){if(this.statePath!=o.viewID){return}var h=o.selectedNode;var n=o.edgeCoords;var a=o.mouseEvent;var e=o.keyValue;var k=o.displayValue;var b=o.levelID;var l=o.levelName;var f=o.bIsNewColumn;var c=saw.availabledata.AvailableDataBrowser.createColumnDefFromSelectedNode(h);var j=obips.ViewModel.getViewModelById(n.getId());var d=obips.Analysis.getReport(j.reportStatePath);var m=d.getCriteria();var g=m.getColumnIdForColumnDef(c);var i=j.addMember(a,e,k,b,l,g,c,m.getXML(),d.getXML(),f);if(!i){o.serverSyncRequired=false}};obips.PivotTable.prototype.addMember=function(b,g,k,c,l,j,e,h,d,n){if(j&&j.length>0){var i=new SelectionsModel(h,d);var m=obips.PivotTable.getColumnById(h,j);var a=m.selectSingleNode("saw:dimensionSelection");if(!a){i.getInfoAndCreateSelection(m);a=m.selectSingleNode("saw:dimensionSelection")}if(a){if(!n){var o=XUICreateElement(saw.xml.kSawNamespace,"value");XUISetElementText(o,g?g:k);var f=new Array();f.push(o);i.createMemberStep(a,"add",f,c)}else{if(e.GetColumnType()==NQWColumnDef.HIERARCHICAL_COLUMN){i.updateInitialStepWithMember(a,j,g?g:k,c)}else{i.updateInitialStepWithMember(a,j,g?g:k)}}return true}}};obips.PivotTable.addExistingMeasureBasedSortsToLayer=function(e,d){var a=e.selectSingleNode(".//saw:columnOrder");var c=XUIGetAttributeString(d,"columnID","");if(!a||c==""){return}var g=a.selectSingleNode(".//saw:QDR");if(g){var b=g.parentNode;if(b){var f=b.cloneNode(true);XUISetAttributeString(f,"columnID",c);a.appendChild(f)}}};obips.PivotTable.columnExistsInPivotXml=function(e,d){var c=e.selectNodes("saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@type='column'] | saw:measuresList/saw:measure");for(var a=0;a<c.length;a++){var b=XUIGetAttributeString(c[a],"columnID","");if(b==d){return true}}return false};obips.PivotTable.prototype.columnExistsInPivot=function(f){var a=obips.Analysis.getReport(this.reportStatePath);var h=a.getCriteria();if(!h.columnExists(f)){return false}var e=h.getColumnIdForTreeNode(f);var g=this.getPivotViewXML();var d=g.selectNodes("saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@type='column'] | saw:measuresList/saw:measure");for(var b=0;b<d.length;b++){var c=XUIGetAttributeString(d[b],"columnID","");if(c==e){return true}}return false};obips.PivotTable.prototype.columnExistsInReport=function(b){var a=obips.Analysis.getReport(this.reportStatePath);var c=a.getCriteria();return c.columnExists(b)};obips.PivotTable.findHierColumnColumnId=function(d,c,b){var a=obips.PivotTable.getHierColumn(d,c,b);if(a){return XUIGetAttributeString(a,"columnID","")}return null};obips.PivotTable.getHierColumn=function(d,c,b){var a=d.selectSingleNode(".//saw:column[@hierarchyID='"+b+"' and @tableName='"+c+"']");return a};obips.PivotTable.getRegularColumn=function(d,b){var e=d.selectNodes("saw:columns/saw:column[@xsi:type='saw:regularColumn']");if(e){for(var c=0;c<e.length;c++){var f=e[c];var g=f.selectSingleNode("saw:columnFormula/sawx:expr");var h=XUIGetElementText(g);if(h==b){return f}var j=obips.ReportMetadata.GetInstanceByStatePath(masterPivotTable.reportStatePath).getRegularColumnInfoByExpr(g);var a=columnInfo?columnInfo.getBaseFormula():"";if(a==b){return f}}}};obips.PivotTable.getColumnById=function(c,b){var a=c.selectSingleNode(".//saw:column[@columnID='"+b+"']");return a};obips.PivotTable.prototype.displayDropLayer=function(g,d,x,o){if(d==obips.JSDataLayout.PAGE_EDGE){var r=g[0];var m=r+"_"+d+"_"+x+"_Grp";obips.PivotTable.setElementVisibility(m,true);obips.PivotTable.ptLastVisibleObj.sourceId=g[0]}else{if(d==obips.JSDataLayout.DATA_EDGE||d==obips.JSDataLayout.SECTION_EDGE||(d==obips.JSDataLayout.ROW_EDGE&&this.getJSDataLayout().getVisRowLayerCount()==0)||(d==obips.JSDataLayout.COLUMN_EDGE&&this.getJSDataLayout().getVisColumnLayerCount()==0)){for(var q=0;q<g.length;q++){var r=g[q];var m=r+"_"+d+"_"+x+"_Grp";obips.PivotTable.setElementVisibility(m,true)}}else{if(d==obips.JSDataLayout.ROW_EDGE||d==obips.JSDataLayout.COLUMN_EDGE){for(var q=0;q<g.length;q++){var r=g[q];var m=r+"_"+d+"_"+x+"_Grp";obips.PivotTable.setElementVisibility(m,true);var b=this.getEdgeDefinition(r);var s=b.getEdgeExtent(d)-1;var v=this.getHtmlElement();var c=document.getElementById(r);var f="opaqueDropLayer"+r;var k=document.getElementById(f);if(!k){var k=document.createElement("div");k.id=f;k.className="PTODL";var w=document.createTextNode("");k.appendChild(w);v.appendChild(k)}if(d==obips.JSDataLayout.ROW_EDGE){var l=(this.getJSDataLayout().getVisibleLayerCount(obips.JSDataLayout.ROW_EDGE)<=x);var u=x;if(l&&u>0){u-=1}var p="hl_"+r+"_"+d+"_"+u;var t=document.getElementById(p);if(!t||this.isRolloverEnabledForEdge(d)){var e=this.findFirstSliceStartingAtSpecifiedLayer(b,d,u,0);var j="e_"+r+"_"+d+"_"+u+"_"+e;t=document.getElementById(j)}if(!t){var j=r+"_"+d+"_"+u+"_Grp";t=document.getElementById(j)}var h=this.getOpaqueDropLayerPosition(r,d,l,t,t,v);k.style.width="10px";k.style.height=h.yHeight+"px"}else{var l=(this.getJSDataLayout().getVisibleLayerCount(obips.JSDataLayout.COLUMN_EDGE)<=x);var u=x;if(l&&u>0){u-=1}var e=this.findFirstSliceStartingAtSpecifiedLayer(b,d,u,0);var n="e_"+r+"_"+d+"_"+u+"_"+e;var a=document.getElementById(n);if(!a){n=r+"_"+d+"_"+u+"_Grp";a=document.getElementById(n)}var h=this.getOpaqueDropLayerPosition(r,d,l,a,a,v);k.style.width=h.xWidth+"px";k.style.height="10px"}k.style.visibility="visible";k.style.top=h.yPos+"px";k.style.left=h.xPos+"px"}}}}obips.PivotTable.ptLastVisibleObj.edge=d;obips.PivotTable.ptLastVisibleObj.layer=x};obips.PivotTable.prototype.getOpaqueDropLayerPosition=function(b,e,l,d,g,c){if(e==obips.JSDataLayout.COLUMN_EDGE){var h=obips.PivotTable.calcLeftBetweenElements(g,c)-2;var a=obips.PivotTable.calcRightBetweenElements(document.getElementById(b),c);var j=a-h;if(l){var f=obips.PivotTable.calcBottomBetweenElements(d,c)-5}else{var f=obips.PivotTable.calcTopBetweenElements(d,c)-5}return{yPos:f,yHeight:0,xPos:h,xWidth:j}}else{if(l){var h=obips.PivotTable.calcRightBetweenElements(d,c)-5}else{var h=obips.PivotTable.calcLeftBetweenElements(d,c)-5}var f=obips.PivotTable.calcTopBetweenElements(g,c)-1;var i=obips.PivotTable.calcBottomBetweenElements(document.getElementById(b),c)+1;var k=i-f-2;return{yPos:f,yHeight:k,xPos:h,xWidth:0}}};obips.PivotTable.calcTopBetweenElements=function(c,b,d){var e=0;if(!d&&c){var a=c.parentNode;while(a&&a!=b&&a!=c.ownerDocument.body){e-=a.scrollTop;a=a.parentNode}}while(c!=null){if(c==b){break}e+=c.offsetTop;c=c.offsetParent}return e};obips.PivotTable.calcBottomBetweenElements=function(b,a,c){var d=0;if(b){d+=b.offsetHeight}return d+obips.PivotTable.calcTopBetweenElements(b,a,c)};obips.PivotTable.calcLeftBetweenElements=function(d,c,e){var a=0;if(!e&&d){var b=d.parentNode;while(b&&b!=c&&b!=d.ownerDocument.body){a-=b.scrollLeft;b=b.parentNode}}while(d){if(d==c){break}a+=d.offsetLeft;d=d.offsetParent}return a};obips.PivotTable.calcRightBetweenElements=function(c,b,d){var a=0;if(c){a+=c.offsetWidth}return a+obips.PivotTable.calcLeftBetweenElements(c,b,d)};obips.PivotTable.prototype.clearLastVisibleDropLayer=function(c){if(obips.PivotTable.ptLastVisibleObj.layer>=0){var f=obips.PivotTable.ptLastVisibleObj.layer;var j=obips.PivotTable.ptLastVisibleObj.edge;if(obips.PivotTable.ptLastVisibleObj.edge==obips.JSDataLayout.PAGE_EDGE){var b=obips.PivotTable.ptLastVisibleObj.sourceId;var e=b+"_"+j+"_"+f+"_Grp";obips.PivotTable.setElementVisibility(e,false)}else{var g=null;var h=null;for(var d=0;d<c.length;d++){var b=c[d];if(!g||!h){g=obips.ViewModel.getViewModelById(b);h=g.getEdgeDefinition(b)}if((j==obips.JSDataLayout.ROW_EDGE&&h.getRowLayerCount()!=0)||(j==obips.JSDataLayout.COLUMN_EDGE&&h.getColLayerCount()!=0)){var a=document.getElementById("opaqueDropLayer"+b);if(a){a.style.visibility="hidden";a.style.top="-1000px"}}var e=b+"_"+j+"_"+f+"_Grp";obips.PivotTable.setElementVisibility(e,false)}}obips.PivotTable.ptLastVisibleObj.edge=-1;obips.PivotTable.ptLastVisibleObj.layer=-1}};obips.PivotTable.setElementVisibility=function(b,c){var a=document.getElementById(b);if(a&&obips.BrowserQuirks.supports(obips.BrowserQuirks.STYLE_DISPLAY_SUPPORTED_ON_TABLE_ROWS_COLS,false)){if(c){a.style.display=""}else{a.style.display="none"}}else{if(a&&obips.BrowserQuirks.supports(obips.BrowserQuirks.STYLE_VISIBILITY_SUPPORTED_ON_TABLE_ROWS_COLS,false)){if(c){a.style.visibility="visible"}else{a.style.visibility="collapse"}}else{}}};obips.PivotTable.cloneEvent=function(a){if(is_ie){var c=new Object();for(var b in a){c[b]=a[b]}a.obips_pivotEvent=c;return a}else{return a}};obips.PivotTable.restoreClonedEventWhenNecessary=function(a){if(is_ie){if(saw.getEventSrcElement(a)&&saw.getEventSrcElement(a).ownerDocument){return a}else{return a.obips_pivotEvent}}return a};obips.PivotTable.getActionLinkIdsFromElement=function(a){var e=(a.getAttribute("ai")!=null)?true:false;var b=0;while(!e&&b<15&&a.parentNode){b++;a=a.parentNode;e=(a.getAttribute("ai")!=null)?true:false}if(e){var d=a.getAttribute("ai");if(!d){d="[]"}var c=saw.json.parse(d);return c}return null};PTPCHAct=function(c,j){saw.stopEventPropagationAndNotify(j);var c=saw.getEventTarget(j);var k=obips.EdgeCoords.findCoords(c);var h=k.getId();var b=k.getEdge();var d=k.getLayer();var i=-1;var g=obips.ViewModel.getViewModelById(h);if(!g||!g.supportsFeature(obips.ViewRightClickMenu.FEATURE_ACTIONS)){return}var a=k.getElement();var f=obips.PivotTable.getActionLinkIdsFromElement(c);d=g.getPhysicalLayer(b,d);var e=new obips.gridview.ShowActionLinksEventEdge(null,null,f,obips.PivotTable.cloneEvent(saw.getEvent(j)),h,b,d,i,true);g.onDemandLoadAL(e)};PTPCAct=function(c,j){saw.stopEventPropagationAndNotify(j);var c=saw.getEventTarget(j);var k=obips.EdgeCoords.findCoords(c);var h=k.getId();var b=k.getEdge();var d=k.getLayer();var i=k.getSlice();var g=obips.ViewModel.getViewModelById(h);if(!g||!g.supportsFeature(obips.ViewRightClickMenu.FEATURE_ACTIONS)){return}var a=k.getElement();var f=obips.PivotTable.getActionLinkIdsFromElement(c);d=g.getPhysicalLayer(b,d);var e=new obips.gridview.ShowActionLinksEventEdge(null,null,f,obips.PivotTable.cloneEvent(saw.getEvent(j)),h,b,d,i,false);g.onDemandLoadAL(e)};PTPBAct=function(c,k){saw.stopEventPropagationAndNotify(k);var a=obips.DatabodyCoords.findCoords(c);if(!a){return}var j=a.getId();var b=a.getRow();var e=a.getCol();var h=obips.ViewModel.getViewModelById(j);if(!h||!h.supportsFeature(obips.ViewRightClickMenu.FEATURE_ACTIONS)){return}var i=h.getBodyDefinition(j);var d=i.getID(b,e);var l=a.getElement();var g=obips.PivotTable.getActionLinkIdsFromElement(l);var f=new obips.gridview.ShowActionLinksEventDataBody(null,null,g,obips.PivotTable.cloneEvent(saw.getEvent(k)),j,b,e,d);h.onDemandLoadAL(f)};obips.PivotTable.prototype.renderActionLinkMenu=function(g,n,h,b,f,l,p){var m=this.getEdgeDefinition(h);if(m.isMeasureLabelsLayer(b,f)){p=true}var d=obips.Analysis.getReport(this.reportStatePath);var i=d.getCriteria();var e=m.getColumnIDFromLayerID(b,f,l);var c=m.isLayerHierarchical(b,f);var k=null;if(c){k=m.getLevelID(b,f,l)}var j=i.shouldShowALPopupMenuForOneLink(e,p,k);var a=new ActionLinksModel(this,h,b,f,l,p,this.actionLinksXmlId);var o=new ActionLinksRenderer(a,g);o.displayLinks(n,j)};obips.PivotTable.prototype.renderActionLinkMenuForDataBody=function(f,l,h,b,e,d){var g=this.getBodyDefinition(h);var k=g.getValue(b,e);var a=new ActionLinksModel(this,h,obips.JSDataLayout.DATA_EDGE,b,e,false,this.actionLinksXmlId);a.setDataValue(d,k);var m=new ActionLinksRenderer(a,f);var c=obips.Analysis.getReport(this.reportStatePath);var i=c.getCriteria();var j=i.shouldShowALPopupMenuForOneLink(d,false);m.displayLinks(l,j)};obips.PivotTable.prototype.onDemandLoadAL=function(a){this.handleOnDemandLoadAL(a)};obips.PivotTable.prototype.handleOnDemandLoadAL=function(a){if(a.type){a.evt=obips.PivotTable.restoreClonedEventWhenNecessary(a.evt);if(a.type=="edge"){this.renderActionLinkMenu(a.actionLinkIds,a.evt,a.childPivotClientId,a.edge,a.layer,a.slice,a.bHeading)}else{this.renderActionLinkMenuForDataBody(a.actionLinkIds,a.evt,a.childPivotClientId,a.nRow,a.nCol,a.columnID)}}};PTRowScroll=function(e,b,f,a){if(a&&typeof(a.keyCode)!="undefined"&&a.keyCode!=0&&a.keyCode!=obips.PivotTable.kKeys.nEnterKey){return}var d=obips.ViewModel.getViewModelById(e);var c=d.getViewID();if(obips.views.ViewController.handleViewAction("Scroll",c,{StateAction:"samePageState",P5:b,rowsPerPage:f})){return}};obips.PivotTable.prototype._fetchViewDataModels=function(a){obips.ViewModelBase.log("_fetchViewDataModels "+a);return obips.PivotTable.superClass._fetchViewDataModels.call(this,a)};obips.PivotTable.prototype.updateReport=function(c,b,d){obips.PivotTable.eventComplete();var a=new obips.gridview.ViewXmlUpdatedEvent(this.getViewID(),this.reportStatePath,c,b,d);obips.AnalysisEventManager.raiseEvent(a);if(this.clientEventListener){obips.views.ViewController.getController(this.getViewID()).removeEventListener(this.clientEventListener)}};obips.PivotTable.prototype.getMouseDropPosition=function(n,f,c,i){var j=this.getJSDataLayout().getVisibleLayerCount(c);if(j==0){return obips.PivotTable.DROP_BEFORE_CENTER}if(i!="undefined"&&i==false){return obips.PivotTable.getBeforeOrAfterCenterMousePosition(n,f,c)}var a=f;var l=saw.isRToL();var g=l?document.body.clientWidth-n.clientX:n.clientX;var m=obips.PivotTable.resolveMouseX(g,a);var k=obips.PivotTable.resolveMouseY(n.clientY,a);if(c==obips.JSDataLayout.ROW_EDGE||c==obips.JSDataLayout.SECTION_EDGE||c==obips.JSDataLayout.PAGE_EDGE){var d=a.offsetWidth/3;var b=obips.PivotTable.getXCoord(a);if(m<(b+d)){return obips.PivotTable.DROP_BEFORE_CENTER}else{if(m>(b+(d*2))){return obips.PivotTable.DROP_AFTER_CENTER}else{return obips.PivotTable.DROP_IN_CENTER}}}else{if(c==obips.JSDataLayout.COLUMN_EDGE){var h=a.offsetHeight/3;var e=obips.PivotTable.getYCoord(a);if(k<e+h){return obips.PivotTable.DROP_BEFORE_CENTER}else{if(k>e+(h*2)){return obips.PivotTable.DROP_AFTER_CENTER}else{return obips.PivotTable.DROP_IN_CENTER}}}else{alert("no support for edge: "+c);return true}}};obips.PivotTable.getBeforeOrAfterCenterMousePosition=function(l,f,c,h){var a=f;var j=saw.isRToL();var g=j?document.body.clientWidth-l.clientX:l.clientX;var k=obips.PivotTable.resolveMouseX(g,a);var i=obips.PivotTable.resolveMouseY(l.clientY,a);if(c==obips.JSDataLayout.ROW_EDGE||c==obips.JSDataLayout.SECTION_EDGE||c==obips.JSDataLayout.PAGE_EDGE){var e=a.offsetWidth/2;var b=obips.PivotTable.getXCoord(a);if(k<b+e){return obips.PivotTable.DROP_BEFORE_CENTER}else{return obips.PivotTable.DROP_AFTER_CENTER}}else{if(c==obips.JSDataLayout.COLUMN_EDGE){var e=a.offsetHeight/2;var d=obips.PivotTable.getYCoord(a);if(i<d+e){return obips.PivotTable.DROP_BEFORE_CENTER}else{return obips.PivotTable.DROP_AFTER_CENTER}}else{alert("no support for edge: "+c);return true}}};obips.PivotTable.resolveMouseX=function(d,b,c){var a=0;if(!c){c=false}if(c){while(b!=null){a+=b.scrollLeft;b=b.offsetParent}}return d+a};obips.PivotTable.resolveMouseY=function(c,a,b){var d=0;if(!b){b=false}if(b){while(a!=null){d+=a.scrollTop;a=a.offsetParent}}return c+d};obips.PivotTable.getXCoord=function(a){return saw.calcAbsoluteLeft(a,false)};obips.PivotTable.getYCoord=function(a){return saw.calcAbsoluteTop(a,false)};obips.PivotTable.onSBStart=function(m,d,c){if(!d){return}var f=saw.getEventTarget(m);var l=d.getId();if(!obips.PivotTable.nodeAllowsFocus(f)&&!is_ie&&!saw.userAgent.is_appleapp){var b=document.getElementById(l);if(b){window.setTimeout(function(){b.focus()},0)}}var e=d.getRow();var h=d.getCol();var j=obips.ViewModel.getViewModelById(l);if(!j){return}var i=j.getBodyDefinition(l,false);var a=j.getMasterClientID();j.clearOtherChildPivotSelections(l);obips.PivotTable.resetSelectionFocus(a);if(i&&m.button&&m.button==2){var g="db_"+l+"_"+e+"_"+h;var k=i.isCellSelected(g);if(k){return}}if(!obips.PivotTable.isShiftKeyPressed(m)){obips.PivotTable.selectionChildPivotID=""}obips.PivotTable.ptCurrentEvent.eventType=obips.ViewModel.EventType.SELECTION_EVENT;obips.PivotTable.ptCurrentEvent.eventSrc=l;obips.PivotTable.ptCurrentEvent.eventSubType="body";obips.ViewModelBase.log("body selection set up")};obips.PivotTable.onMouseDown=function(b){if(obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.PIVOT_SWAP_EVENT){return false}var d=saw.getEventTarget(b);obips.ViewModelBase.log("onMouseDown");var a=obips.EdgeCoords.findCoords(d);if(a){var e=obips.ViewModel.getViewModelById(a.getId());if(e.handleStartRowColResize(b,d,a)==true){return}obips.PivotTable.onSEStart(b,a)}else{var c=obips.DatabodyCoords.findCoords(d);if(c){obips.PivotTable.onSBStart(b,c)}}return false};obips.PivotTable.onSEStart=function(l,m){if(!m){return}var d=saw.getEventTarget(l);var i=m.getId();var c=m.getEdge();if(c==obips.JSDataLayout.PAGE_EDGE||c==obips.JSDataLayout.SECTION_EDGE){return}if(!obips.PivotTable.nodeAllowsFocus(d)&&!is_ie&&!saw.userAgent.is_appleapp){var b=document.getElementById(i);if(b){window.setTimeout(function(){b.focus()},0)}}var e=m.getLayer();var j=m.getSlice();var g=obips.ViewModel.getViewModelById(i);var a=g.getMasterClientID();g.clearOtherChildPivotSelections(i);obips.PivotTable.resetSelectionFocus(a);var k=g.getEdgeDefinition(i,false);if(k&&l.button&&l.button==2){var f=obips.PivotTable.getCellId(i,c,e,j);var h=k.isCellSelected(f);if(h){return}}if(!obips.PivotTable.isShiftKeyPressed(l)){obips.PivotTable.selectionChildPivotID=""}obips.PivotTable.ptCurrentEvent.eventType=obips.ViewModel.EventType.SELECTION_EVENT;obips.PivotTable.ptCurrentEvent.eventSrc=i;obips.PivotTable.ptCurrentEvent.eventSubType="edge";obips.ViewModelBase.log("edge selection set up")};obips.PivotTable.isCtrlKeyPressed=function(a){var b;if(!a&&document.all){b=window.event.ctrlKey}else{b=a.ctrlKey}return b};obips.PivotTable.isShiftKeyPressed=function(b){var a;if(!b&&document.all){a=window.event.shiftKey}else{a=b.shiftKey}return a};obips.PivotTable.resetSelectionFocus=function(d){if(d&&obips.PivotTable.selectionLastFocus==d){return}obips.PivotTable.selectionLastFocus=d;var b=obips.ViewModel.getMasterViewModels();for(statePath in b){var a=obips.ViewModel.getMasterClientID(statePath);var c=obips.ViewModel.getViewModelById(a);if(c instanceof obips.PivotTable){if(d!=a){c.resetPivotSelections(true)}else{c.resetPivotSelections(false)}}}};obips.PivotTable.prototype.resetPivotSelections=function(c){var a=this.getChildViewModelIdList();for(var e=0;e<a.length;e++){var g=a[e];var f=this.getBodyDefinition(g,false);if(f){var d=f.getSelectedCells();for(var e in d){var l=d[e];if(c){this.grayCell(l)}else{this.unhighlightCell(l);this.highlightCell(l)}}}var k=this.getEdgeDefinition(g,false);if(k){var h=k.getSelectedCells();for(var b in h){var l=h[b];if(c){this.grayCell(l)}else{this.unhighlightCell(l);this.highlightCell(l)}}}}};obips.PivotTable.prototype.clearOtherChildPivotSelections=function(d){var c=this.getChildViewModelIdList();for(var a=0;a<c.length;a++){var b=c[a];if(d&&d==b){continue}this.unhighlightCellsAndClearSel(b)}};obips.PivotTable.handleInitialSelectionEdge=function(m,c,a){obips.ViewModelBase.log("highlighting inititial cell for edge selection");var t=a.getId();var f=a.getEdge();var s=a.getLayer();var o=a.getSlice();var q=obips.ViewModel.getViewModelById(t);var e=q.getEdgeDefinition(t);var h=q.getPhysicalLayer(f,s);if(e&&(m.button&&m.button==2||m.type&&m.type=="contextmenu")){var n=obips.PivotTable.getCellId(t,f,s,o);var b=e.isCellSelected(n);if(b){return}}var l=e.getEndSlice(f,h,o);var r=obips.PivotTable.isCtrlKeyPressed(m);var i=obips.PivotTable.isShiftKeyPressed(m);if(!r||obips.PivotTable.selectionRowStart>=0||f!=obips.PivotTable.selectionEdgeStart||s!=obips.PivotTable.selectionLayerStart){q.unhighlightCellsAndClearSel(t)}obips.PivotTable.selectionRowStart=-1;obips.PivotTable.selectionColStart=-1;if(i&&obips.PivotTable.selectionLayerStart>=0&&obips.PivotTable.selectionSliceStartSlice>=0&&obips.PivotTable.selectionEdgeStart>=0&&obips.PivotTable.selectionEdgeStart==f&&obips.PivotTable.selectionChildPivotID==t){var p;var j;if(o<obips.PivotTable.selectionSliceStartSlice&&s>obips.PivotTable.selectionLayerStart){p=Math.min(l,obips.PivotTable.selectionSliceEndSlice);j=Math.max(l,obips.PivotTable.selectionSliceEndSlice)}else{p=Math.min(o,obips.PivotTable.selectionSliceStartSlice);j=Math.max(l,obips.PivotTable.selectionSliceEndSlice)}q.highlightCorrespondingCellRange(t,f,s,p,j);q.highlightEdgeCellRange(t,f,s,s,p,j)}else{if(i&&o==-1){var d=Math.min(s,obips.PivotTable.selectionLayerStart);var g=Math.max(s,obips.PivotTable.selectionLayerStart);q.highlightLabelCellRange(t,f,d,g,-1,-1);var k=e.getEdgeExtent(f);q.highlightEdgeCellRange(t,f,d,g,0,k)}else{if(r&&q.isEdgeOrHeaderCellHighlighted(t,f,s,o)){q.unhighlightCorrespondingCellRange(t,f,s,o,l);q.unhighlightEdgeCell(t,f,s,o)}else{if(r&&s!=obips.PivotTable.selectionLayerStart){q.unhighlightCellsAndClearSel(t)}obips.PivotTable.selectionEdgeStart=f;obips.PivotTable.selectionLayerStart=s;obips.PivotTable.selectionSliceStartSlice=o;obips.PivotTable.selectionSliceEndSlice=l;obips.PivotTable.selectionChildPivotID=t;q.highlightCorrespondingCellRange(t,f,s,o,l);q.highlightEdgeCell(t,f,s,o)}}}};obips.PivotTable.handleInitialSelectionDatabody=function(m,e,a){obips.ViewModelBase.log("highlighting inititial cell for bodyselection");var l=a.getId();var c=a.getRow();var g=a.getCol();var h=obips.ViewModel.getViewModelById(l);var i=h.getBodyDefinition(l);if(i&&(m.button&&m.button==2||m.type&&m.type=="contextmenu")){var f="db_"+l+"_"+c+"_"+g;var k=i.isCellSelected(f);if(k){return}}var n=obips.PivotTable.isCtrlKeyPressed(m);var p=obips.PivotTable.isShiftKeyPressed(m);if(!n||obips.PivotTable.selectionSliceStartSlice>=0){h.unhighlightCellsAndClearSel(l)}obips.PivotTable.selectionEdgeStart=-1;obips.PivotTable.selectionLayerStart=-1;obips.PivotTable.selectionSliceStartSlice=-1;obips.PivotTable.selectionSliceEndSlice=-1;if(p&&obips.PivotTable.selectionRowStart>=0&&obips.PivotTable.selectionColStart>=0&&obips.PivotTable.selectionChildPivotID==l){var b=Math.min(c,obips.PivotTable.selectionRowStart);var j=Math.max(c,obips.PivotTable.selectionRowStart);var d=Math.min(g,obips.PivotTable.selectionColStart);var o=Math.max(g,obips.PivotTable.selectionColStart);h.highlightBodyCellRange(l,b,j,d,o)}else{if(n&&h.isBodyCellHighlighted(l,c,g)){h.unhighlightBodyCell(l,c,g)}else{obips.PivotTable.selectionRowStart=c;obips.PivotTable.selectionColStart=g;obips.PivotTable.selectionChildPivotID=l;h.highlightBodyCell(l,c,g)}}};obips.PivotTable.handleSelectionDrag=function(k,b){if(k.button&&k.button==2){return}if(!obips.PivotTable.ptCurrentEvent.eventType==obips.ViewModel.EventType.SELECTION_EVENT){return}var q=obips.PivotTable.isCtrlKeyPressed(k);if(obips.PivotTable.selectionChildPivotID==""){if(obips.PivotTable.ptCurrentEvent.eventSubType=="body"){var f=obips.DatabodyCoords.findCoords(b);if(!f){return}obips.PivotTable.handleInitialSelectionDatabody(k,b,f)}else{if(obips.PivotTable.ptCurrentEvent.eventSubType=="edge"){var a=obips.EdgeCoords.findCoords(b);if(!a){return}obips.PivotTable.handleInitialSelectionEdge(k,b,a)}}}else{if(obips.PivotTable.selectionRowStart>=0&&obips.PivotTable.selectionColStart>=0&&obips.PivotTable.ptCurrentEvent.eventSubType=="body"){var f=obips.DatabodyCoords.findCoords(b);if(!f){return}var t=f.getId();if(obips.PivotTable.selectionChildPivotID!=t){return}var u=f.getRow();var r=f.getCol();var o=obips.ViewModel.getViewModelById(t);var p=o.getBodyDefinition(t);o.clearOtherChildPivotSelections(t);var g=Math.min(u,obips.PivotTable.selectionRowStart);var m=Math.max(u,obips.PivotTable.selectionRowStart);var j=Math.min(r,obips.PivotTable.selectionColStart);var c=Math.max(r,obips.PivotTable.selectionColStart);if(!q){o.unhighlightCellsAndClearSel(t)}o.highlightBodyCellRange(t,g,m,j,c)}else{if(obips.PivotTable.selectionSliceStartSlice>=0&&obips.PivotTable.selectionLayerStart>=0&&obips.PivotTable.ptCurrentEvent.eventSubType=="edge"&&obips.PivotTable.selectionEdgeStart>=0){var a=obips.EdgeCoords.findCoords(b);if(!a){return}var t=a.getId();if(obips.PivotTable.selectionChildPivotID!=t){return}var e=a.getEdge();var s=a.getLayer();var l=a.getSlice();if(e!=obips.PivotTable.selectionEdgeStart){return}var o=obips.ViewModel.getViewModelById(t);var d=o.getEdgeDefinition(t);var i=d.getEndSlice(e,s,l);o.clearOtherChildPivotSelections(t);if(s<obips.PivotTable.selectionLayerStart){obips.PivotTable.selectionSliceStartSlice=d.getStartSlice(e,s,obips.PivotTable.selectionSliceStartSlice);obips.PivotTable.selectionSliceEndSlice=d.getEndSlice(e,s,obips.PivotTable.selectionSliceEndSlice)}var n;var h;if(l<obips.PivotTable.selectionSliceStartSlice&&s>obips.PivotTable.selectionLayerStart){n=Math.min(i,obips.PivotTable.selectionSliceEndSlice);h=Math.max(i,obips.PivotTable.selectionSliceEndSlice)}else{n=Math.min(l,obips.PivotTable.selectionSliceStartSlice);h=Math.max(i,obips.PivotTable.selectionSliceEndSlice)}if(!q||s!=obips.PivotTable.selectionLayerStart){o.unhighlightCellsAndClearSel(t)}obips.PivotTable.selectionEdgeStart=e;obips.PivotTable.selectionLayerStart=s;obips.PivotTable.selectionSliceStartSlice=n;obips.PivotTable.selectionSliceEndSlice=h;obips.PivotTable.selectionChildPivotID=t;o.highlightCorrespondingCellRange(t,e,s,n,h);o.highlightEdgeCellRange(t,e,s,s,n,h)}}}};obips.PivotTable.prototype.highlightBodyCellRange=function(f,d,e,h,a){for(var b=d;b<=e;b++){for(var g=h;g<=a;g++){this.highlightBodyCell(f,b,g)}}};obips.PivotTable.prototype.highlightCorrespondingCellRange=function(e,c,b,a,d){this.setHighlightCorrespondingCellRange(e,c,b,a,d,true)};obips.PivotTable.prototype.unhighlightCorrespondingCellRange=function(e,c,b,a,d){this.setHighlightCorrespondingCellRange(e,c,b,a,d,false)};obips.PivotTable.prototype.setHighlightCorrespondingCellRange=function(g,b,e,k,f,j){var l=this.getEdgeDefinition(g);if(k==-1){var i=l.getEdgeExtent(obips.JSDataLayout.ROW_EDGE);for(var m=0;m<=i;m++){if(j){this.highlightEdgeCell(g,b,e,m)}else{this.unhighlightEdgeCell(g,b,e,m)}}return}if(b==obips.JSDataLayout.ROW_EDGE){var d=l.getEdgeExtent(obips.JSDataLayout.COLUMN_EDGE);for(var m=k;m<=f;m++){for(var h=0;h<=d;h++){if(j){this.highlightBodyCell(g,m,h)}else{this.unhighlightBodyCell(g,m,h)}}}}else{var i=l.getEdgeExtent(obips.JSDataLayout.ROW_EDGE);for(var m=k;m<=f;m++){for(var a=0;a<=i;a++){if(j){this.highlightBodyCell(g,a,m)}else{this.unhighlightBodyCell(g,a,m)}}}}};obips.PivotTable.prototype.highlightLayer=function(g,f,c){var e="hl_"+g+"_"+f+"_"+c;var a=document.getElementById(e);var h=this.getEdgeDefinition(g);h.addCellToSelection(e,a);this.highlightCell(a);if(f==obips.JSDataLayout.ROW_EDGE||f==obips.JSDataLayout.COLUMN_EDGE||f==obips.JSDataLayout.SECTION_EDGE){this.highlightEdgeCellRange(g,f,c,c,0,h.getEdgeExtent(f))}if(f==obips.JSDataLayout.PAGE_EDGE||f==obips.JSDataLayout.SECTION_EDGE){var d=g+"_"+f+"_"+c+"_Tbl";var b=document.getElementById(d);h.addCellToSelection(d,b);this.highlightCell(b)}};obips.PivotTable.prototype.highlightLabelCellRange=function(g,e,a,d,c,f){for(var b=a;b<=d;b++){this.highlightEdgeCell(g,e,b,c)}};obips.PivotTable.prototype.highlightEdgeCellRange=function(h,f,a,d,c,g){for(var e=c;e<=g;e++){for(var b=a;b<=d;b++){this.highlightEdgeCell(h,f,b,e)}}};obips.PivotTable.prototype.unhighlightCellsAndClearSel=function(e){var d=this.getBodyDefinition(e,false);if(d){var g=d.getSelectedCells();for(var b in g){var a=g[b];this.unhighlightCell(a);d.removeCellFromSelection(b)}}var f=this.getEdgeDefinition(e,false);if(f){var c=f.getSelectedCells();for(var b in c){var a=c[b];this.unhighlightCell(a);f.removeCellFromSelection(b)}}};obips.PivotTable.prototype.highlightBodyCell=function(e,b,f){var d=this.getBodyDefinition(e);if(!d){return}var c="db_"+e+"_"+b+"_"+f;var a=document.getElementById(c);this.highlightCell(a);d.addCellToSelection(c,a);this.focusedCellType=obips.PivotTable.FOCUSED_CELL_TYPE_DATA;this.focusedCellCoords.row=b;this.focusedCellCoords.col=f};obips.PivotTable.prototype.unhighlightBodyCell=function(e,b,f){var d=this.getBodyDefinition(e);if(!d){return}var c="db_"+e+"_"+b+"_"+f;var a=document.getElementById(c);this.unhighlightCell(a);d.removeCellFromSelection(c)};obips.PivotTable.prototype.isBodyCellHighlighted=function(d,b,f){var e=this.getEdgeDefinition(d);var c="db_"+d+"_"+b+"_"+f;var a=document.getElementById(c);if(a.originalColor!=undefined){return true}return false};obips.PivotTable.prototype.highlightHeaderCell=function(e,d,b,f){var g=this.getEdgeDefinition(e);var c="hl_"+e+"_"+d+"_"+b;var a=document.getElementById(c);this.highlightCell(a);g.addCellToSelection(c,a);this.focusedCellType=obips.PivotTable.FOCUSED_CELL_TYPE_EDGE;this.focusedCellCoords.edge=d;this.focusedCellCoords.layer=b;this.focusedCellCoords.slice=f};obips.PivotTable.prototype.highlightEdgeCell=function(e,a,c,g){var h=this.getEdgeDefinition(e);var d=null;if(a==obips.JSDataLayout.SECTION_EDGE||a==obips.JSDataLayout.PAGE_EDGE){d=e+"_"+a+"_"+c+"_Tbl"}else{d=obips.PivotTable.getCellId(e,a,c,g)}var i=document.getElementById(d);this.highlightCell(i);h.addCellToSelection(d,i);this.focusedCellType=obips.PivotTable.FOCUSED_CELL_TYPE_EDGE;this.focusedCellCoords.edge=a;this.focusedCellCoords.layer=c;this.focusedCellCoords.slice=g;if(a==obips.JSDataLayout.COLUMN_EDGE&&h.itemSpansChildren(a,c,g)){var f=obips.PivotTable.getCellId(e,a,c,g)+"_sc";var b=document.getElementById(f);this.highlightCell(b);h.addCellToSelection(f,b)}};obips.PivotTable.prototype.isEdgeOrHeaderCellHighlighted=function(e,d,b,f){var g=this.getEdgeDefinition(e);var c;if(f==-1){c="hl_"+e+"_"+d+"_"+b}else{c=obips.PivotTable.getCellId(e,d,b,f)}var a=document.getElementById(c);if(a.originalColor!=undefined){return true}return false};obips.PivotTable.prototype.unhighlightEdgeCell=function(e,a,c,g){var h=this.getEdgeDefinition(e);var d=null;if(a==obips.JSDataLayout.SECTION_EDGE||a==obips.JSDataLayout.PAGE_EDGE){d=e+"_"+a+"_"+c+"_Tbl"}else{d=obips.PivotTable.getCellId(e,a,c,g)}var i=document.getElementById(d);this.unhighlightCell(i);h.removeCellFromSelection(d);if(a==obips.JSDataLayout.COLUMN_EDGE&&h.itemSpansChildren(a,c,g)){var f=obips.PivotTable.getCellId(e,a,c,g)+"_sc";var b=document.getElementById(f);this.unhighlightCell(b);h.removeCellFromSelection(f)}};obips.PivotTable.prototype.unhighlightCell=function(a){if(a){a.style.backgroundColor=a.originalColor;a.originalColor=null;if(a.originalBackgroundImage!=null){a.style.backgroundImage=a.originalBackgroundImage;a.originalBackgroundImage=null}}};obips.PivotTable.prototype.grayCell=function(a){if(a){var b=null;if(a.originalColor&&a.originalColor.length>0){b=this._getSelectionColor(a.originalColor)}if(b==null){a.style.backgroundColor=obips.PivotTable.cellSelectionUnfocusedColor}}};obips.PivotTable.prototype.highlightCell=function(a){if(a){if(a.originalColor==null){if(a.style!=null){a.originalColor=a.style.backgroundColor}if(a.originalColor==null){a.originalColor=""}}if(a.originalBackgroundImage==null){if(a.style!=null&&a.style.backgroundImage!=null){a.originalBackgroundImage=a.style.backgroundImage;a.style.backgroundImage="none"}}var b=null;if(a.originalColor.length>0){b=this._getSelectionColor(a.originalColor)}if(b==null){b=obips.PivotTable.cellSelectionColor}a.style.backgroundColor=b}};obips.PivotTable.prototype._getSelectionColor=function(e){var j=e;var c=-1;var d=-1;var l=-1;if(e.length==7&&e.charAt(0)=="#"){c=parseInt(e.substring(1,3),16);d=parseInt(e.substring(3,5),16);l=parseInt(e.substring(5,7),16)}else{if(e.indexOf("rgb")==0){var i=e.match(/\d+/g);if(i!=null&&i.length>2){c=i[0]-0;d=i[1]-0;l=i[2]-0}}}if(c>=0&&d>=0&&l>=0){var f=0.65;c=Math.round(c*f);d=Math.round(d*f);l=Math.round(l*f);if(l<50&&c<50&&d<50){l+=75;c+=75}else{if(c+d<30){c+=75}}var a=c.toString(16).toUpperCase();if(a.length==1){a="0"+a}var h=d.toString(16).toUpperCase();if(h.length==1){h="0"+h}var k=l.toString(16).toUpperCase();if(k.length==1){k="0"+k}j="#"+a+h+k}return j};PTTD=function(a,c){var b=saw.getEventTarget(a);if(!b){return}if(!b.originalSrc){b.originalSrc=b.src}};PTTDO=function(a,c){var b=saw.getEventTarget(a);if(!b||!b.originalSrc){return}b.src=b.originalSrc};obips.PivotTable.prototype.supportsFeature=function(b){var f=this.getPivotViewXML();if(!f){return false}var c=false;if(this.supportedFeatures[b]&&this.supportedFeatures[b]==1){c=true}var e=this.getReportXML();var a=e.selectSingleNode("saw:interactionOptions");var d=true;if(obips.PivotTable.isRuntimeMode()){if(a&&obips.PivotTable.interPropSettingsMap[b]){d=XUIGetAttributeBool(a,obips.PivotTable.interPropSettingsMap[b],true)}else{if(obips.PivotTable.interPropSettingsMap[b]){d=obips.Analysis.defaultInteractionPropertySettings(obips.PivotTable.interPropSettingsMap[b])}}}return d&&c};obips.PivotTable.isColumnMenuAvailable=function(b){var a=b.selectSingleNode("saw:interactionOptions");if(!a){return true}if(!XUIGetAttributeBool(a,"movecolumns",true)&&!XUIGetAttributeBool(a,"sortcolumns",true)&&!XUIGetAttributeBool(a,"addremovevalues",true)&&!XUIGetAttributeBool(a,"groupoperations",true)&&!XUIGetAttributeBool(a,"calcitemoperations",true)&&!XUIGetAttributeBool(a,"showhidesubtotal",true)&&!XUIGetAttributeBool(a,"showhiderunningsum",true)&&!XUIGetAttributeBool(a,"inclexclcolumns",true)&&!XUIGetAttributeBool(a,"hidecolumns",true)){return false}return true};obips.PivotTable.countChildNodes=function(c){var d=0;if(c&&c.childNodes&&c.childNodes.length>0){for(var b=0;b<c.childNodes.length;b++){var a=c.childNodes[b];if(a.nodeType!=1){continue}d++}}return d};obips.PivotTable.prototype.getChartViewXML=function(){var a="saw:nestedViews/saw:nestedView[@position!='embedded']/saw:view[@xsi:type='saw:dvtchart' or @xsi:type='saw:dvtmicrochart']";var b=this.getPivotViewXML();var c=b.selectSingleNode(a);return c};obips.PivotTable.prototype.getChartViewType=function(){var a=this.getChartViewXML();var b=a.selectSingleNode("saw:display");return XUIGetAttributeString(b,"type")};obips.PivotTable.prototype.isChartRowAndColumnSwapped=function(){return this.getChartViewType()=="pie"?false:true};obips.PivotTable.prototype.getActualEdgePos=function(b){var a=b;if(this.getViewType()=="pivotchart"&&this.isChartRowAndColumnSwapped()){if(b==obips.JSDataLayout.ROW_EDGE){a=obips.JSDataLayout.COLUMN_EDGE}else{if(b==obips.JSDataLayout.COLUMN_EDGE){a=obips.JSDataLayout.ROW_EDGE}}}return a};obips.PivotTable.prototype.processDVTChartEvent=function(c,b,a,d){if(obips.views.ViewController.handleViewAction(c,this.getViewID(),{graphId:a,graphStateXML:d,javahostEvent:b})){}};obips.PivotTable.prototype.addQDRDefinitionForSpecificMeasure=function(b,e){var g=this.getPivotViewXML();var f=g.selectSingleNode("saw:measuresList");var a=saw.getChildElementByIndex(f,e);var c=a.getAttribute("columnID");var d=XUICreateElement(saw.xml.kSawNamespace,"staticMemberGroup");XUISetAttributeString(d,"specialDimension","measure");this._buildMembersElement(false,true,true,d,"saw:specialValueMembers",c,false,false);b.appendChild(d)};obips.PivotTable.isColumnExcluded=function(c,b){var d=obips.PivotTable.isTable(c);var a=obips.PivotTable.containsNestedViews(c);if(!(c.selectSingleNode(".//saw:edges/saw:edge/saw:edgeLayers/saw:edgeLayer[@columnID='"+b+"']")||(!d&&c.selectSingleNode(".//saw:measuresList/saw:measure[@columnID='"+b+"']"))||(a&&c.selectSingleNode(".//saw:nestedViews//saw:columnRef[@columnID='"+b+"']")))){return true}return false};obips.PivotTable.getExcludedColumnIDs=function(h){var k=new Array();var g=obips.ViewModel.getViewModelById(h);var c=g.getPivotViewXML();var b=g.getReportXML();var j=b.selectSingleNode(".//saw:criteria/saw:columns");if(!j){return null}var f=j.selectNodes("saw:column");for(var d=0;d<f.length;d++){var a=f[d];var e=a.getAttribute("columnID");if(e!=""&&obips.PivotTable.isColumnExcluded(c,e)){k.push(e)}}return k};obips.PivotTable.fillIncludeColumnMenuOption=function(g,l,a,c){var m=obips.PivotTable.getExcludedColumnIDs(g);var f=new Array();if(m.length){var b=obips.ViewModel.EventType.INCLUDE_COLUMN_MENU_EVENT;for(var e=0;e<m.length;e++){var h=m[e];var k=obips.ReportMetadata.GetInstanceByStatePath(a).getColumnInfoByID(h);if(c&&((k.isMeasure&&!k.isMeasure())||!k.isMeasure)){continue}var d=obips.MetadataUtil.getColumnHeadingFromColumn(null,k);var j=obips.PivotTable.CreateContextMenuOption(d,d,null,null,b,l);j.columnID=h;f.push(j)}}return f};obips.PivotTable.getLocalizedString=function(d,b,c,a){if(!a){a=obips.ResourceManager.getSingleton().getResource(d,b)}return obips.ResourceManager.Resource.prototype.getString.apply(a,[""].concat(c))};obips.PivotTable.isRuntimeMode=function(){var a=XUIPanel.getEditor("idSelections");if(a==null){return true}else{return false}};obips.PivotTable.prototype.handleStartRowColResize=function(b,c,a){return false};obips.PivotTable.prototype.handleMouseMoveRowColResize=function(a,b,d,c){};obips.PivotTable.prototype.handleEndRowColResize=function(a,b){};obips.PivotTable.getCellId=function(d,c,a,e){var b="e_"+d+"_"+c+"_"+a+"_"+e;return b};obips.PivotTable.isShowingNumbers=function(c,b){var a=c.selectSingleNode(".//saw:measuresList/saw:measure[@columnID='"+b+"']");if(a&&XUIGetAttributeString(a,"type")=="view"){return false}return true};obips.PivotTable.prototype.isViewExpandable=function(a,c){if(a=="headlineView"){return false}var b=(XUIGetAttributeString(this.getViewXML(),"type","")=="singleviz");if(b){return false}return true};obips.PivotTable.prototype.viewExpandHandler=function(c){var d=5;var e=15;if(!saw.userAgent.is_touchdevice){var b=!this.isChartOnly&&this.getChartViewXML();var f=this.childViewIDList.length>1;if(f||b){d+=20}if(b){e+=20}}var a=document.getElementById(this.masterClientId+"PageEdgeElem");e+=a?a.offsetHeight:10;obips.views.getExpandedViewViewer().setExpandedViewStates({horizOffset:d,vertOffset:e});saw.log.debug("Expanding view "+c.sourceViewID+", width:"+c.clientWidth+" ,height:"+c.clientHeight+" ,VerticalOffset:"+e)};obips.PivotTable.prototype.viewRestoreHandler=function(a){saw.log.debug("Restoring view "+a.sourceViewID)}};