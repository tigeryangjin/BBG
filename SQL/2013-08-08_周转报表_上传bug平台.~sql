SELECT  A.DEPT,A.CLASS,A.LOC,
        SUM(A.SOH_COST)+SUM(A.DC_SOH_COST)                                代销日均库存额,
        SUM(A.SALE_COST)                                                  代销日销成本,
        SUM(A.DC_SOH_COST)                                                代销DC日均库存额,
        DECODE(SUM(A.SALE_COST),0,0,SUM(A.SOH_COST)/SUM(A.SALE_COST))     周转,
        DECODE(SUM(A.SALE_COST),0,0,SUM(A.DC_SOH_COST)/SUM(A.SALE_COST))  不含DC周转,
-----------------       
        SUM(B.SOH_COST)+SUM(B.DC_SOH_COST)                                经销日均库存额,
        SUM(B.SALE_COST)                                                  经销日销成本,
        SUM(B.DC_SOH_COST)                                                经销DC日均库存额,
        DECODE(SUM(B.SALE_COST),0,0,SUM(B.SOH_COST)/SUM(B.SALE_COST))     周转,
        DECODE(SUM(B.SALE_COST),0,0,SUM(B.DC_SOH_COST)/SUM(B.SALE_COST))  不含DC周转,
-----------------
       SUM(C.SOH_COST)+SUM(C.DC_SOH_COST)                                 合计日均库存额,
       SUM(C.SALE_COST)                                                   合计日销成本,
       SUM(C.DC_SOH_COST)                                                 合计DC日均库存额,
       DECODE(SUM(C.SALE_COST),0,0,SUM(C.SOH_COST)/SUM(C.SALE_COST))      周转,
       DECODE(SUM(C.SALE_COST),0,0,SUM(C.DC_SOH_COST)/SUM(C.SALE_COST))   不含DC周转
       
FROM 
--DX
(SELECT A.DEPT,A.CLASS,A.LOC,A.BUSINESS_MODE,A.SOH_COST,B.SALE_COST,C.DC_SOH_COST
   FROM (SELECT IM.DEPT,IM.CLASS,INV.ORG_NUM LOC,INFO.BUSINESS_MODE,SUM(INV.INV_SOH_COST_AMT_LCL_MN_AVG) SOH_COST
           FROM W_RTL_INV_IT_LC_MN_AVG2_FV@RMS_RA INV,ITEM_MASTER IM,CMX_ITEM_LOC_INFO INFO
          WHERE INV.PROD_NUM=IM.ITEM AND INFO.ITEM=IM.ITEM AND INFO.LOC=INV.ORG_NUM
            AND INV.MONTH='201307' AND INV.ORG_NUM>'120000' AND INFO.BUSINESS_MODE = 'DX'
       GROUP BY IM.DEPT,IM.CLASS,INV.ORG_NUM,INFO.BUSINESS_MODE)A,
    
(SELECT IM.DEPT,IM.CLASS,TDH.LOCATION LOC,INFO.BUSINESS_MODE,SUM(TDH.TOTAL_COST)/30 SALE_COST
   FROM TRAN_DATA_HISTORY TDH,ITEM_MASTER IM,CMX_ITEM_LOC_INFO INFO
  WHERE TDH.ITEM=IM.ITEM AND INFO.ITEM=IM.ITEM AND INFO.LOC=TDH.LOCATION AND TDH.TRAN_CODE IN (1,3) 
    AND TDH.TRAN_DATE BETWEEN DATE'2013-07-01' AND DATE'2013-07-31' AND INFO.BUSINESS_MODE ='DX'
GROUP BY IM.DEPT,IM.CLASS,TDH.LOCATION,INFO.BUSINESS_MODE)B,

(SELECT IM.DEPT,IM.CLASS,IL.LOC,INFO.BUSINESS_MODE,SUM(DCINV.INV_SOH_COST_AMT_LCL_MN_AVG) DC_SOH_COST
   FROM ITEM_MASTER IM,(SELECT ITEM,LOC,SOURCE_WH 
                       FROM ITEM_LOC 
                      WHERE SOURCE_METHOD='W')IL,CMX_ITEM_LOC_INFO INFO,W_RTL_INV_IT_LC_MN_AVG2_FV@RMS_RA DCINV
  WHERE IM.ITEM=IL.ITEM AND IL.LOC=INFO.LOC AND IM.ITEM=INFO.ITEM AND DCINV.ORG_NUM=IL.SOURCE_WH AND DCINV.PROD_NUM=IM.ITEM
    AND DCINV.MONTH='201307' AND IL.LOC>'120000' AND INFO.BUSINESS_MODE = 'DX'
GROUP BY IM.DEPT,IM.CLASS,IL.LOC,INFO.BUSINESS_MODE)C
WHERE A.DEPT=B.DEPT AND A.CLASS=B.CLASS AND A.LOC=B.LOC AND A.BUSINESS_MODE=B.BUSINESS_MODE AND 
      A.DEPT=C.DEPT AND A.CLASS=C.CLASS AND A.LOC=C.LOC AND A.BUSINESS_MODE=C.BUSINESS_MODE)A,
--JX
(SELECT A.DEPT,A.CLASS,A.LOC,A.BUSINESS_MODE,A.SOH_COST,B.SALE_COST,C.DC_SOH_COST
   FROM (SELECT IM.DEPT,IM.CLASS,INV.ORG_NUM LOC,INFO.BUSINESS_MODE,SUM(INV.INV_SOH_COST_AMT_LCL_MN_AVG) SOH_COST
           FROM W_RTL_INV_IT_LC_MN_AVG2_FV@RMS_RA INV,ITEM_MASTER IM,CMX_ITEM_LOC_INFO INFO
          WHERE INV.PROD_NUM=IM.ITEM AND INFO.ITEM=IM.ITEM AND INFO.LOC=INV.ORG_NUM
            AND INV.MONTH='201307' AND INV.ORG_NUM>'120000' AND INFO.BUSINESS_MODE ='JX'
       GROUP BY IM.DEPT,IM.CLASS,INV.ORG_NUM,INFO.BUSINESS_MODE)A,
    
(SELECT IM.DEPT,IM.CLASS,TDH.LOCATION LOC,INFO.BUSINESS_MODE,SUM(TDH.TOTAL_COST)/30 SALE_COST
   FROM TRAN_DATA_HISTORY TDH,ITEM_MASTER IM,CMX_ITEM_LOC_INFO INFO
  WHERE TDH.ITEM=IM.ITEM AND INFO.ITEM=IM.ITEM AND INFO.LOC=TDH.LOCATION AND TDH.TRAN_CODE IN (1,3) 
    AND TDH.TRAN_DATE BETWEEN DATE'2013-07-01' AND DATE'2013-07-31' AND INFO.BUSINESS_MODE ='JX'
GROUP BY IM.DEPT,IM.CLASS,TDH.LOCATION,INFO.BUSINESS_MODE)B,

(SELECT IM.DEPT,IM.CLASS,IL.LOC,INFO.BUSINESS_MODE,SUM(DCINV.INV_SOH_COST_AMT_LCL_MN_AVG) DC_SOH_COST
   FROM ITEM_MASTER IM,(SELECT ITEM,LOC,SOURCE_WH 
                          FROM ITEM_LOC 
                         WHERE SOURCE_METHOD='W')IL,CMX_ITEM_LOC_INFO INFO,W_RTL_INV_IT_LC_MN_AVG2_FV@RMS_RA DCINV
  WHERE IM.ITEM=IL.ITEM AND IL.LOC=INFO.LOC AND IM.ITEM=INFO.ITEM AND DCINV.ORG_NUM=IL.SOURCE_WH AND DCINV.PROD_NUM=IM.ITEM
    AND DCINV.MONTH='201307' AND IL.LOC>'120000' AND INFO.BUSINESS_MODE ='JX'
GROUP BY IM.DEPT,IM.CLASS,IL.LOC,INFO.BUSINESS_MODE)C
WHERE A.DEPT=B.DEPT AND A.CLASS=B.CLASS AND A.LOC=B.LOC AND A.BUSINESS_MODE=B.BUSINESS_MODE AND 
      A.DEPT=C.DEPT AND A.CLASS=C.CLASS AND A.LOC=C.LOC AND A.BUSINESS_MODE=C.BUSINESS_MODE)B,
--合计     
(SELECT A.DEPT,A.CLASS,A.LOC,A.BUSINESS_MODE,A.SOH_COST,B.SALE_COST,C.DC_SOH_COST
   FROM (SELECT IM.DEPT,IM.CLASS,INV.ORG_NUM LOC,INFO.BUSINESS_MODE,SUM(INV.INV_SOH_COST_AMT_LCL_MN_AVG) SOH_COST
           FROM W_RTL_INV_IT_LC_MN_AVG2_FV@RMS_RA INV,ITEM_MASTER IM,CMX_ITEM_LOC_INFO INFO
          WHERE INV.PROD_NUM=IM.ITEM AND INFO.ITEM=IM.ITEM AND INFO.LOC=INV.ORG_NUM
            AND INV.MONTH='201307' AND INV.ORG_NUM>'120000' AND INFO.BUSINESS_MODE IN ('JX','DX')
       GROUP BY IM.DEPT,IM.CLASS,INV.ORG_NUM,INFO.BUSINESS_MODE)A,
    
(SELECT IM.DEPT,IM.CLASS,TDH.LOCATION LOC,INFO.BUSINESS_MODE,SUM(TDH.TOTAL_COST)/30 SALE_COST
   FROM TRAN_DATA_HISTORY TDH,ITEM_MASTER IM,CMX_ITEM_LOC_INFO INFO
  WHERE TDH.ITEM=IM.ITEM AND INFO.ITEM=IM.ITEM AND INFO.LOC=TDH.LOCATION AND TDH.TRAN_CODE IN (1,3) 
    AND TDH.TRAN_DATE BETWEEN DATE'2013-07-01' AND DATE'2013-07-31' AND INFO.BUSINESS_MODE IN ('JX','DX')
GROUP BY IM.DEPT,IM.CLASS,TDH.LOCATION,INFO.BUSINESS_MODE)B,

(SELECT IM.DEPT,IM.CLASS,IL.LOC,INFO.BUSINESS_MODE,SUM(DCINV.INV_SOH_COST_AMT_LCL_MN_AVG) DC_SOH_COST
   FROM ITEM_MASTER IM,(SELECT ITEM,LOC,SOURCE_WH 
                          FROM ITEM_LOC 
                         WHERE SOURCE_METHOD='W')IL,CMX_ITEM_LOC_INFO INFO,W_RTL_INV_IT_LC_MN_AVG2_FV@RMS_RA DCINV
  WHERE IM.ITEM=IL.ITEM AND IL.LOC=INFO.LOC AND IM.ITEM=INFO.ITEM AND DCINV.ORG_NUM=IL.SOURCE_WH AND DCINV.PROD_NUM=IM.ITEM
    AND DCINV.MONTH='201307' AND IL.LOC>'120000' AND INFO.BUSINESS_MODE IN ('JX','DX')
GROUP BY IM.DEPT,IM.CLASS,IL.LOC,INFO.BUSINESS_MODE)C
WHERE A.DEPT=B.DEPT AND A.CLASS=B.CLASS AND A.LOC=B.LOC AND A.BUSINESS_MODE=B.BUSINESS_MODE AND 
      A.DEPT=C.DEPT AND A.CLASS=C.CLASS AND A.LOC=C.LOC AND A.BUSINESS_MODE=C.BUSINESS_MODE)C
      
WHERE A.DEPT=B.DEPT AND A.CLASS=B.CLASS AND A.LOC=B.LOC
  AND A.DEPT=C.DEPT AND A.CLASS=C.CLASS AND A.LOC=C.LOC
GROUP BY A.DEPT,A.CLASS,A.LOC
ORDER BY A.DEPT,A.CLASS,A.LOC
