--退货接口
--源表:BBG_RA_RTV_REF_V
--目标表:BBG_RA_RTV_IT_LC_DY_FS
--此接口可以开始导入数据了.
--unique constraint (RADM.PK_BBG_RA_RTV_IT_LC_SUPP_DY_F) violated
--RADM.PK_BBG_RA_RTV_IT_LC_SUPP_DY_F:PROD_WID, ORG_WID, DT_WID, SUPPLIER_WID, BBG_ITEM_LOC_WID, BBG_ITEM_LOC_SUPP_WID
--已导入2013-10-09
SELECT COUNT(*) FROM BBG_RA_RTV_REF_V;
SELECT DISTINCT DAY_DT FROM BBG_RA_RTV_REF_V;
SELECT DISTINCT DAY_DT FROM BBG_RA_RTV_IT_LC_DY_FS;
SELECT COUNT(*) FROM BBG_RA_RTV_IT_LC_DY_FS;
SELECT * FROM BBG_RA_RTV_REF_V WHERE DAY_DT = DATE '2013-10-08';
SELECT DISTINCT T.DAY_DT FROM RABATCHER.BBG_RA_RTV_IT_LC_SUPP_DY_TMP T;
SELECT DISTINCT DT_WID FROM BBG_RA_RTV_IT_LC_SUPP_DY_F T;
TRUNCATE TABLE RABATCHER.BBG_RA_RTV_IT_LC_SUPP_DY_TMP;
TRUNCATE TABLE BBG_RA_RTV_IT_LC_DY_FS;
--订单收货接口
--源表:  BBG_RA_SUPPCM_REF_V
--目标表:W_RTL_SUPPCM_IT_LC_DY_FS
--此接口可以开始导入数据了.
--ORG_DH_WID, PROD_WID, DT_WID, SUPPLIER_WID, PURCHASE_ORDER_ID, SHIPMENT_ID, BBG_ITEM_LOC_WID, BBG_ITEM_LOC_SUPP_WID
--此历史数据只能一个月一个月处理
SELECT DISTINCT DAY_DT FROM BBG_RA_SUPPCM_REF_V T;
SELECT DISTINCT DAY_DT FROM W_RTL_SUPPCM_IT_LC_DY_FS T;
TRUNCATE TABLE W_RTL_SUPPCM_IT_LC_DY_FS;
SELECT COUNT(*) FROM BBG_RA_SUPPCM_REF_V;
SELECT COUNT(*) FROM W_RTL_SUPPCM_IT_LC_DY_FS;
SELECT * FROM BBG_RA_SUPPCM_REF_V T;
SELECT * FROM W_RTL_SUPPCM_IT_LC_DY_FS T;
SELECT DISTINCT DT_WID FROM W_RTL_SUPPCM_IT_LC_DY_F T ORDER BY T.DT_WID;
SELECT * FROM RABATCHER.W_RTL_SUPPCM_IT_LC_DY_TMP;
--W_RTL_SUPPCM_IT_LC_DY_FS备份
--SDE已经全部跑完
CREATE TABLE W_RTL_SUPPCM_IT_LC_DY_FS_BAK AS
  SELECT * FROM W_RTL_SUPPCM_IT_LC_DY_FS;
--分月插回W_RTL_SUPPCM_IT_LC_DY_FS表
--经过测试，导入2013年1月到4月的数据，很耗时，所以每次只能导一个月
TRUNCATE TABLE RADM.C_LOAD_DATES;
TRUNCATE TABLE RA_RMS.C_LOAD_DATES;
TRUNCATE TABLE RADM.W_RTL_SUPPCM_IT_LC_DY_FS;

INSERT INTO W_RTL_SUPPCM_IT_LC_DY_FS
  SELECT *
    FROM W_RTL_SUPPCM_IT_LC_DY_FS_BAK T
   WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) = '201101';

SELECT * FROM W_RTL_SUPPCM_IT_LC_DY_FS;

SELECT SUBSTR(TO_CHAR(DAY_DT, 'YYYYMMDD'), 1, 6), COUNT(*)
  FROM W_RTL_SUPPCM_IT_LC_DY_FS_BAK
 GROUP BY SUBSTR(TO_CHAR(DAY_DT, 'YYYYMMDD'), 1, 6);
--************************************************************************************************************************************************************
--************************************************************************************************************************************************************
--销售接口
--BBG_SDE_BBG_RA_SLS_TRX_REF_HISTORY_F
--源表:  BBG_RA_SLS_TRX_REF_V
--目标表:W_RTL_SLS_TRX_IT_LC_DY_FS
--INTEGRATION_ID:BBG_RA_SLS_TRX_REF_V.SLS_TRX_ID||'~'||BBG_RA_SLS_TRX_REF_V.PROD_IT_NUM||'~'||BBG_RA_SLS_TRX_REF_V.DAY_DT||'~'||BBG_RA_SLS_TRX_REF_V.ORG_NUM||'~'||BBG_RA_SLS_TRX_REF_V.BBG_RETAIL_TYPE_ID
--BBG_RA_SLS_TRX_REF_V备份到BBG_RA_SLS_TRX_REF_V_BAK
CREATE TABLE BBG_RA_SLS_TRX_REF_V_BAK AS
  SELECT * FROM BBG_RA_SLS_TRX_REF_V;
--修改历史数据源视图
SELECT * FROM BBG_RA_SLS_TRX_REF_V;

--检查历史数据源视图日期
SELECT DISTINCT DAY_DT FROM BBG_RA_SLS_TRX_REF_V ORDER BY DAY_DT;
--检查历史数据源视图行数
SELECT COUNT(*) FROM BBG_RA_SLS_TRX_REF_V;
--物理源表
SELECT * FROM BBG_RA_SLS_TRX_REF_201305;

--清除日志
TRUNCATE TABLE RA_RMS.C_LOAD_DATES;
TRUNCATE TABLE RADM.C_LOAD_DATES;
--检查数据
--检查ＦＳ表
SELECT COUNT(*) FROM W_RTL_SLS_TRX_IT_LC_DY_FS T;
314529
  SELECT T.DAY_DT, COUNT(*)
    FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
   GROUP BY T.DAY_DT
            --检查Ｆ表
              SELECT COUNT(*)
                FROM W_RTL_SLS_TRX_IT_LC_DY_F T
               WHERE DT_WID BETWEEN 120130507000 AND 120130507000;


SELECT *
  FROM W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE DT_WID BETWEEN 120130507000 AND 120130507000;
--检查商品,如果存在的商品，可能没有插入ｆ表
SELECT *
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 WHERE NOT EXISTS (SELECT 1
          FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP A
         WHERE T.PROD_IT_NUM = A.PROD_IT_NUM);
--*********************************************************************************************
--检查合计金额
--BBG_RA_SLS_TRX_REF_V
SELECT T.DAY_DT, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM BBG_RA_SLS_TRX_REF_V T
 GROUP BY T.DAY_DT
 ORDER BY T.DAY_DT;

--W_RTL_SLS_TRX_IT_LC_DY_FS
SELECT T.DAY_DT, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 GROUP BY T.DAY_DT
 ORDER BY T.DAY_DT;

--W_RTL_SLS_TRX_IT_LC_DY_F
SELECT T.DT_WID, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE DT_WID BETWEEN 120130430000 AND 120130430000
 GROUP BY T.DT_WID
 ORDER BY T.DT_WID;

--W_RTL_SLS_TRX_IT_LC_DY_TMP
SELECT T.Dt_Wid, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
 GROUP BY T.Dt_Wid
 ORDER BY T.DT_WID;
--W_RTL_SLS_SC_LC_DY_A
SELECT t.dt_wid, SUM(SLS_QTY),SUM(SLS_AMT_LCL)
  FROM W_RTL_SLS_SC_LC_DY_A T
 WHERE T.DT_WID = 120130430000
 group by t.dt_wid;

--
SELECT DISTINCT DAY_DT FROM BBG_RA_SLS_TRX_REF_V_BAK T ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM BBG_RA_SLS_TRX_REF_V T ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM W_RTL_SLS_TRX_IT_LC_DY_FS T ORDER BY DAY_DT;
SELECT DISTINCT DT_WID FROM W_RTL_SLS_TRX_IT_LC_DY_F T ORDER BY DT_WID;
SELECT DISTINCT DT_WID
  FROM W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID BETWEEN 120130301000 AND 120130301000
 ORDER BY DT_WID;
SELECT DISTINCT DT_WID
  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
 WHERE T.DT_WID < 120130508000
 ORDER BY DT_WID;

DELETE W_RTL_SLS_TRX_IT_LC_DY_F T WHERE T.DT_WID = '120130301000';
--UC4
SELECT * FROM W_RTL_SLS_IT_DY_A T WHERE T.DT_WID < 120130508000;

SELECT MIN(DT_WID) FROM W_RTL_SLS_TRX_IT_LC_DY_F T;
--*************************************************************************************************************************************
--*************************************************************************************************************************************
--FS表备份
CREATE TABLE W_RTL_SLS_TRX_IT_LC_DY_FS_BAK AS
  SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_FS;

SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_FS_BAK;
SELECT DISTINCT DAY_DT FROM W_RTL_SLS_TRX_IT_LC_DY_FS_BAK;

DROP TABLE W_RTL_SLS_TRX_IT_LC_DY_FS_BAK;

--备份表插回源表
TRUNCATE TABLE W_RTL_SLS_TRX_IT_LC_DY_FS;

truncate table RADM.c_load_dates;

INSERT INTO W_RTL_SLS_TRX_IT_LC_DY_FS
  SELECT *
    FROM W_RTL_SLS_TRX_IT_LC_DY_FS_BAK
   WHERE DAY_DT /*=DATE'2012-07-24'*/
         BETWEEN DATE '2011-05-06' AND DATE '2011-05-10';

SELECT DISTINCT DAY_DT FROM W_RTL_SLS_TRX_IT_LC_DY_FS ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM W_RTL_SLS_TRX_IT_LC_DY_FS_BAK;

--*************************************************************************************************************************************
--*************************************************************************************************************************************
--导入历史销售,SIL部分报错,从RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP表插入W_RTL_SLS_TRX_IT_LC_DY_F表
--unique index RADM.PK_W_RTL_SLS_TRX_IT_LC_DY_F initially in unusable state
--RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP重复
SELECT T.PROD_IT_WID,
       T.SLS_TRX_ID,
       T.VOUCHER_ID,
       T.DT_WID,
       T.RTL_TYPE_WID,
       T.SRC_REF_NO6,
       T.BBG_ITEM_LOC_WID,
       T.BBG_RETAIL_TYPE_WID,
       T.ORG_WID,
       COUNT(*)
  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
 GROUP BY T.PROD_IT_WID,
          T.SLS_TRX_ID,
          T.VOUCHER_ID,
          T.DT_WID,
          T.RTL_TYPE_WID,
          T.SRC_REF_NO6,
          T.BBG_ITEM_LOC_WID,
          T.BBG_RETAIL_TYPE_WID,
          T.ORG_WID
HAVING COUNT(*) > 1
 ORDER BY COUNT(*) DESC;

SELECT *
  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
 WHERE T.PROD_IT_WID = '261674'
   AND T.SLS_TRX_ID = '-1'
   AND T.VOUCHER_ID = '-1'
   AND T.DT_WID = '120130416000'
   AND T.RTL_TYPE_WID = 4
   AND T.BBG_ITEM_LOC_WID = '15915460'
   AND T.BBG_RETAIL_TYPE_WID = 1
   AND T.ORG_WID = 62;
--W_RTL_SLS_TRX_IT_LC_DY_FS重复
SELECT T.PROD_IT_NUM,
       T.SLS_TRX_ID,
       T.VOUCHER_ID,
       T.DAY_DT,
       T.RTL_TYPE_CODE,
       T.SRC_REF_NO6,
       T.BBG_RETAIL_TYPE_ID,
       T.ORG_NUM,
       count(*)
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 GROUP BY T.PROD_IT_NUM,
          T.SLS_TRX_ID,
          T.VOUCHER_ID,
          T.DAY_DT,
          T.RTL_TYPE_CODE,
          T.SRC_REF_NO6,
          T.BBG_RETAIL_TYPE_ID,
          T.ORG_NUM
HAVING COUNT(*) > 1
 ORDER BY COUNT(*) DESC;

SELECT *
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 WHERE T.PROD_IT_NUM = '800043984'
   AND T.SLS_TRX_ID = '-1'
   AND T.VOUCHER_ID = '-1'
   AND T.DAY_DT = DATE '2013-04-17'
   AND T.RTL_TYPE_CODE = 'R'
   AND T.SRC_REF_NO6 = '800043984'
   AND T.BBG_RETAIL_TYPE_ID = 1
   AND T.ORG_NUM = '120129'

--bbg_ra_sls_trx_ref_201304表重复
  SELECT T.PROD_IT_NUM,
         T.SLS_TRX_ID,
         T.VOUCHER_ID,
         T.DAY_DT,
         T.RTL_TYPE_CODE,
         T.BBG_RETAIL_TYPE_ID,
         T.ORG_NUM,
         count(*)
          FROM bbg_ra_sls_trx_ref_201304 T
         GROUP BY T.PROD_IT_NUM,
            T.SLS_TRX_ID,
            T.VOUCHER_ID,
            T.DAY_DT,
            T.RTL_TYPE_CODE,
            T.BBG_RETAIL_TYPE_ID,
            T.ORG_NUM
        HAVING COUNT(*) > 1
         ORDER BY COUNT(*) DESC;


SELECT *
  FROM bbg_ra_sls_trx_ref_201304 T
 WHERE T.PROD_IT_NUM = '800043984'
   AND T.SLS_TRX_ID = '-1'
   AND T.VOUCHER_ID = '-1'
   AND T.DAY_DT = DATE '2013-04-17'
   AND T.RTL_TYPE_CODE = 'R'
   AND T.BBG_RETAIL_TYPE_ID = 1
   AND T.ORG_NUM = '120129'

  SELECT *
          FROM bbg_ra_sls_trx_ref_201304 T
         WHERE T.PROD_IT_NUM = '800044689'
           AND T.SLS_TRX_ID = '-1'
           AND T.VOUCHER_ID = '-1'
           AND T.DAY_DT = DATE '2013-04-16'
           AND T.RTL_TYPE_CODE = 'R'
           AND T.BBG_RETAIL_TYPE_ID = 1
           AND T.ORG_NUM = '120129'
        
        --bbg_ra_sls_trx_ref_v表重复
          SELECT T.PROD_IT_NUM,
                 T.SLS_TRX_ID,
                 T.VOUCHER_ID,
                 T.DAY_DT,
                 T.RTL_TYPE_CODE,
                 T.BBG_RETAIL_TYPE_ID,
                 T.ORG_NUM,
                 count(*)
                  FROM bbg_ra_sls_trx_ref_v T
                 GROUP BY T.PROD_IT_NUM,
                    T.SLS_TRX_ID,
                    T.VOUCHER_ID,
                    T.DAY_DT,
                    T.RTL_TYPE_CODE,
                    T.BBG_RETAIL_TYPE_ID,
                    T.ORG_NUM
                HAVING COUNT(*) > 1
                 ORDER BY COUNT(*) DESC;



SELECT DISTINCT T.DT_WID
  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
       --*************************************************************************************************************************************
       --*************************************************************************************************************************************
       --备份 RABATCHER.W_RTL_SLS_IT_LC_DY_TMP t
        CREATE TABLE RABATCHER.W_RTL_SLS_IT_LC_DY_TMP_BAK AS
         SELECT * FROM RABATCHER.W_RTL_SLS_IT_LC_DY_TMP;


--W_RTL_SLS_IT_LC_DY_TMP_BAK插回源表
INSERT INTO RABATCHER.W_RTL_SLS_IT_LC_DY_TMP
  SELECT * FROM RABATCHER.W_RTL_SLS_IT_LC_DY_TMP_BAK;

SELECT DISTINCT DT_WID FROM RABATCHER.W_RTL_SLS_IT_LC_DY_TMP_BAK;
--W_PRODUCT_D_RTL_TMP.SRC_EFF_FROM_DT和SRC_EFF_TO_DT不在历史数据范围内
--W_INT_ORG_DH_RTL_TMP.EFFECTIVE_FROM_DT,EFFECTIVE_TO_DT
--W_INT_ORG_D_RTL_TMP.EFFECTIVE_FROM_DT,EFFECTIVE_TO_DT
--EMPLOYEE_NUM改称'001'
--插入W_RTL_SLS_TRX_IT_LC_DY_F和RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP,一天的销售47万行,10分钟
UPDATE W_RTL_SLS_TRX_IT_LC_DY_FS T
   SET T.EMPLOYEE_NUM = '001'
                       
                       --执行SDE接口时报：ErrorDetails:Target tablename W_RTL_MKDN_IT_LC_DY_FS not defined in C_ODI_PARAM
                       --参考表里现有数据select
                         SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_F;


SELECT *
  FROM RA_RMS.C_ODI_PARAM
 WHERE INTEGRATION_ID LIKE '%SIL%'
   FOR UPDATE;
SELECT *
  FROM RA_RMS.C_ODI_PARAM
 WHERE PARAM_NAME = 'LOC_NUM_OF_THREAD'
   FOR UPDATE;
insert into RA_RMS.C_ODI_PARAM
  (INTEGRATION_ID,
   row_wid,
   SCENARIO_NAME,
   SCENARIO_VERSION,
   PARAM_NAME,
   PARAM_VALUE,
   CREATED_ON_DT,
   CHANGE_ON_DT);

truncate table ra_rms.c_load_dates;
truncate table RADM.c_load_dates

--SIL多进程
刷新变量 RA_BI.RA_THREAD_NUM :SELECT * --PARAM_VALUE 
FROM RADM.C_ODI_PARAM WHERE PARAM_NAME = 'LOC_NUM_OF_THREAD' AND SCENARIO_NAME = (case when upper(substr('MASTER_SIL_BBG_RETAIL_SALESTRANSACTIONFACT', 1, 6)) = 'MASTER' then substr('MASTER_SIL_BBG_RETAIL_SALESTRANSACTIONFACT', 8, LENGTH('MASTER_SIL_BBG_RETAIL_SALESTRANSACTIONFACT')) else 'MASTER_SIL_BBG_RETAIL_SALESTRANSACTIONFACT' end)
  SELECT *
    FROM RADM.C_ODI_PARAM
   WHERE INTEGRATION_ID LIKE '%SALESTRANSACTIONFACT%'
     FOR UPDATE;
SELECT MAX(ROW_WID) FROM RADM.C_ODI_PARAM; --10424
SELECT * FROM RADM.C_ODI_PARAM;
--删除销售汇总表
--WK周汇总表都没有数据
DELETE W_RTL_SLS_TRX_IT_LC_DY_F T WHERE T.DT_WID = '120110101000';
DELETE RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
 WHERE T.DT_WID = '120110101000';
SELECT *
  FROM ALL_ALL_TABLES
 WHERE OWNER = 'RADM'
   AND TABLE_NAME LIKE '%W_RTL_SLS%A%';

DELETE W_RTL_SLS_CL_DY_CUR_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_CL_LC_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_CL_LC_DY_CUR_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_CL_LC_MN_A T WHERE T.MN_WID = '201101';
DELETE W_RTL_SLS_CL_LC_MN_CUR_A T WHERE T.MN_WID = '201101';
--DELETE W_RTL_SLS_CL_LC_WK_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_CL_LC_WK_CUR_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_CL_WK_CUR_A T WHERE T.DT_WID='120110101000' ;
DELETE W_RTL_SLS_DP_DY_CUR_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_DP_LC_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_DP_LC_DY_CUR_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_DP_LC_MN_A T WHERE T.MN_WID = '201101';
DELETE W_RTL_SLS_DP_LC_MN_CUR_A T WHERE T.MN_WID = '201101';
--DELETE W_RTL_SLS_DP_LC_WK_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_DP_LC_WK_CUR_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_DP_WK_CUR_A T WHERE T.DT_WID='120110101000' ;
DELETE W_RTL_SLS_IT_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_IT_DY_SN_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_IT_LC_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_IT_LC_DY_SN_A T WHERE T.DT_WID = '120110101000';
--DELETE W_RTL_SLS_IT_LC_WK_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_IT_LC_WK_SN_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_IT_WK_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_IT_WK_SN_A T WHERE T.DT_WID='120110101000' ;
DELETE W_RTL_SLS_LC_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_LC_MN_A T WHERE T.MN_WID = '201101';
--DELETE W_RTL_SLS_LC_WK_A T WHERE T.DT_WID='120110101000' ;
DELETE W_RTL_SLS_SC_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_SC_DY_CUR_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_SC_LC_DY_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_SC_LC_DY_CUR_A T WHERE T.DT_WID = '120110101000';
DELETE W_RTL_SLS_SC_LC_MN_A T WHERE T.MN_WID = '201101';
DELETE W_RTL_SLS_SC_LC_MN_CUR_A T WHERE T.MN_WID = '201101';
--DELETE W_RTL_SLS_SC_LC_WK_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_SC_LC_WK_CUR_A T WHERE T.DT_WID='120110101000' ;
DELETE W_RTL_SLS_SC_MN_A T WHERE T.MN_WID = '201101';
DELETE W_RTL_SLS_SC_MN_CUR_A T WHERE T.MN_WID = '201101';
--DELETE W_RTL_SLS_SC_WK_A T WHERE T.DT_WID='120110101000' ;
--DELETE W_RTL_SLS_SC_WK_CUR_A T WHERE T.DT_WID='120110101000' ;

SELECT * FROM W_RTL_SLS_CL_LC_MN_A;
SELECT * FROM W_RTL_SLS_CL_LC_MN_CUR_A WHERE MN_WID = '201101';
SELECT * FROM W_RTL_SLS_SC_LC_MN_A WHERE MN_WID = '201101';
SELECT * FROM W_RTL_SLS_SC_MN_CUR_A WHERE MN_WID = '201101';
--UC4跑PLP部分报错,有重复值
--RABATCHER.W_RTL_SLS_IT_LC_DY_TMP重复
RADM.W_RTL_SLS_IT_LC_DY_A

  select PROD_IT_WID,
         ORG_WID,
         RTL_TYPE_WID,
         DT_WID,
         VOUCHER_FLG,
         BBG_RETAIL_TYPE_WID,
         COUNT(*)
    from RABATCHER.W_RTL_SLS_IT_LC_DY_TMP t
   GROUP BY PROD_IT_WID,
            ORG_WID,
            RTL_TYPE_WID,
            DT_WID,
            VOUCHER_FLG,
            BBG_RETAIL_TYPE_WID
  HAVING COUNT(*) > 1
   order by COUNT(*) desc;

SELECT *
  FROM RABATCHER.W_RTL_SLS_IT_LC_DY_TMP T
 WHERE T.PROD_IT_WID = '281245'
   AND T.ORG_WID = '25'
   AND T.RTL_TYPE_WID = '1'
   AND DT_WID = '120110101000'
   AND T.VOUCHER_FLG = 'N'
   AND T.BBG_RETAIL_TYPE_WID = 5;

--W_RTL_SLS_TRX_IT_LC_DY_FS重复
SELECT T.PROD_IT_NUM,
       T.ORG_NUM,
       DAY_DT,
       T.RTL_TYPE_CODE,
       T.VOUCHER_ID,
       T.BBG_RETAIL_TYPE_ID,
       COUNT(*)
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 GROUP BY T.PROD_IT_NUM,
          T.ORG_NUM,
          DAY_DT,
          T.RTL_TYPE_CODE,
          T.VOUCHER_ID,
          T.BBG_RETAIL_TYPE_ID
HAVING COUNT(*) > 1;

SELECT *
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 WHERE T.PROD_IT_NUM = '800340511'
   AND T.ORG_NUM = '120110'
   AND DAY_DT = DATE '2013-08-15'
   AND T.RTL_TYPE_CODE = 'P'
   AND T.VOUCHER_ID = '-1'
   AND T.BBG_RETAIL_TYPE_ID = '20';

--BBG_RA_SLS_TRX_REF_V重复
SELECT T.PROD_IT_NUM,
       T.ORG_NUM,
       T.DAY_DT,
       T.RTL_TYPE_CODE,
       T.VOUCHER_ID,
       T.BBG_RETAIL_TYPE_ID,
       COUNT(t.rtl_type_code)
  FROM BBG_RA_SLS_TRX_REF_201101 T
 GROUP BY T.PROD_IT_NUM,
          T.ORG_NUM,
          T.DAY_DT,
          T.RTL_TYPE_CODE,
          T.VOUCHER_ID,
          T.BBG_RETAIL_TYPE_ID
HAVING COUNT(*) > 1;

SELECT T.PROD_IT_NUM,
       T.ORG_NUM,
       T.DAY_DT,
       T.VOUCHER_ID,
       T.BBG_RETAIL_TYPE_ID,
       COUNT(*)
  FROM BBG_RA_SLS_TRX_REF_201101 T
 WHERE T.DAY_DT = DATE '2011-01-01'
 GROUP BY T.PROD_IT_NUM,
          T.ORG_NUM,
          T.DAY_DT,
          T.RTL_TYPE_CODE,
          T.VOUCHER_ID,
          T.BBG_RETAIL_TYPE_ID
HAVING COUNT(*) > 1
 ORDER BY COUNT(*) DESC;

SELECT *
  FROM BBG_RA_SLS_TRX_REF_201101 T
 WHERE T.PROD_IT_NUM = '800326209'
   AND T.ORG_NUM = '120127'
   AND T.DAY_DT = DATE '2011-01-01' --AND T.RTL_TYPE_CODE='P';
  SELECT DISTINCT T.RTL_TYPE_CODE FROM BBG_RA_SLS_TRX_REF_201101 t;


--FS中的ITEM_LOC不在 RADM.BBG_RA_ITEM_LOC_D中的
--销售导入的临时表
--BBG_RA_SLS_TRX_REF_201201
SELECT DISTINCT T.PROD_IT_NUM, T.ORG_NUM
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 WHERE NOT EXISTS (SELECT 1
          FROM RADM.BBG_RA_ITEM_LOC_D D
         WHERE T.PROD_IT_NUM = D.ITEM
           AND T.ORG_NUM = D.LOC);

CREATE TABLE YJ_ITEM_LOC AS
  SELECT DISTINCT T.PROD_IT_NUM, T.ORG_NUM
    FROM BBG_RA_SLS_TRX_REF_201201 T
   WHERE NOT EXISTS (SELECT 1
            FROM RADM.BBG_RA_ITEM_LOC_D D
           WHERE T.PROD_IT_NUM = D.ITEM
             AND T.ORG_NUM = D.LOC);

INSERT INTO YJ_ITEM_LOC
  (PROD_IT_NUM, ORG_NUM, MONTH)
  SELECT DISTINCT T.PROD_IT_NUM, T.ORG_NUM, '201205'
    FROM BBG_RA_SLS_TRX_REF_201205 T
   WHERE NOT EXISTS (SELECT 1
            FROM RADM.BBG_RA_ITEM_LOC_D D
           WHERE T.PROD_IT_NUM = D.ITEM
             AND T.ORG_NUM = D.LOC);
COMMIT;

SELECT DISTINCT T.PROD_IT_NUM, T.ORG_NUM
  FROM YJ_ITEM_LOC T
 ORDER BY T.PROD_IT_NUM, T.ORG_NUM;

SELECT * FROM BBG_RA_SLS_TRX_REF_201201;
SELECT * FROM BBG_RA_SLS_TRX_REF_201203;

1 800056849 120055 2 800056849 120055 3 800056849 120055

  SELECT *
    FROM RADM.BBG_RA_ITEM_LOC_D T
   WHERE ITEM = 800056849
     AND LOC = 120055;

--************************************************************************************************************************************************************
--************************************************************************************************************************************************************
/*调拨 BBG_RA_INVTSF_REF
供应商销售 BBG_RA_SUPP_SLS_REF */
--供应商销售接口
--源表：  BBG_RA_SUPP_SLS_REF_V
--目标表：BBG_RA_SLS_IT_LC_DY_FS
--the PLP Step of ODI in UC4 KSH that name is:BBG.CMX.RA.F20_SUPP_SALES
SELECT * FROM BBG_RA_SUPP_SLS_REF_V;
SELECT COUNT(*) FROM BBG_RA_SUPP_SLS_REF_V;
SELECT MIN(DT_WID) FROM RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_IT_LC_DY_FS;
SELECT * FROM RADM.BBG_RA_SLS_IT_LC_DY_FS;
SELECT * FROM RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F;
SELECT * FROM RABATCHER.BBG_RA_SUPP_SLS_IT_LC_DY_TMP;
--BBG_RA_SUPP_SLS_REF重复行检查
SELECT T.DAY_DT, T.PROD_IT_NUM, T.ORG_NUM, T.SUPPLIER_NUM
  FROM BBG_RA_SUPP_SLS_REF T
 GROUP BY T.DAY_DT, T.PROD_IT_NUM, T.ORG_NUM, T.SUPPLIER_NUM
HAVING COUNT(*) > 1;
--清除数据
TRUNCATE TABLE BBG_RA_SLS_IT_LC_DY_FS;
TRUNCATE TABLE RA_RMS.C_LOAD_DATES;
TRUNCATE TABLE RADM.C_LOAD_DATES;
TRUNCATE TABLE RABATCHER.BBG_RA_SUPP_SLS_IT_LC_DY_TMP;

--delete RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F data
DELETE RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F T
 WHERE T.DT_WID BETWEEN '120130101000' AND '120130131000';
COMMIT;
--验证数据插入
--FS
SELECT T.day_dt,
       SUM(T.supp_sales_qty) supp_sales_qty,
       SUM(T.supp_sales_amt) supp_sales_amt
  FROM RADM.BBG_RA_SUPP_SLS_REF_V T
 GROUP BY T.day_dt
 ORDER BY T.DAY_DT;
--TMP
SELECT T.DAY_DT,
       SUM(T.SUPP_SALES_QTY) SUPP_SALES_QTY,
       SUM(T.SUPP_SALES_COST) SUPP_SALES_COST,
       SUM(T.SUPP_SALES_AMT) SUPP_SALES_AMT
  FROM RABATCHER.BBG_RA_SUPP_SLS_IT_LC_DY_TMP T
 GROUP BY T.DAY_DT
 ORDER BY T.DAY_DT;
--F
SELECT T.DT_WID,
       SUM(T.SUPP_SALES_QTY) SUPP_SALES_QTY,
       SUM(T.SUPP_SALES_COST) SUPP_SALES_COST,
       SUM(T.SUPP_SALES_AMT) SUPP_SALES_AMT
  FROM RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F T
 WHERE T.DT_WID BETWEEN '120130401000' AND '120130430000'
 GROUP BY T.DT_WID
 ORDER BY T.DT_WID;
--A
SELECT T.DT_WID,
       SUM(T.SUPP_SALES_QTY) SUPP_SALES_QTY,
       SUM(T.SUPP_SALES_COST) SUPP_SALES_COST,
       SUM(T.SUPP_SALES_AMT) SUPP_SALES_AMT
  FROM RADM.BBG_RA_SLS_IT_LC_DY_A T
 WHERE T.DT_WID BETWEEN '120130401000' AND '120130430000'
 GROUP BY T.DT_WID
 ORDER BY T.DT_WID;
-----查找差异
SELECT *
  FROM BBG_RA_SUPP_SLS_REF_V T
 WHERE (T.prod_it_num, T.supplier_num, T.org_num) NOT IN
       (SELECT DISTINCT T.prod_it_num, T.supplier_num, T.org_num
          FROM RABATCHER.BBG_RA_SUPP_SLS_IT_LC_DY_TMP T);
--BBG_RA_SUPP_SLS_REF_V record
SELECT *
  FROM BBG_RA_SUPP_SLS_REF_V T
 WHERE T.prod_it_num = '800000002'
   AND T.org_num = '120010'
   AND T.supplier_num = '37000207';
--ITEM_LOC record
SELECT *
  FROM BBG_RA_ITEM_LOC_D T
 WHERE T.ITEM = '800000002'
   AND T.LOC = '120010';
--ITEM_LOC_SUPP record
SELECT *
  FROM BBG_RA_ITEM_LOC_SUPP_D T
 WHERE T.ITEM = '800000002'
   AND T.LOC = '120010'
   AND T.SUPPLIER = '37000207';
--BBG_RA_SUPP_SLS_IT_LC_DY_TMP record
SELECT *
  FROM RADM.BBG_RA_SUPP_SLS_IT_LC_DY_TMP T
 WHERE T.PROD_IT_NUM = '800000002'
   AND T.ORG_NUM = '120010'
   AND T.SUPPLIER_NUM = '37000207';
--insert into BBG_RA_ITEM_LOC_D not exists record,REF_NO4='HISTORY'
INSERT INTO RADM.BBG_RA_ITEM_LOC_D D
  (D.ROW_WID,
   D.ITEM,
   D.LOC,
   D.NBB,
   D.NBO,
   D.SALE_TYPE,
   D.STANDARD_GROSS_MARGIN,
   D.PROMO_GROSS_MARGIN,
   D.BUSINESS_MODE,
   D.ZC_IND,
   D.ZG_IND,
   D.HERO_ITEM_IND,
   D.NEW_ITEM_FLAG,
   D.REF_NO1,
   D.REF_NO2,
   D.REF_NO3,
   D.REF_NO4,
   D.SRC_EFF_FROM_DT,
   D.SRC_EFF_TO_DT,
   D.EFFECTIVE_FROM_DT,
   D.EFFECTIVE_TO_DT,
   D.CURRENT_FLG,
   D.W_INSERT_DT,
   D.W_UPDATE_DT,
   D.DATASOURCE_NUM_ID,
   D.ETL_PROC_WID,
   D.INTEGRATION_ID,
   D.X_CUSTOM)
  SELECT RA_SIL_ITEM_LOC_D_SEQ.NEXTVAL, --ROW_WID
         T.PROD_IT_NUM, --ITEM
         T.ORG_NUM, --LOC
         '', --NBB 
         'N', --NBO
         '', --SALE_TYPE
         '', --STANDARD_GROSS_MARGIN
         '', --PROMO_GROSS_MARGIN
         D.BUSINESS_MODE, --BUSINESS_MODE
         '', --ZC_IND
         '', --ZG_IND
         '', --HERO_ITEM_IND
         '', --NEW_ITEM_FLAG
         '', --REF_NO1
         '', --REF_NO2
         '', --REF_NO3
         'HISTORY', --REF_NO4
         DATE '2012-01-01', --SRC_EFF_FROM_DT
         '', --SRC_EFF_TO_DT
         DATE '2012-01-01', --EFFECTIVE_FROM_DT
         D.EFFECTIVE_FROM_DT - 1, --EFFECTIVE_TO_DT
         'N', --CURRENT_FLG
         SYSDATE, --W_INSERT_DT
         SYSDATE, --W_UPDATE_DT
         1, --DATASOURCE_NUM_ID
         100, --ETL_PROC_WID
         T.PROD_IT_NUM || '~' || T.ORG_NUM, --INTEGRATION_ID
         '' --X_CUSTOM
    FROM (SELECT DISTINCT S.PROD_IT_NUM, S.ORG_NUM
            FROM RADM.BBG_RA_SUPP_SLS_REF S) T,
         (SELECT T.ITEM,
                 T.LOC,
                 MAX(T.BUSINESS_MODE) BUSINESS_MODE,
                 MIN(T.EFFECTIVE_FROM_DT) EFFECTIVE_FROM_DT
            FROM RADM.BBG_RA_ITEM_LOC_D T
           GROUP BY T.ITEM, T.LOC) D
   WHERE T.PROD_IT_NUM(+) = D.ITEM
     AND T.ORG_NUM(+) = D.LOC
     AND (T.PROD_IT_NUM, T.ORG_NUM) NOT IN
         (SELECT M.ITEM, M.LOC
            FROM (SELECT IL.ITEM,
                         IL.LOC,
                         MIN(IL.EFFECTIVE_FROM_DT) EFFECTIVE_FROM_DT,
                         MAX(IL.EFFECTIVE_TO_DT) EFFECTIVE_TO_DT
                    FROM RADM.BBG_RA_ITEM_LOC_D IL
                   GROUP BY IL.ITEM, IL.LOC) M
           WHERE M.EFFECTIVE_FROM_DT <= DATE '2012-01-01'
             AND M.EFFECTIVE_TO_DT >= DATE '2013-05-06');

--check insert into RADM.BBG_RA_ITEM_LOC_D record
SELECT T.ITEM, T.LOC, COUNT(*)
  FROM RADM.BBG_RA_ITEM_LOC_D T
 WHERE (T.ITEM, T.LOC) IN (SELECT A.ITEM, A.LOC
                             FROM RADM.BBG_RA_ITEM_LOC_D A
                            WHERE A.REF_NO4 = 'HISTORY')
 GROUP BY T.ITEM, T.LOC
HAVING COUNT(*) > 1
 ORDER BY COUNT(*) DESC;

--执行SDE接口时报：ErrorDetails:Target tablename W_RTL_MKDN_IT_LC_DY_FS not defined in C_ODI_PARAM
SELECT *
  FROM RA_RMS.C_ODI_PARAM
 WHERE SCENARIO_NAME LIKE '%SUPP%SALES%'
   FOR UPDATE;
--插入C_ODI_PARAM表
SELECT *
  FROM RADM.C_ODI_PARAM T
 WHERE T.SCENARIO_NAME LIKE '%BBG_SIL_BBG_RA_SUPP_SALES%'
   FOR UPDATE;
--插入BBG_RA_ITEM_LOC_SUPP_D表
SELECT * FROM BBG_RA_ITEM_LOC_SUPP_D;
select * from BBG_RA_SUPP_SLS_REF t;
--insert into BBG_RA_ITEM_LOC_SUPP_D not exists record ,REF_NO4='HISTORY'
INSERT INTO BBG_RA_ITEM_LOC_SUPP_D D
  (D.ROW_WID,
   D.ITEM,
   D.SUPPLIER,
   D.ORIGIN_COUNTRY_ID,
   D.LOC,
   D.LOGISTICS_DELIVERY_MODEL,
   D.DESC_CHINESE,
   D.DESC_ENGLISH,
   D.REF_NO1,
   D.REF_NO2,
   D.REF_NO3,
   D.REF_NO4,
   D.SRC_EFF_FROM_DT,
   D.SRC_EFF_TO_DT,
   D.EFFECTIVE_FROM_DT,
   D.EFFECTIVE_TO_DT,
   D.CURRENT_FLG,
   D.W_INSERT_DT,
   D.W_UPDATE_DT,
   D.DATASOURCE_NUM_ID,
   D.ETL_PROC_WID,
   D.INTEGRATION_ID,
   D.X_CUSTOM)
  SELECT RA_SIL_ITEM_LOC_SUPP_D_SEQ.NEXTVAL, --ROW_WID
         T.PROD_IT_NUM, --ITEM
         T.SUPPLIER_NUM, --SUPPLIER
         'CN', --ORIGIN_COUNTRY_ID
         T.ORG_NUM, --LOC
         'S', --LOGISTICS_DELIVERY_MODEL
         '配送', --DESC_CHINESE
         '配送', --DESC_ENGLISH
         '', --REF_NO1
         'N', --REF_NO2
         '', --REF_NO3
         'HISTORY', --REF_NO4
         DATE '2012-01-01', --SRC_EFF_FROM_DT
         '', --SRC_EFF_TO_DT
         DATE '2012-01-01', --EFFECTIVE_FROM_DT
         DATE '2013-05-06', --EFFECTIVE_TO_DT
         'N', --CURRENT_FLG
         SYSDATE, --W_INSERT_DT
         SYSDATE, --W_UPDATE_DT
         1, --DATASOURCE_NUM_ID
         100, --ETL_PROC_WID
         T.PROD_IT_NUM || '~' || T.SUPPLIER_NUM || '~' || 'CN' || '~' ||
         T.ORG_NUM, --INTEGRATION_ID
         '' --X_CUSTOM
    FROM (SELECT DISTINCT T.ORG_NUM, T.SUPPLIER_NUM, T.PROD_IT_NUM
            FROM BBG_RA_SUPP_SLS_REF T) T;
--检查BBG_RA_ITEM_LOC_SUPP_D
SELECT T.ITEM, T.SUPPLIER, T.LOC, COUNT(*)
  FROM BBG_RA_ITEM_LOC_SUPP_D T
 GROUP BY T.ITEM, T.SUPPLIER, T.LOC
HAVING COUNT(*) > 1;
SELECT *
  FROM BBG_RA_ITEM_LOC_SUPP_D T
 WHERE T.ITEM = '800215795'
   AND T.SUPPLIER = '12000209'
   AND T.LOC = '120144';

--************************************************************************************************************************************************************
--************************************************************************************************************************************************************
--库存调整接口
--源表：  BBG_RA_INVADJ_REF_V
--目标表：BBG_RA_INVADJ_IT_LC_DY_FS
--BBG_SDE_BBG_RA_INVADJ_IT_LC_DY_HISTORY_F 成功
SELECT * FROM BBG_RA_INVADJ_REF_V;
SELECT * FROM BBG_RA_INVADJ_IT_LC_DY_FS;
SELECT * FROM BBG_RA_INVADJ_IT_LC_DY_F;
SELECT * FROM RABATCHER.BBG_RA_INVADJ_IT_LC_DY_TMP;

SELECT distinct day_dt FROM BBG_RA_INVADJ_REF_V;
SELECT distinct day_dt FROM BBG_RA_INVADJ_IT_LC_DY_FS;
SELECT DISTINCT REASON FROM BBG_RA_INVADJ_IT_LC_DY_FS;
SELECT DISTINCT DAY_DT
  FROM RABATCHER.BBG_RA_INVADJ_IT_LC_DY_TMP
 ORDER BY DAY_DT;
SELECT DISTINCT DT_WID FROM BBG_RA_INVADJ_IT_LC_DY_F ORDER BY DT_WID;

TRUNCATE TABLE BBG_RA_INVADJ_IT_LC_DY_FS;
TRUNCATE TABLE RABATCHER.BBG_RA_INVADJ_IT_LC_DY_TMP;
--BBG_RA_INVADJ_IT_LC_DY_TMP重复
SELECT DT_WID,
       PROD_WID,
       ORG_WID,
       BBG_ITEM_LOC_WID,
       ADJUSTMENT_REASON_WID,
       COUNT(*)
  From RABATCHER.BBG_RA_INVADJ_IT_LC_DY_TMP
 GROUP BY DT_WID,
          PROD_WID,
          ORG_WID,
          BBG_ITEM_LOC_WID,
          ADJUSTMENT_REASON_WID
HAVING COUNT(*) > 1
 ORDER BY COUNT(*) DESC;

SELECT *
  FROM RABATCHER.BBG_RA_INVADJ_IT_LC_DY_TMP T
 WHERE T.DT_WID = '120111031000'
   AND T.PROD_WID = '660001'
   AND T.ORG_WID = '114'
   AND T.BBG_ITEM_LOC_WID = '28729444'
   AND T.ADJUSTMENT_REASON_WID = '73';

SELECT *
  FROM BBG_RA_INVADJ_REF_V T
 WHERE T.day_dt = DATE '2011-10-31'
   AND T.item = '800231104'
   AND T.location = '120122'
   AND T.reason = 88;
--************************************************************************************************************************************************************
--************************************************************************************************************************************************************
--调拨接口
--源表：  BBG_RA_INVTSF_REF_V
--目标表：BBG_RA_INVTSF_IT_LC_DY_FS
/*TRANSFER_TYPE_ID
CASE
　WHEN FROM_LOC_TYPE = 'S'AND TO_LOC_TYPE = 'S'THEN　1
　WHEN FROM_LOC_TYPE = 'W'AND TO_LOC_TYPE = 'S'THEN　2
　WHEN FROM_LOC_TYPE = 'S'AND TO_LOC_TYPE = 'W'THEN　3
　ELSE　0
END*/
--TRAN_CODE 30转入 32转出
SELECT *
  FROM RADM.C_ODI_PARAM
 WHERE SCENARIO_NAME LIKE '%INVTSF%'
   FOR UPDATE;
SELECT * FROM BBG_RA_INVTSF_REF_V;
SELECT * FROM BBG_RA_INVTSF_IT_LC_DY_FS;
SELECT DISTINCT DAY_DT FROM BBG_RA_INVTSF_IT_LC_DY_FS;
SELECT * FROM BBG_RA_INVTSF_IT_LC_DY_F;
SELECT DISTINCT DT_WID FROM BBG_RA_INVTSF_IT_LC_DY_F;
SELECT MIN(DT_WID) FROM BBG_RA_INVTSF_IT_LC_DY_F;
SELECT * FROM RABATCHER.BBG_RA_INVTSF_IT_LC_DY_TMP;
SELECT DISTINCT DAY_DT FROM RABATCHER.BBG_RA_INVTSF_IT_LC_DY_TMP;
select * from BBG_RA_INVTSF_IT_LC_DY_FV T;
SELECT MAX(DAY_DT) FROM BBG_RA_INVTSF_REF;
SELECT DISTINCT DAY_DT FROM BBG_RA_INVTSF_REF;

--TRANSFER
SELECT * FROM RMS.TSFHEAD T WHERE T.TSF_NO = 3000865895;
SELECT * FROM RMS.TSFDETAIL T WHERE T.TSF_NO = 3000865895;
SELECT *
  FROM RMS.IF_TRAN_DATA T
 WHERE T.REF_NO_1 = 3000865895
   AND T.TRAN_CODE IN (30, 32);
SELECT *
  FROM BBG_RA_INVTSF_IT_LC_DY_FV@RA_RMS_DBLINK T
 WHERE T.ITEM = 100365277
   AND T.FROM_LOC = 118001
   AND T.TO_LOC = 120024;
SELECT *
  FROM BBG_RA_INVTSF_IT_LC_DY_FV@RA_RMS_DBLINK T
 WHERE T.BBG_REFERENCE_DO3 = 'TRANSFER';
SELECT *
  FROM BBG_RA_INVTSF_IT_LC_DY_FV@RA_RMS_DBLINK T
 WHERE T.BBG_REFERENCE_DO3 = 'ALLOC';
--ALLOC
SELECT * FROM RMS.shipment T WHERE T.shipment = 1029522;
SELECT * FROM RMS.SHIPSKU T WHERE T.SHIPMENT = 1029522;
SELECT *
  FROM RMS.IF_TRAN_DATA T
 WHERE T.REF_NO_2 = 1029522
   AND T.TRAN_CODE IN (30, 32)
   AND T.ITEM =;
SELECT * FROM RMS.ALLOC_HEADER T WHERE T.ALLOC_NO = 1001677232;
SELECT * FROM RMS.ALLOC_DETAIL T WHERE T.ALLOC_NO = 1001677232;
SELECT *
  FROM BBG_RA_INVTSF_IT_LC_DY_FV T
 WHERE T.ITEM = 800326946
   AND T.FROM_LOC = 118001
   AND T.TO_LOC = 120024;

TRUNCATE TABLE BBG_RA_INVTSF_IT_LC_DY_FS;
TRUNCATE TABLE RA_RMS.C_LOAD_DATES;
TRUNCATE TABLE RADM.C_LOAD_DATES;
TRUNCATE TABLE RABATCHER.BBG_RA_INVTSF_IT_LC_DY_TMP;

SELECT COUNT(*) FROM BBG_RA_INVTSF_REF_V;
SELECT * FROM BBG_RA_INVTSF_IT_LC_DY_FS;
--************************************************************************************************************************************************************
--************************************************************************************************************************************************************

--历史库存导入
--库存
SELECT * FROM W_RTL_INV_IT_LC_DY_F;
--供应商库存
SELECT * FROM BBG_RA_SUPP_INV_IT_LC_DY_F;

SELECT * FROM BBG_RA_INV_REF_V;
SELECT COUNT(*) FROM BBG_RA_INV_REF;
SELECT * FROM ALL_ALL_TABLES T WHERE T.TABLE_NAME LIKE '%INV%';
SELECT MAX(MN_WID) FROM BBG_RA_SUPP_INV_CL_LC_MN_A;

------------------------------------------------------------------
------------------------------------------------------------------
--销售和供应商销售(历史)核对
--销售
--历史数据源视图
--BBG_RA_SLS_TRX_REF_V
SELECT SUBSTR(TO_CHAR(T.day_dt, 'YYYYMMDD'), 1, 6) MONTH,
       T.org_num,
       SUM(T.sls_qty) sls_qty,
       SUM(T.sls_amt_lcl) sls_amt_lcl
  FROM BBG_RA_SLS_TRX_REF_V T
 GROUP BY SUBSTR(TO_CHAR(T.day_dt, 'YYYYMMDD'), 1, 6), T.org_num
 ORDER BY T.org_num;
--RA
select SUBSTR(T.DT_WID, 2, 6) MONTH,
       ORG.ORG_NUM,
       SUM(T.SLS_QTY) SLS_QTY,
       SUM(T.SLS_AMT_LCL) SLS_AMT_LCL
  from W_RTL_SLS_TRX_IT_LC_DY_F t, W_INT_ORG_D ORG
 WHERE T.ORG_WID = ORG.ROW_WID
   AND T.DT_WID BETWEEN '120130101000' AND '120130131000'
 GROUP BY ORG.ORG_NUM, SUBSTR(T.DT_WID, 2, 6)
 ORDER BY ORG.ORG_NUM;

SELECT SUBSTR(A.DT_WID, 2, 6) MONTH,
       ORG.ORG_NUM,
       SUM(A.SLS_QTY) SLS_QTY,
       SUM(A.SLS_AMT_LCL) SLS_AMT_LCL
  FROM W_RTL_SLS_IT_LC_DY_A A, W_INT_ORG_D ORG
 WHERE A.ORG_WID = ORG.ROW_WID
   AND A.DT_WID BETWEEN '120130101000' AND '120130131000'
 GROUP BY ORG.ORG_NUM, SUBSTR(A.DT_WID, 2, 6)
 ORDER BY ORG.ORG_NUM;
--SALEDETAIL
SELECT SUBSTR(T.SD0101, 1, 6) MONTH,
       SUBSTR(T.SHOPID, 2, 2) || SUBSTR(T.SHOPID, 1, 1) ||
       SUBSTR(T.SHOPID, 4, 3) ORG_NUM,
       SUM(T.AMT),
       SUM(T.SD0104 * T.SD0105),
       SUM(T.AMT) - SUM(T.SD0104 * T.SD0105)
  FROM RADM.SALEDETAIL T
 WHERE T.SD0101 BETWEEN '20130101' AND '20130131'
 GROUP BY SUBSTR(T.SD0101, 1, 6),
          SUBSTR(T.SHOPID, 2, 2) || SUBSTR(T.SHOPID, 1, 1) ||
          SUBSTR(T.SHOPID, 4, 3)
 ORDER BY SUBSTR(T.SHOPID, 2, 2) || SUBSTR(T.SHOPID, 1, 1) ||
          SUBSTR(T.SHOPID, 4, 3);
--SALEDETAIL,bbg_ra_sls_trx_ref_201303,W_RTL_SLS_TRX_IT_LC_DY_F,W_RTL_SLS_IT_LC_DY_A
SELECT SUBSTR(T.SD0101, 1, 6) MONTH,
       SUM(T.AMT),
       SUM(T.SD0104),
       SUM(T.SD0104 * T.SD0105),
       SUM(T.AMT) - SUM(T.SD0104 * T.SD0105)
  FROM RADM.SALEDETAIL T
 WHERE T.SD0101 BETWEEN '20130101' AND '20130131'
 GROUP BY SUBSTR(T.SD0101, 1, 6);
SELECT SUM(T.SLS_QTY),
       SUM(T.SLS_AMT_LCL),
       SUM(T.RET_QTY),
       SUM(T.RET_AMT_LCL),
       SUM(T.SLS_QTY - T.RET_QTY),
       SUM(T.SLS_AMT_LCL - T.RET_AMT_LCL)
  FROM bbg_ra_sls_trx_ref_201301 T
 WHERE T.DAY_DT BETWEEN DATE '2013-01-01' AND DATE '2013-01-31';
SELECT SUM(T.SLS_QTY),
       SUM(T.SLS_AMT_LCL),
       SUM(T.RET_QTY),
       SUM(T.RET_AMT_LCL),
       SUM(T.SLS_QTY - T.RET_QTY),
       SUM(T.SLS_AMT_LCL - T.RET_AMT_LCL)
  FROM W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE T.DT_WID BETWEEN '120130101000' AND '120130131000';
SELECT SUM(T.SLS_QTY),
       SUM(T.SLS_AMT_LCL),
       SUM(T.RET_QTY),
       SUM(T.RET_AMT_LCL),
       SUM(T.SLS_QTY - T.RET_QTY),
       SUM(T.SLS_AMT_LCL - T.RET_AMT_LCL)
  FROM W_RTL_SLS_IT_LC_DY_A T
 WHERE T.DT_WID BETWEEN '120130101000' AND '120130131000';
--
SELECT SUM(S.AMT), SUM(S.SD0104 * S.SD0105)
  FROM RADM.SALEDETAIL S, RADM.SALECOST C
 WHERE S.SHEETID = C.SHEETID
   AND C.SDATE BETWEEN DATE '2013-01-01' AND DATE '2013-01-31';

SELECT SUM(S.AMT), SUM(S.SD0104 * S.SD0105)
  FROM RADM.SALEDETAIL S, RADM.SALECOST C
 WHERE S.SHEETID = C.SHEETID
   AND C.SALEDATE BETWEEN DATE '2013-01-01' AND DATE '2013-01-31';
--SALEDETAIL VS RA
SELECT *
  FROM (SELECT SUBSTR(T.SD0101, 1, 6) MONTH,
               SUBSTR(T.SHOPID, 2, 2) || SUBSTR(T.SHOPID, 1, 1) ||
               SUBSTR(T.SHOPID, 4, 3) ORG_NUM,
               SUM(T.AMT)
          FROM RADM.SALEDETAIL T
         WHERE T.SD0101 BETWEEN '20110101' AND '20130430'
         GROUP BY SUBSTR(T.SD0101, 1, 6),
                  SUBSTR(T.SHOPID, 2, 2) || SUBSTR(T.SHOPID, 1, 1) ||
                  SUBSTR(T.SHOPID, 4, 3)
         ORDER BY SUBSTR(T.SHOPID, 2, 2) || SUBSTR(T.SHOPID, 1, 1) ||
                  SUBSTR(T.SHOPID, 4, 3)) S
  FULL JOIN (select SUBSTR(T.DT_WID, 2, 6) MONTH,
                    ORG.ORG_NUM,
                    --SUM(T.SLS_QTY) SLS_QTY,
                    SUM(T.SLS_AMT_LCL - T.RET_AMT_LCL) SLS_AMT_LCL
               from W_RTL_SLS_TRX_IT_LC_DY_F t, W_INT_ORG_D ORG
              WHERE T.ORG_WID = ORG.ROW_WID
                AND T.DT_WID BETWEEN '120110101000' AND '120130431000'
              GROUP BY ORG.ORG_NUM, SUBSTR(T.DT_WID, 2, 6)
              ORDER BY ORG.ORG_NUM) F
    ON S.MONTH = F.MONTH
   AND S.ORG_NUM = F.ORG_NUM;
--供应商历史销售
--BBG_RA_SUPP_SLS_REF
SELECT SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) MONTH,
       T.ORG_NUM,
       T.SUPPLIER_NUM SUPPLIER,
       SUM(T.SUPP_SALES_COST),
       SUM(T.SUPP_SALES_AMT)
  FROM RADM.BBG_RA_SUPP_SLS_REF T
 WHERE T.DAY_DT BETWEEN DATE '2012-01-01' AND DATE '2012-01-31'
 GROUP BY SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6),
          T.ORG_NUM,
          T.SUPPLIER_NUM
 ORDER BY SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6),
          T.ORG_NUM,
          T.SUPPLIER_NUM;
--SALEDETAIL
SELECT SUBSTR(TO_CHAR(SC.SDATE, 'YYYYMMDD'), 1, 6) MONTH,
       SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
       SUBSTR(SC.SHOPID, 4, 3) ORG_NUM,
       TRIM(SCI.VENDERID) SUPPLIER,
       SUM(SCI.COSTVALUE) COSTVALUE,
       SUM(SCI.SALEVALUE) SALEVALUE
  FROM RADM.SALECOST SC, RADM.SALECOSTITEM SCI
 WHERE SC.SHEETID = SCI.SHEETID
   AND SC.SDATE BETWEEN DATE '2012-01-01' AND DATE '2013-04-30'
 GROUP BY SUBSTR(TO_CHAR(SC.SDATE, 'YYYYMMDD'), 1, 6),
          SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
          SUBSTR(SC.SHOPID, 4, 3),
          TRIM(SCI.VENDERID);
--SYBASE SALEDETAIL
SELECT SUBSTR(CONVERT(VARCHAR(10), SC.SDATE, 112), 1, 6) MONTH,
       SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
       SUBSTR(SC.SHOPID, 4, 3) ORG_NUM,
       TRIM(SCI.VENDERID) SUPPLIER,
       SUM(SCI.COSTVALUE) COSTVALUE,
       SUM(SCI.SALEVALUE) SALEVALUE
  FROM SALECOST1201 SC, SALECOSTITEM1201 SCI
 WHERE SC.SHEETID = SCI.SHEETID
   AND SUBSTR(CONVERT(VARCHAR(10), SC.SDATE, 112), 1, 6) = '201201'
--AND SUBSTR(CONVERT(VARCHAR(10), SC.SDATE, 112), 1, 6) <= '201304'
 GROUP BY SUBSTR(CONVERT(VARCHAR(10), SC.SDATE, 112), 1, 6),
          SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
          SUBSTR(SC.SHOPID, 4, 3),
          TRIM(SCI.VENDERID)
 ORDER BY SUBSTR(CONVERT(VARCHAR(10), SC.SDATE, 112), 1, 6),
          SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
          SUBSTR(SC.SHOPID, 4, 3),
          TRIM(SCI.VENDERID);
--SALECOST VS RA
SELECT *
  FROM (SELECT SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) MONTH,
               T.ORG_NUM,
               T.SUPPLIER_NUM SUPPLIER,
               SUM(T.SUPP_SALES_COST),
               SUM(T.SUPP_SALES_AMT)
          FROM RADM.BBG_RA_SUPP_SLS_REF T
         WHERE T.DAY_DT BETWEEN DATE '2012-01-01' AND DATE '2013-04-30'
         GROUP BY SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6),
                  T.ORG_NUM,
                  T.SUPPLIER_NUM
         ORDER BY SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6),
                  T.ORG_NUM,
                  T.SUPPLIER_NUM) R
  FULL JOIN (SELECT SUBSTR(TO_CHAR(SC.SDATE, 'YYYYMMDD'), 1, 6) MONTH,
                    SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
                    SUBSTR(SC.SHOPID, 4, 3) ORG_NUM,
                    TRIM(SCI.VENDERID) SUPPLIER,
                    SUM(SCI.COSTVALUE) COSTVALUE,
                    SUM(SCI.SALEVALUE) SALEVALUE
               FROM RADM.SALECOST SC, RADM.SALECOSTITEM SCI
              WHERE SC.SHEETID = SCI.SHEETID
                AND SC.SDATE BETWEEN DATE '2012-01-01' AND DATE
              '2013-04-30'
              GROUP BY SUBSTR(TO_CHAR(SC.SDATE, 'YYYYMMDD'), 1, 6),
                       SUBSTR(SC.SHOPID, 2, 2) || SUBSTR(SC.SHOPID, 1, 1) ||
                       SUBSTR(SC.SHOPID, 4, 3),
                       TRIM(SCI.VENDERID)) S1
    ON S1.MONTH = R.MONTH
   AND S1.ORG_NUM = R.ORG_NUM
   AND S1.SUPPLIER = R.SUPPLIER;

SELECT * FROM RADM.SALEDETAIL;
SELECT * FROM RADM.SALECOSTITEM;

SELECT DISTINCT T.DISCVALUE FROM RADM.SALECOSTITEM T;
--RA报表_全司月份销售_SQL语句，销售总额、净销售量、净销售金额
select distinct 0 as c1,
                D1.c5 as c2,
                D1.c4 as c3,
                D1.c3 - D1.c2 as c4,
                D1.c1 as c5,
                D1.c6 as c6
  from (select sum(nvl(T1026760.SLS_QTY, 0) - nvl(T1026760.RET_QTY, 0)) as c1,
               sum(nvl(T1026760.SLS_TAX_AMT_LCL, 0) -
                   nvl(T1026760.RET_TAX_AMT_LCL, 0)) as c2,
               sum(nvl(T1026760.SLS_AMT_LCL, 0) -
                   nvl(T1026760.RET_AMT_LCL, 0)) as c3,
               sum(T1026760.SLS_AMT_LCL) as c4,
               T960458.PER_NAME_MONTH as c5,
               T960458.ROW_WID as c6
          from W_MONTH_D                T960458 /* Dim_W_MONTH_D_Retail_Gregorian_Calendar */,
               W_RTL_SLS_CL_LC_MN_CUR_A T1026760 /* Fact_W_RTL_SLS_CL_LC_MN_CUR_A */
         where (T960458.ROW_WID = T1026760.MN_WID and
               T960458.PER_NAME_MONTH = '2013 / 01' and
               '2010' < T960458.CAL_YEAR)
         group by T960458.ROW_WID, T960458.PER_NAME_MONTH) D1
 order by c2;

--历史数据每月最后一天的数据重新导入。
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201305 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201304 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201303 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201302 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201301 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201212 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201211 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201210 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201209 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201208 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201207 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201206 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201205 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201204 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201203 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201202 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201201 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201112 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201111 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201110 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201109 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201108 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201107 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201106 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201105 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201104 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201103 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201102 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201101 ORDER BY DAY_DT;
--2011
SELECT '201101', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201101 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201101'
UNION ALL
SELECT '201102', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201102 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201102'
UNION ALL
SELECT '201103', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201103 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201103'
UNION ALL
SELECT '201104', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201104 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201104'
UNION ALL
SELECT '201105', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201105 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201105'
UNION ALL
SELECT '201106', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201106 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201106'
UNION ALL
SELECT '201107', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201107 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201107'
UNION ALL
SELECT '201108', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201108 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201108'
UNION ALL
SELECT '201109', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201109 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201109'
UNION ALL
SELECT '201110', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201110 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201110'
UNION ALL
SELECT '201111', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201111 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201111'
UNION ALL
SELECT '201112', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201112 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201112'
UNION ALL
--2012
SELECT '201201', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201201 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201201'
UNION ALL
SELECT '201202', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201202 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201202'
UNION ALL
SELECT '201203', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201203 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201203'
UNION ALL
SELECT '201204', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201204 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201204'
UNION ALL
SELECT '201205', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201205 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201205'
UNION ALL
SELECT '201206', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201206 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201206'
UNION ALL
SELECT '201207', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201207 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201207'
UNION ALL
SELECT '201208', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201208 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201208'
UNION ALL
SELECT '201209', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201209 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201209'
UNION ALL
SELECT '201210', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201210 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201210'
UNION ALL
SELECT '201211', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201211 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201211'
UNION ALL
SELECT '201212', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201212 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201212'
UNION ALL
--2013
SELECT '201301', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201301 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201301'
UNION ALL
SELECT '201302', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201302 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201302'
UNION ALL
SELECT '201303', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201303 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201303'
UNION ALL
SELECT '201304', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201304 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201304'
UNION ALL
SELECT '201305', SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RADM.BBG_RA_SLS_TRX_REF_201305 T
 WHERE SUBSTR(TO_CHAR(T.DAY_DT, 'YYYYMMDD'), 1, 6) <> '201305';

--Z:----------------------------------------------------------------------------------------
--修护历史销售数据，之前每个月的sls_ref源表有不是本月日前的销售数据未导入系统
--检查需要重新导入的日期
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201305 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201304 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201303 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201302 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201301 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201212 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201211 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201210 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201209 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201208 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201207 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201206 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201205 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201204 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201203 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201202 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201201 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201112 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201111 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201110 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201109 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201108 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201107 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201106 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201105 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201104 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201103 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201102 ORDER BY DAY_DT;
SELECT DISTINCT DAY_DT FROM RADM.BBG_RA_SLS_TRX_REF_201101 ORDER BY DAY_DT;
--修改历史数据源视图
SELECT COUNT(*) FROM BBG_RA_SLS_TRX_REF_V;
--检查历史数据源视图日期
SELECT DISTINCT DAY_DT FROM BBG_RA_SLS_TRX_REF_V ORDER BY DAY_DT;
--历史销售删除的存储过程：RADM.BBG_RA_DEL_SLS_DT
CALL RADM.BBG_RA_DEL_SLS_DT('120130116000');
CALL RADM.BBG_RA_DEL_SLS_DT('120130120000');
CALL RADM.BBG_RA_DEL_SLS_DT('120130129000');
CALL RADM.BBG_RA_DEL_SLS_DT('120130130000');
CALL RADM.BBG_RA_DEL_SLS_DT('120130131000');
CALL RADM.BBG_RA_DEL_SLS_DT('120121201000');
CALL RADM.BBG_RA_DEL_SLS_DT('120121220000');
--检查历史销售是否删除干净
SELECT * FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_F T WHERE T.DT_WID='120130430000';
SELECT * FROM RADM.W_RTL_SLS_IT_DY_A T WHERE T.DT_WID='120130430000';
SELECT * FROM RADM.W_RTL_SLS_SC_LC_DY_A T WHERE T.DT_WID='120130430000';
--清除日志
TRUNCATE TABLE RA_RMS.C_LOAD_DATES;
TRUNCATE TABLE RADM.C_LOAD_DATES;
--检查合计金额
--BBG_RA_SLS_TRX_REF_V
SELECT T.DAY_DT, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM BBG_RA_SLS_TRX_REF_V T
 GROUP BY T.DAY_DT
 ORDER BY T.DAY_DT;
--W_RTL_SLS_TRX_IT_LC_DY_FS
SELECT T.DAY_DT, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM W_RTL_SLS_TRX_IT_LC_DY_FS T
 GROUP BY T.DAY_DT
 ORDER BY T.DAY_DT;
--W_RTL_SLS_TRX_IT_LC_DY_F
SELECT T.DT_WID, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM W_RTL_SLS_TRX_IT_LC_DY_F T
 WHERE DT_WID BETWEEN 120130111000 AND 120130120000
 GROUP BY T.DT_WID
 ORDER BY T.DT_WID;
--W_RTL_SLS_TRX_IT_LC_DY_TMP
SELECT T.Dt_Wid, SUM(T.SLS_QTY), SUM(T.SLS_AMT_LCL)
  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
 GROUP BY T.Dt_Wid
 ORDER BY T.DT_WID;
--W_RTL_SLS_IT_LC_DY_A
SELECT T.DT_WID,SUM(T.SLS_AMT_LCL), SUM(T.SLS_QTY)
  FROM W_RTL_SLS_IT_LC_DY_A T
 WHERE T.DT_WID = 120130507000;
