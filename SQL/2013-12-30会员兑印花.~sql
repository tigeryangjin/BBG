SELECT SI.STORE,
			 DV.STORE_NAME,
			 DV.CHAIN,
			 DV.CHAIN_NAME,
			 DV.REGION,
			 DV.REGION_NAME,
			 CASE
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-10-31' AND DATE
					'2013-11-06' THEN
					1
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-07' AND DATE
					'2013-11-13' THEN
					2
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-14' AND DATE
					'2013-11-20' THEN
					3
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-21' AND DATE
					'2013-11-27' THEN
					4
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-28' AND DATE
					'2013-12-04' THEN
					5
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-12-05' AND DATE
					'2013-12-11' THEN
					6
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-12-12' AND DATE
					'2013-12-18' THEN
					7
				 WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-12-19' AND DATE
					'2013-12-25' THEN
					8
			 END AS WEEKNUM,
			 SI.ITEM,
			 V.card_no,
			 SUM(SI.QTY) Num,
			 HY.JKRQ,
			 XF.JE
	FROM SA_TRAN_ITEM SI,
			 SA_TRAN_HEAD SH,
			 KSL_VIP_TRAN_V V,
			 DISTRICT_CHAIN_V DV,
			 RADM.HYK_HYXX@RMS_RA HY,
			 (SELECT HYID, SUM(JE) JE
					FROM HYXFJL
				 WHERE CRMJZRQ BETWEEN DATE '2013-10-31' AND DATE '2013-12-25'
				 GROUP BY HYID) XF

 WHERE V.card_no = HY.HYKNO(+)
	 AND HY.HYID = XF.HYID
	 AND SI.STORE = DV.STORE
	 AND SI.ITEM IN (100844024,
									 100846759,
									 100848076,
									 100848105,
									 100848164,
									 100848261,
									 100850264,
									 100850432,
									 100850521,
									 100850580,
									 100850678,
									 100850715,
									 100850723,
									 100850731,
									 100850740,
									 100850758,
									 100850766,
									 100850774,
									 100850782,
									 100850791)
	 AND SH.DAY = SI.DAY
	 AND SH.STORE = SI.STORE
	 AND SH.TRAN_SEQ_NO = SI.TRAN_SEQ_NO
	 AND TRUNC(SH.TRAN_DATETIME) >= DATE
 '2013-10-31'
	 AND TRUNC(SH.TRAN_DATETIME) <= DATE
 '2013-12-25'
	 AND V.TRAN_NO = SH.TRAN_NO
	 AND TRUNC(SH.TRAN_DATETIME) = TRUNC(V.TRAN_DATETIME)
	 AND V.STORE = SH.STORE
	 AND V.REGISTER = SH.REGISTER
 group by SI.STORE,
					DV.STORE_NAME,
					DV.CHAIN,
					DV.CHAIN_NAME,
					DV.REGION,
					DV.REGION_NAME,
					CASE
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-10-31' AND DATE
						 '2013-11-06' THEN
						 1
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-07' AND DATE
						 '2013-11-13' THEN
						 2
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-14' AND DATE
						 '2013-11-20' THEN
						 3
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-21' AND DATE
						 '2013-11-27' THEN
						 4
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-11-28' AND DATE
						 '2013-12-04' THEN
						 5
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-12-05' AND DATE
						 '2013-12-11' THEN
						 6
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-12-12' AND DATE
						 '2013-12-18' THEN
						 7
						WHEN TRUNC(SH.TRAN_DATETIME) BETWEEN DATE '2013-12-19' AND DATE
						 '2013-12-25' THEN
						 8
					END,
					SI.ITEM,
					V.card_no
