--修改之前
MERGE /*+APPEND PARALLEL(T,12)*/
INTO RADM.JIN_RMS_RA_SUPP_SLS_CHECK T
USING (SELECT /*+PARALLEL(RMS,20) PARALLEL(RA,20)*/
        RMS.DAY_DT,
        RMS.SUPP_SALES_QTY RMS_SSQ,
        RA.SUPP_SALES_QTY RA_SSQ,
        ROUND(RMS.SUPP_SALES_QTY - RA.SUPP_SALES_QTY, 4) QTY_DIFF,
        RMS.SUPP_SALES_COST RMS_SSC,
        RA.SUPP_SALES_COST RA_SSC,
        ROUND(RMS.SUPP_SALES_COST - RA.SUPP_SALES_COST, 4) COST_DIFF,
        RMS.SUPP_SALES_AMT RMS_SSA,
        RA.SUPP_SALES_AMT RA_SSA,
        ROUND(RMS.SUPP_SALES_AMT - RA.SUPP_SALES_AMT, 4) AMT_DIFF
         FROM RMS.BBG_RA_SUPP_SALES_CHECK_FV@RA_RMS_DBLINK RMS,
              (SELECT /*+PARALLEL(T,20)*/
                TO_DATE(SUBSTR(T.DT_WID, 2, 8), 'YYYYMMDD') DAY_DT,
                SUM(T.SUPP_SALES_QTY) SUPP_SALES_QTY,
                SUM(T.SUPP_SALES_COST) SUPP_SALES_COST,
                SUM(T.SUPP_SALES_AMT) SUPP_SALES_AMT
                 FROM RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F T
                WHERE T.DT_WID =
                      '1' || TO_CHAR(SYSDATE - 1, 'YYYYMMDD') || '000'
                GROUP BY TO_DATE(SUBSTR(T.DT_WID, 2, 8), 'YYYYMMDD')) RA
        WHERE RMS.DAY_DT = RA.DAY_DT) S
ON (T.DAY_DT = S.DAY_DT)
WHEN MATCHED THEN
  UPDATE
     SET T.RMS_SSQ   = S.RMS_SSQ,
         T.RA_SSQ    = S.RA_SSQ,
         T.QTY_DIFF  = S.QTY_DIFF,
         T.RMS_SSC   = S.RMS_SSC,
         T.RA_SSC    = S.RA_SSC,
         T.COST_DIFF = S.COST_DIFF,
         T.RMS_SSA   = S.RMS_SSA,
         T.RA_SSA    = S.RA_SSA,
         T.AMT_DIFF  = S.AMT_DIFF
WHEN NOT MATCHED THEN
  INSERT
    (T.DAY_DT,
     T.RMS_SSQ,
     T.RA_SSQ,
     T.QTY_DIFF,
     T.RMS_SSC,
     T.RA_SSC,
     T.COST_DIFF,
     T.RMS_SSA,
     T.RA_SSA,
     T.AMT_DIFF)
  VALUES
    (S.DAY_DT,
     S.RMS_SSQ,
     S.RA_SSQ,
     S.QTY_DIFF,
     S.RMS_SSC,
     S.RA_SSC,
     S.COST_DIFF,
     S.RMS_SSA,
     S.RA_SSA,
     S.AMT_DIFF)


--接入金力供应商销售,修改之后
MERGE /*+APPEND PARALLEL(T,12)*/
INTO RADM.JIN_RMS_RA_SUPP_SLS_CHECK T
USING (SELECT /*+PARALLEL(RMS,20) PARALLEL(RA,20)*/
        RMS.DAY_DT,
        RMS.SOURCE,
        RMS.SUPP_SALES_QTY RMS_SSQ,
        RA.SUPP_SALES_QTY RA_SSQ,
        ROUND(RMS.SUPP_SALES_QTY - RA.SUPP_SALES_QTY, 4) QTY_DIFF,
        RMS.SUPP_SALES_COST RMS_SSC,
        RA.SUPP_SALES_COST RA_SSC,
        ROUND(RMS.SUPP_SALES_COST - RA.SUPP_SALES_COST, 4) COST_DIFF,
        RMS.SUPP_SALES_AMT RMS_SSA,
        RA.SUPP_SALES_AMT RA_SSA,
        ROUND(RMS.SUPP_SALES_AMT - RA.SUPP_SALES_AMT, 4) AMT_DIFF
         FROM RA_RMS.BBG_RA_SUPP_SALES_CHECK_FV@RA_RMS_DBLINK RMS,
              (SELECT /*+PARALLEL(T,20)*/
                TO_DATE(SUBSTR(T.DT_WID, 2, 8), 'YYYYMMDD') DAY_DT,
                T.BBG_REFERENCE_DO2 SOURCE,
                SUM(T.SUPP_SALES_QTY) SUPP_SALES_QTY,
                SUM(T.SUPP_SALES_COST) SUPP_SALES_COST,
                SUM(T.SUPP_SALES_AMT) SUPP_SALES_AMT
                 FROM RADM.BBG_RA_SUPP_SALES_IT_LC_DY_F T
                WHERE T.DT_WID =
                      '1' || TO_CHAR(SYSDATE - 1, 'YYYYMMDD') || '000'
                GROUP BY TO_DATE(SUBSTR(T.DT_WID, 2, 8), 'YYYYMMDD'),
                         T.BBG_REFERENCE_DO2) RA
        WHERE RMS.DAY_DT = RA.DAY_DT
          AND RMS.SOURCE = RA.SOURCE) S
ON (T.DAY_DT = S.DAY_DT AND T.DATASOURCE = S.SOURCE)
WHEN MATCHED THEN
  UPDATE
     SET T.RMS_SSQ   = S.RMS_SSQ,
         T.RA_SSQ    = S.RA_SSQ,
         T.QTY_DIFF  = S.QTY_DIFF,
         T.RMS_SSC   = S.RMS_SSC,
         T.RA_SSC    = S.RA_SSC,
         T.COST_DIFF = S.COST_DIFF,
         T.RMS_SSA   = S.RMS_SSA,
         T.RA_SSA    = S.RA_SSA,
         T.AMT_DIFF  = S.AMT_DIFF
WHEN NOT MATCHED THEN
  INSERT
    (T.DAY_DT,
     T.DATASOURCE,
     T.RMS_SSQ,
     T.RA_SSQ,
     T.QTY_DIFF,
     T.RMS_SSC,
     T.RA_SSC,
     T.COST_DIFF,
     T.RMS_SSA,
     T.RA_SSA,
     T.AMT_DIFF)
  VALUES
    (S.DAY_DT,
     S.SOURCE,
     S.RMS_SSQ,
     S.RA_SSQ,
     S.QTY_DIFF,
     S.RMS_SSC,
     S.RA_SSC,
     S.COST_DIFF,
     S.RMS_SSA,
     S.RA_SSA,
     S.AMT_DIFF)
