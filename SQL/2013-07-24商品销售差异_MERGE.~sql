MERGE /*+APPEND*/
INTO RADM.BBG_RA_CUST_LC_DY_A T
USING (SELECT /*+APPEND*/
				D.ORG_WID,
				DH.ORG_LC_WID,
				DH.ORG_SCD1_WID,
				HIST.DT_WID,
				1 DATASOURCE_NUM_ID,
				HIST.ORG_NUM || '~' ||
				TO_CHAR(W_MCAL_DAY_D.MCAL_DAY_DT,
								'DD-MON-YY',
								'NLS_DATE_LANGUAGE = American') INTEGRATION_ID,
				SYSDATE,
				SYSDATE,
				HIST.BBG_CUSTOMER_COUNT
				 FROM RADM.BBG_RA_CUST_LC_DY_HIST_FV HIST,
							RABATCHER.W_INT_ORG_D_RTL_TMP  D,
							RABATCHER.W_INT_ORG_DH_RTL_TMP DH,
							RADM.W_MCAL_DAY_D
				WHERE HIST.ORG_NUM = D.ORG_NUM
					AND HIST.ORG_NUM = DH.ORG_NUM
					AND HIST.DT_WID = W_MCAL_DAY_D.ROW_WID) S
ON (T.DT_WID = S.DT_WID AND T.ORG_WID = S.ORG_WID AND T.ORG_DH_WID = S.ORG_LC_WID AND T.ORG_SCD1_WID = S.ORG_SCD1_WID)
WHEN MATCHED THEN
	UPDATE
		 SET T.Bbg_Customer_Count = S.BBG_CUSTOMER_COUNT,
				 T.W_UPDATE_DT        = SYSDATE
WHEN NOT MATCHED THEN
	INSERT
		(T.ROW_WID,
		 T.ORG_WID,
		 T.ORG_DH_WID,
		 T.ORG_SCD1_WID,
		 T.DT_WID,
		 T.DATASOURCE_NUM_ID,
		 T.INTEGRATION_ID,
		 T.W_INSERT_DT,
		 T.W_UPDATE_DT,
		 T.BBG_CUSTOMER_COUNT,
		 T.BBG_SERVICE_SATISFACTION)
	VALUES
		(RADM.BBG_RA_CUST_LC_DY_A_SEQ.NEXTVAL,
		 S.ORG_WID,
		 S.ORG_LC_WID,
		 S.ORG_SCD1_WID,
		 S.DT_WID,
		 S.DATASOURCE_NUM_ID,
		 INTEGRATION_ID,
		 SYSDATE,
		 SYSDATE,
		 S.BBG_CUSTOMER_COUNT,
		 NULL);

select * from BBG_RA_CUST_LC_DY_A t;
SELECT * FROM BBG_RA_CUST_LC_DY_HIST_FV;
