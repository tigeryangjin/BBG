update RADM.W_RTL_BCOST_IT_LC_DY_F t
   set (t.W_UPDATE_DT,
        t.BBG_ITEM_LOC_WID,
        t.BBG_ITEM_LOC_SUPP_WID,
        t.TO_DT_WID) =
       (select
        
         s.W_UPDATE_DT,
         s.BBG_ITEM_LOC_WID,
         s.BBG_ITEM_LOC_SUPP_WID,
         s.TO_DT_WID
          from (Select W_RTL_BCOST_IT_LC_DY_TMP.PROD_IT_WID PROD_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.ORG_LC_WID ORG_DH_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.SUPPLIER_WID SUPPLIER_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.DT_WID FROM_DT_WID,
                       to_number('#RA_BI.RA_BUSINESS_PREV_DT_WID') TO_DT_WID,
                       SYSDATE W_UPDATE_DT,
                       W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_WID BBG_ITEM_LOC_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_SUPP_WID BBG_ITEM_LOC_SUPP_WID
                  From RABATCHER.W_RTL_BCOST_IT_LC_DY_TMP W_RTL_BCOST_IT_LC_DY_TMP
                 where (1 = 1)
                      
                   And (W_RTL_BCOST_IT_LC_DY_TMP.ETL_THREAD_VAL =
                       #RA_BI.RA_THREAD_VAL)
                
                ) s
         where (1 = 1)
           and t.PROD_WID = s.PROD_WID
           and t.ORG_DH_WID = s.ORG_DH_WID
           and t.SUPPLIER_WID = s.SUPPLIER_WID
              
           and s.FROM_DT_WID > t.FROM_DT_WID
           and t.TO_DT_WID >= #RA_BI.RA_FUTURE_DT_WID
        
        )
 where (PROD_WID, ORG_DH_WID, SUPPLIER_WID) in
       (select PROD_WID, ORG_DH_WID, SUPPLIER_WID
          from (Select W_RTL_BCOST_IT_LC_DY_TMP.PROD_IT_WID PROD_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.ORG_LC_WID ORG_DH_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.SUPPLIER_WID SUPPLIER_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.DT_WID FROM_DT_WID,
                       to_number('#RA_BI.RA_BUSINESS_PREV_DT_WID') TO_DT_WID,
                       SYSDATE W_UPDATE_DT,
                       W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_WID BBG_ITEM_LOC_WID,
                       W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_SUPP_WID BBG_ITEM_LOC_SUPP_WID
                  From RABATCHER.W_RTL_BCOST_IT_LC_DY_TMP W_RTL_BCOST_IT_LC_DY_TMP
                 where (1 = 1)
                      
                   And (W_RTL_BCOST_IT_LC_DY_TMP.ETL_THREAD_VAL =
                       #RA_BI.RA_THREAD_VAL)
                
                ) s
         where (1 = 1)
           and t.PROD_WID = s.PROD_WID
           and t.ORG_DH_WID = s.ORG_DH_WID
           and t.SUPPLIER_WID = s.SUPPLIER_WID
              
           and s.FROM_DT_WID > t.FROM_DT_WID
           and t.TO_DT_WID >= 120160320000
        
        );
-------------------------------------------------------------------------------------------------------------------------------       
merge into RADM.W_RTL_BCOST_IT_LC_DY_F T
using (Select W_RTL_BCOST_IT_LC_DY_TMP.PROD_IT_WID PROD_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.PROD_SCD1_WID PROD_SCD1_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.ORG_WID ORG_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.ORG_LC_WID ORG_DH_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.ORG_SCD1_WID ORG_SCD1_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.SUPPLIER_WID SUPPLIER_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.DT_WID FROM_DT_WID,
              to_number('120160320000') TO_DT_WID,
              SUM(W_RTL_BCOST_IT_LC_DY_TMP.BASE_COST_AMT_LCL) BASE_COST_AMT_LCL,
              W_RTL_BCOST_IT_LC_DY_TMP.DM_RECD_STATUS DM_RECD_STATUS,
              W_RTL_BCOST_IT_LC_DY_TMP.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
              W_RTL_BCOST_IT_LC_DY_TMP.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
              W_RTL_BCOST_IT_LC_DY_TMP.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
              W_RTL_BCOST_IT_LC_DY_TMP.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT,
              -1 CHANGED_BY_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.CHANGED_ON_DT CHANGED_ON_DT,
              -1 CREATED_BY_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.CREATED_ON_DT CREATED_ON_DT,
              W_RTL_BCOST_IT_LC_DY_TMP.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
              W_RTL_BCOST_IT_LC_DY_TMP.DELETE_FLG DELETE_FLG,
              W_RTL_BCOST_IT_LC_DY_TMP.DOC_CURR_CODE DOC_CURR_CODE,
              #RA_BI.ETL_PROC_WID ETL_PROC_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.GLOBAL1_EXCHANGE_RATE GLOBAL1_EXCHANGE_RATE,
              W_RTL_BCOST_IT_LC_DY_TMP.GLOBAL2_EXCHANGE_RATE GLOBAL2_EXCHANGE_RATE,
              W_RTL_BCOST_IT_LC_DY_TMP.GLOBAL3_EXCHANGE_RATE GLOBAL3_EXCHANGE_RATE,
              W_RTL_BCOST_IT_LC_DY_TMP.PROD_IT_NUM || '~' ||
              W_RTL_BCOST_IT_LC_DY_TMP.ORG_NUM || '~' ||
              W_RTL_BCOST_IT_LC_DY_TMP.DAY_DT || '~' ||
              W_RTL_BCOST_IT_LC_DY_TMP.SUPPLIER_NUM INTEGRATION_ID,
              W_RTL_BCOST_IT_LC_DY_TMP.LOC_CURR_CODE LOC_CURR_CODE,
              W_RTL_BCOST_IT_LC_DY_TMP.LOC_EXCHANGE_RATE LOC_EXCHANGE_RATE,
              W_RTL_BCOST_IT_LC_DY_TMP.TENANT_ID TENANT_ID,
              SYSDATE W_INSERT_DT,
              SYSDATE W_UPDATE_DT,
              W_RTL_BCOST_IT_LC_DY_TMP.X_CUSTOM X_CUSTOM,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_WID BBG_ITEM_LOC_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_SUPP_WID BBG_ITEM_LOC_SUPP_WID,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO1 BBG_REFERENCE_DO1,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO2 BBG_REFERENCE_DO2,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO3 BBG_REFERENCE_DO3,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO4 BBG_REFERENCE_DO4,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO5 BBG_REFERENCE_DO5,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO1 BBG_REFERENCE_FO1,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO2 BBG_REFERENCE_FO2,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO3 BBG_REFERENCE_FO3,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO4 BBG_REFERENCE_FO4,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO5 BBG_REFERENCE_FO5,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO6 BBG_REFERENCE_FO6,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO7 BBG_REFERENCE_FO7,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO8 BBG_REFERENCE_FO8,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO9 BBG_REFERENCE_FO9,
              W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO10 BBG_REFERENCE_FO10
       
         From RABATCHER.W_RTL_BCOST_IT_LC_DY_TMP W_RTL_BCOST_IT_LC_DY_TMP
        Where (1 = 1)
             
          And (W_RTL_BCOST_IT_LC_DY_TMP.ETL_THREAD_VAL =
              #RA_BI.RA_THREAD_VAL)
        Group By W_RTL_BCOST_IT_LC_DY_TMP.PROD_IT_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.PROD_SCD1_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.ORG_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.ORG_LC_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.ORG_SCD1_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.SUPPLIER_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.DT_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.DM_RECD_STATUS,
                 W_RTL_BCOST_IT_LC_DY_TMP.AUX1_CHANGED_ON_DT,
                 W_RTL_BCOST_IT_LC_DY_TMP.AUX2_CHANGED_ON_DT,
                 W_RTL_BCOST_IT_LC_DY_TMP.AUX3_CHANGED_ON_DT,
                 W_RTL_BCOST_IT_LC_DY_TMP.AUX4_CHANGED_ON_DT,
                 W_RTL_BCOST_IT_LC_DY_TMP.CHANGED_ON_DT,
                 W_RTL_BCOST_IT_LC_DY_TMP.CREATED_ON_DT,
                 W_RTL_BCOST_IT_LC_DY_TMP.DATASOURCE_NUM_ID,
                 W_RTL_BCOST_IT_LC_DY_TMP.DELETE_FLG,
                 W_RTL_BCOST_IT_LC_DY_TMP.DOC_CURR_CODE,
                 W_RTL_BCOST_IT_LC_DY_TMP.GLOBAL1_EXCHANGE_RATE,
                 W_RTL_BCOST_IT_LC_DY_TMP.GLOBAL2_EXCHANGE_RATE,
                 W_RTL_BCOST_IT_LC_DY_TMP.GLOBAL3_EXCHANGE_RATE,
                 W_RTL_BCOST_IT_LC_DY_TMP.PROD_IT_NUM || '~' ||
                 W_RTL_BCOST_IT_LC_DY_TMP.ORG_NUM || '~' ||
                 W_RTL_BCOST_IT_LC_DY_TMP.DAY_DT || '~' ||
                 W_RTL_BCOST_IT_LC_DY_TMP.SUPPLIER_NUM,
                 W_RTL_BCOST_IT_LC_DY_TMP.LOC_CURR_CODE,
                 W_RTL_BCOST_IT_LC_DY_TMP.LOC_EXCHANGE_RATE,
                 W_RTL_BCOST_IT_LC_DY_TMP.TENANT_ID,
                 W_RTL_BCOST_IT_LC_DY_TMP.X_CUSTOM,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_ITEM_LOC_SUPP_WID,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO1,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO2,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO3,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO4,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_DO5,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO1,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO2,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO3,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO4,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO5,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO6,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO7,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO8,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO9,
                 W_RTL_BCOST_IT_LC_DY_TMP.BBG_REFERENCE_FO10
       
       ) S
on (T.PROD_WID = S.PROD_WID and T.ORG_WID = S.ORG_WID and T.SUPPLIER_WID = S.SUPPLIER_WID and T.FROM_DT_WID = S.FROM_DT_WID)
when matched then
  update
     set T.PROD_SCD1_WID         = S.PROD_SCD1_WID,
         T.ORG_DH_WID            = S.ORG_DH_WID,
         T.ORG_SCD1_WID          = S.ORG_SCD1_WID,
         T.TO_DT_WID             = S.TO_DT_WID,
         T.BASE_COST_AMT_LCL     = S.BASE_COST_AMT_LCL,
         T.DM_RECD_STATUS        = S.DM_RECD_STATUS,
         T.AUX1_CHANGED_ON_DT    = S.AUX1_CHANGED_ON_DT,
         T.AUX2_CHANGED_ON_DT    = S.AUX2_CHANGED_ON_DT,
         T.AUX3_CHANGED_ON_DT    = S.AUX3_CHANGED_ON_DT,
         T.AUX4_CHANGED_ON_DT    = S.AUX4_CHANGED_ON_DT,
         T.CHANGED_BY_WID        = S.CHANGED_BY_WID,
         T.CHANGED_ON_DT         = S.CHANGED_ON_DT,
         T.CREATED_BY_WID        = S.CREATED_BY_WID,
         T.CREATED_ON_DT         = S.CREATED_ON_DT,
         T.DATASOURCE_NUM_ID     = S.DATASOURCE_NUM_ID,
         T.DELETE_FLG            = S.DELETE_FLG,
         T.DOC_CURR_CODE         = S.DOC_CURR_CODE,
         T.ETL_PROC_WID          = S.ETL_PROC_WID,
         T.GLOBAL1_EXCHANGE_RATE = S.GLOBAL1_EXCHANGE_RATE,
         T.GLOBAL2_EXCHANGE_RATE = S.GLOBAL2_EXCHANGE_RATE,
         T.GLOBAL3_EXCHANGE_RATE = S.GLOBAL3_EXCHANGE_RATE,
         T.INTEGRATION_ID        = S.INTEGRATION_ID,
         T.LOC_CURR_CODE         = S.LOC_CURR_CODE,
         T.LOC_EXCHANGE_RATE     = S.LOC_EXCHANGE_RATE,
         T.TENANT_ID             = S.TENANT_ID,
         T.W_INSERT_DT           = S.W_INSERT_DT,
         T.W_UPDATE_DT           = S.W_UPDATE_DT,
         T.X_CUSTOM              = S.X_CUSTOM,
         T.BBG_ITEM_LOC_WID      = S.BBG_ITEM_LOC_WID,
         T.BBG_ITEM_LOC_SUPP_WID = S.BBG_ITEM_LOC_SUPP_WID,
         T.BBG_REFERENCE_DO1     = S.BBG_REFERENCE_DO1,
         T.BBG_REFERENCE_DO2     = S.BBG_REFERENCE_DO2,
         T.BBG_REFERENCE_DO3     = S.BBG_REFERENCE_DO3,
         T.BBG_REFERENCE_DO4     = S.BBG_REFERENCE_DO4,
         T.BBG_REFERENCE_DO5     = S.BBG_REFERENCE_DO5,
         T.BBG_REFERENCE_FO1     = S.BBG_REFERENCE_FO1,
         T.BBG_REFERENCE_FO2     = S.BBG_REFERENCE_FO2,
         T.BBG_REFERENCE_FO3     = S.BBG_REFERENCE_FO3,
         T.BBG_REFERENCE_FO4     = S.BBG_REFERENCE_FO4,
         T.BBG_REFERENCE_FO5     = S.BBG_REFERENCE_FO5,
         T.BBG_REFERENCE_FO6     = S.BBG_REFERENCE_FO6,
         T.BBG_REFERENCE_FO7     = S.BBG_REFERENCE_FO7,
         T.BBG_REFERENCE_FO8     = S.BBG_REFERENCE_FO8,
         T.BBG_REFERENCE_FO9     = S.BBG_REFERENCE_FO9,
         T.BBG_REFERENCE_FO10    = S.BBG_REFERENCE_FO10
  

when not matched then
  insert
    (
     
     T.ROW_WID,
     T.PROD_WID,
     T.PROD_SCD1_WID,
     T.ORG_WID,
     T.ORG_DH_WID,
     T.ORG_SCD1_WID,
     T.SUPPLIER_WID,
     T.FROM_DT_WID,
     T.TO_DT_WID,
     T.BASE_COST_AMT_LCL,
     T.DM_RECD_STATUS,
     T.AUX1_CHANGED_ON_DT,
     T.AUX2_CHANGED_ON_DT,
     T.AUX3_CHANGED_ON_DT,
     T.AUX4_CHANGED_ON_DT,
     T.CHANGED_BY_WID,
     T.CHANGED_ON_DT,
     T.CREATED_BY_WID,
     T.CREATED_ON_DT,
     T.DATASOURCE_NUM_ID,
     T.DELETE_FLG,
     T.DOC_CURR_CODE,
     T.ETL_PROC_WID,
     T.GLOBAL1_EXCHANGE_RATE,
     T.GLOBAL2_EXCHANGE_RATE,
     T.GLOBAL3_EXCHANGE_RATE,
     T.INTEGRATION_ID,
     T.LOC_CURR_CODE,
     T.LOC_EXCHANGE_RATE,
     T.TENANT_ID,
     T.W_INSERT_DT,
     T.W_UPDATE_DT,
     T.X_CUSTOM,
     T.BBG_ITEM_LOC_WID,
     T.BBG_ITEM_LOC_SUPP_WID,
     T.BBG_REFERENCE_DO1,
     T.BBG_REFERENCE_DO2,
     T.BBG_REFERENCE_DO3,
     T.BBG_REFERENCE_DO4,
     T.BBG_REFERENCE_DO5,
     T.BBG_REFERENCE_FO1,
     T.BBG_REFERENCE_FO2,
     T.BBG_REFERENCE_FO3,
     T.BBG_REFERENCE_FO4,
     T.BBG_REFERENCE_FO5,
     T.BBG_REFERENCE_FO6,
     T.BBG_REFERENCE_FO7,
     T.BBG_REFERENCE_FO8,
     T.BBG_REFERENCE_FO9,
     T.BBG_REFERENCE_FO10
     
     )
  values
    (
     
     RADM.W_RTL_BCOST_IT_LC_DY_F_SEQ.NEXTVAL,
     S.PROD_WID,
     S.PROD_SCD1_WID,
     S.ORG_WID,
     S.ORG_DH_WID,
     S.ORG_SCD1_WID,
     S.SUPPLIER_WID,
     S.FROM_DT_WID,
     S.TO_DT_WID,
     S.BASE_COST_AMT_LCL,
     S.DM_RECD_STATUS,
     S.AUX1_CHANGED_ON_DT,
     S.AUX2_CHANGED_ON_DT,
     S.AUX3_CHANGED_ON_DT,
     S.AUX4_CHANGED_ON_DT,
     S.CHANGED_BY_WID,
     S.CHANGED_ON_DT,
     S.CREATED_BY_WID,
     S.CREATED_ON_DT,
     S.DATASOURCE_NUM_ID,
     S.DELETE_FLG,
     S.DOC_CURR_CODE,
     S.ETL_PROC_WID,
     S.GLOBAL1_EXCHANGE_RATE,
     S.GLOBAL2_EXCHANGE_RATE,
     S.GLOBAL3_EXCHANGE_RATE,
     S.INTEGRATION_ID,
     S.LOC_CURR_CODE,
     S.LOC_EXCHANGE_RATE,
     S.TENANT_ID,
     S.W_INSERT_DT,
     S.W_UPDATE_DT,
     S.X_CUSTOM,
     S.BBG_ITEM_LOC_WID,
     S.BBG_ITEM_LOC_SUPP_WID,
     S.BBG_REFERENCE_DO1,
     S.BBG_REFERENCE_DO2,
     S.BBG_REFERENCE_DO3,
     S.BBG_REFERENCE_DO4,
     S.BBG_REFERENCE_DO5,
     S.BBG_REFERENCE_FO1,
     S.BBG_REFERENCE_FO2,
     S.BBG_REFERENCE_FO3,
     S.BBG_REFERENCE_FO4,
     S.BBG_REFERENCE_FO5,
     S.BBG_REFERENCE_FO6,
     S.BBG_REFERENCE_FO7,
     S.BBG_REFERENCE_FO8,
     S.BBG_REFERENCE_FO9,
     S.BBG_REFERENCE_FO10
     
     );
