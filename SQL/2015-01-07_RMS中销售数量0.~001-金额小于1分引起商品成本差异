SELECT /*+PARALLEL(T,20)*/
 *
  FROM TRAN_DATA_HISTORY T
 WHERE T.TRAN_CODE IN (2, 3)
   AND T.TRAN_DATE > DATE '2014-01-01'
   AND ABS(T.UNITS) = 0.001
   AND ABS(T.TOTAL_RETAIL) < 0.01;

SELECT /*+PARALLEL(T,20)*/
 *
  FROM TRAN_DATA_HISTORY T
 WHERE T.TRAN_CODE IN (2, 3)
   AND T.TRAN_DATE = DATE '2014-11-6'
   AND T.ITEM = '800338380'
   AND T.LOCATION = '120023';

SELECT /*+PARALLEL(A,20)*/
 A.TRAN_DATE,
 A.ITEM,
 A.LOCATION,
 A.TRAN_CODE,
 SUM(A.UNITS) UNITS,
 SUM(A.TOTAL_COST) TOTAL_COST,
 AVG(A.TOTAL_COST / A.UNITS) * SUM(A.UNITS) TOTAL_AVG_COST,
 AVG(A.TOTAL_COST / A.UNITS) * SUM(A.UNITS) - SUM(A.TOTAL_COST) DIFF
  FROM TRAN_DATA_HISTORY A
 WHERE EXISTS
 (SELECT /*+PARALLEL(T,20)*/
         1
          FROM TRAN_DATA_HISTORY B
         WHERE B.TRAN_CODE IN (2, 3)
           AND B.TRAN_DATE > DATE '2014-01-01'
           AND ABS(B.UNITS) = 0.001
           AND ABS(B.TOTAL_RETAIL) < 0.01
           AND A.ITEM = B.ITEM
           AND A.LOCATION = B.LOCATION
           AND A.TRAN_DATE = B.TRAN_DATE
           AND A.TRAN_CODE = B.TRAN_CODE)
 GROUP BY A.ITEM, A.LOCATION, A.TRAN_DATE, A.TRAN_CODE;
