CREATE TABLE RADM.INV_DT_WID AS
SELECT SUBSTR(V.DT_WID, 2, 6) MONTH, MAX(V.DT_WID) DT_WID
  FROM W_RTL_INV_IT_LC_DY_FV V
 WHERE V.DT_WID >= 120120101000
   AND V.DT_WID <= 120130430000
 GROUP BY SUBSTR(V.DT_WID, 2, 6);


SELECT SUBSTR(V.DT_WID, 2, 6) MONTH,
       O.ORG_NUM LOC,
       T.PROD_DP_NUM DEPT,
       SUM(V.INV_SOH_QTY) SOH_QTY,
       SUM(V.INV_SOH_COST_AMT_LCL) SOH_AMT
  FROM W_RTL_INV_IT_LC_DY_FV         V,
       RABATCHER.W_PRODUCT_D_RTL_TMP T,
       RABATCHER.W_INT_ORG_D_RTL_TMP O
 WHERE /*V.DT_WID >= 120120131000
   AND V.DT_WID <= 120130501000
   AND*/
 V.PROD_WID = T.PROD_IT_WID
 AND V.ORG_WID = O.ORG_WID
 AND EXISTS (SELECT 1
    FROM (SELECT MONTH,DT_WID
            FROM inv_dt_wid V
           ) A
   WHERE A.DT_WID = V.DT_WID)
   GROUP BY SUBSTR(V.DT_WID, 2, 6),
       O.ORG_NUM,
       T.PROD_DP_NUM;

--------------------------------------------------------------------------------------------------------------
SELECT SUBSTR(V.DT_WID, 2, 6), MAX(V.DT_WID)
  FROM W_RTL_INV_IT_LC_DY_FV V
 WHERE V.DT_WID >= 120120131000
   AND V.DT_WID <= 120130501000
 GROUP BY SUBSTR(V.DT_WID, 2, 6);
--------------------------------------------------------------------------------------------------------------
SELECT SUBSTR(V.DT_WID, 2, 6) MONTH,
       T.PROD_DP_NUM DEPT,
       SUM(V.INV_SOH_QTY) SOH_QTY,
       SUM(V.INV_SOH_COST_AMT_LCL) SOH_AMT
  FROM W_RTL_INV_IT_LC_DY_FV V, RABATCHER.W_PRODUCT_D_RTL_TMP T
 WHERE V.DT_WID >= 120120131000
   AND V.DT_WID <= 120130501000
   AND V.PROD_WID = T.PROD_IT_WID
 GROUP BY SUBSTR(V.DT_WID, 2, 6), T.PROD_DP_NUM
 ORDER BY SUBSTR(V.DT_WID, 2, 6), T.PROD_DP_NUM;
