--2017/01/07
--item:2400070030474,2400070030478,2400070072681,2400070072682,2400070072683,2400070072684,2400070072696,2400070072697,2400070072701,
-- 2400070072707 loc:130040
--1.
SELECT *
  FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS A
 WHERE NOT EXISTS (SELECT /*+PARALLEL(16)*/
         1
          FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP B
         WHERE A.ORG_NUM = B.ORG_NUM
           AND A.PROD_IT_NUM = B.PROD_IT_NUM);

--2.
SELECT *
  FROM RADM.BBG_RA_ITEM_LOC_D T
 WHERE T.ITEM IN (2400070030474,
                  2400070030478,
                  2400070072681,
                  2400070072682,
                  2400070072683,
                  2400070072684,
                  2400070072696,
                  2400070072697,
                  2400070072701,
                  2400070072707)
   AND T.LOC = 130040;




--3.item sales
--3.1
TRUNCATE TABLE RADM.W_RTL_SLS_TRX_IT_LC_DY_FS_BAK;

INSERT INTO RADM.W_RTL_SLS_TRX_IT_LC_DY_FS_BAK
SELECT * FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS;
COMMIT;

DELETE RADM.W_RTL_SLS_TRX_IT_LC_DY_FS T
 WHERE NVL(T.BBG_SERVICE_SATISFACTION, 0) <> 3.5;
COMMIT;

DELETE RADM.W_RTL_SLS_TRX_IT_LC_DY_FS T
 WHERE (T.ORG_NUM, T.PROD_IT_NUM) NOT IN
       (SELECT A.ORG_NUM, A.PROD_IT_NUM
          FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS A
         WHERE NOT EXISTS (SELECT /*+PARALLEL(16)*/
                 1
                  FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP B
                 WHERE A.ORG_NUM = B.ORG_NUM
                   AND A.PROD_IT_NUM = B.PROD_IT_NUM));
COMMIT;

UPDATE RADM.W_RTL_SLS_TRX_IT_LC_DY_FS T SET T.ETL_THREAD_VAL=1;
COMMIT;

--3.2.SIL
TRUNCATE TABLE RADM.C_LOAD_DATES;
SELECT * FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS;
SELECT * FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP;

--4.supp sales
--4.1
TRUNCATE TABLE RADM.BBG_RA_SLS_IT_LC_DY_FS_BAK;

INSERT INTO RADM.BBG_RA_SLS_IT_LC_DY_FS_BAK
  SELECT * FROM BBG_RA_SLS_IT_LC_DY_FS;
COMMIT;

SELECT *
  FROM RADM.BBG_RA_SLS_IT_LC_DY_FS T
 WHERE T.ORG_NUM = 130040
   AND T.PROD_IT_NUM IN (2400070030474,
                         2400070030478,
                         2400070072681,
                         2400070072682,
                         2400070072683,
                         2400070072684,
                         2400070072696,
                         2400070072697,
                         2400070072701,
                         2400070072707);
												 
SELECT *
  FROM RABATCHER. T
 WHERE T.ORG_NUM = 130040
   AND T.PROD_IT_NUM IN (2400070030474,
                         2400070030478,
                         2400070072681,
                         2400070072682,
                         2400070072683,
                         2400070072684,
                         2400070072696,
                         2400070072697,
                         2400070072701,
                         2400070072707);

DELETE RADM.BBG_RA_SLS_IT_LC_DY_FS A
 WHERE (A.DAY_DT, A.ORG_NUM, A.PROD_IT_NUM) NOT IN
       (SELECT B.DAY_DT, B.ORG_NUM, B.PROD_IT_NUM
          FROM RADM.W_RTL_SLS_TRX_IT_LC_DY_FS B);
COMMIT;

CREATE TABLE RADM.BBG_RA_SLS_IT_LC_DY_FS_0107 AS
SELECT * FROM RADM.BBG_RA_SLS_IT_LC_DY_FS;

UPDATE RADM.BBG_RA_SLS_IT_LC_DY_FS_0107 T SET T.ETL_THREAD_VAL=1;
COMMIT;

TRUNCATE TABLE RADM.BBG_RA_SLS_IT_LC_DY_FS;

INSERT INTO RADM.BBG_RA_SLS_IT_LC_DY_FS
SELECT * FROM RADM.BBG_RA_SLS_IT_LC_DY_FS_0107;

--4.2


--4.3.SUPP SIL
TRUNCATE TABLE RADM.C_LOAD_DATES;
SELECT * FROM RABATCHER.BBG_RA_SUPP_SLS_IT_LC_DY_TMP;
--5.
