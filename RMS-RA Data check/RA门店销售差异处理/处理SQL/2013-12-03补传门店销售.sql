--RMS下运行
TRUNCATE TABLE RA_RMS.BBG_XTERN_RDWT;
--2013年12月2日差异处理
--插入临时表
CREATE TABLE  RA_RMS.BBG_XTERN_RDWT_20131202 AS
SELECT * FROM RA_RMS.BBG_XTERN_RDWT_HIST T WHERE T.BUSINESS_DT='20131202' ;

--120014
INSERT INTO RA_RMS.BBG_XTERN_RDWT
SELECT * FROM RA_RMS.BBG_XTERN_RDWT_20131202 T WHERE T.BUSINESS_DT='20131202' AND T.LOCATION='0000120014' AND ITEM='800044552';
INSERT INTO RA_RMS.BBG_XTERN_RDWT
SELECT * FROM RA_RMS.BBG_XTERN_RDWT_20131202 T WHERE T.BUSINESS_DT='20131202' AND T.LOCATION='0000120014' AND ITEM='800044602';

TRUNCATE TABLE RA_RMS.C_LOAD_DATES;

--修改视图日期条件
RA_RMS.BBG_RA_ITEM_LOC_SOH_V;

--检查W_RTL_SLS_TRX_IT_LC_DY_FS
SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_FS;

TRUNCATE TABLE RADM.C_LOAD_DATES;
--检查W_RTL_SLS_TRX_IT_LC_DY_F
SELECT * FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP;


--RADM
--检查销售没有传过来的商品在RA商品维度中是否存在

SELECT * FROM W_PRODUCT_D T WHERE T.PROD_NUM IN ('100620389','100620418');
SELECT * FROM RABATCHER.W_PRODUCT_D_RTL_TMP T 
WHERE T.PROD_IT_NUM IN ('100620389','100620418') FOR UPDATE;

SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_FS;

TRUNCATE TABLE RADM.C_LOAD_DATES;
------------------------------------------------------------------------------------------------------
--2013年12月3日销售差异处理
SELECT SUM(T.SLS_AMT_LCL-T.RET_AMT_LCL) 
FROM W_RTL_SLS_TRX_IT_LC_DY_FS T WHERE T.DAY_DT=DATE'2013-12-03';
--backup sales trx
CREATE TABLE W_RTL_SLS_TRX_IT_LC_DY_FS_1203 AS
SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_FS;

SELECT * FROM W_RTL_SLS_DP_LC_DY_A T WHERE T.DT_WID='120131203000' AND T.ORG_WID=41;
SELECT * FROM W_INT_ORG_D T WHERE T.ORG_NUM='120029';
--TRX_FS OK!
SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_FS T WHERE T.DAY_DT=DATE'2013-12-03' AND T.ORG_NUM='120029';
SELECT * FROM W_RTL_SLS_TRX_IT_LC_DY_F T WHERE T.DT_WID='120131203000' AND T.ORG_WID=41;
--TRX_F OK!
SELECT 
sum(NVL(T.SLS_AMT_LCL , 0) - NVL(T.RET_AMT_LCL , 0)) - sum(NVL(T.SLS_TAX_AMT_LCL , 0) - NVL(T.RET_TAX_AMT_LCL , 0))
FROM W_RTL_SLS_TRX_IT_LC_DY_F T 
WHERE T.DT_WID='120131203000';

--W_RTL_SLS_IT_LC_DY_TMP NO!
SELECT * FROM RABATCHER.W_RTL_SLS_IT_LC_DY_TMP T WHERE T.ORG_WID=41;
--经过检查,发现W_RTL_SLS_TRX_IT_LC_DY_TMP表12月3日是全的,但是W_RTL_SLS_IT_LC_DY_TMP数据不全
--对于ODI接口为:PLP_RetailSalesITLcDyTempLoad,此场景执行成功,插入了312750行,但是实际上行数应该少了.

SELECT sum(NVL(T.SLS_AMT_LCL , 0) - NVL(T.RET_AMT_LCL , 0)) - sum(NVL(T.SLS_TAX_AMT_LCL , 0) - NVL(T.RET_TAX_AMT_LCL , 0)) 
FROM RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T;

SELECT sum(NVL(T.SLS_AMT_LCL , 0) - NVL(T.RET_AMT_LCL , 0)) - sum(NVL(T.SLS_TAX_AMT_LCL , 0) - NVL(T.RET_TAX_AMT_LCL , 0))
FROM RADM.W_RTL_SLS_IT_LC_DY_A T 
WHERE T.DT_WID='120131203000';
--重新运行UC4的PF.PLP_SALES_TRANCATION,销售翻倍了,故删除2013年12月3日的销售汇总数据
DELETE W_RTL_SLS_CL_DY_CUR_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_CL_LC_DY_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_CL_LC_DY_CUR_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_DP_DY_CUR_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_DP_LC_DY_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_DP_LC_DY_CUR_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_IT_DY_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_IT_DY_SN_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_IT_LC_DY_A T WHERE T.DT_WID='120131203000' ;--此表数据量很大，需要分批删除。
COMMIT;
DELETE W_RTL_SLS_IT_LC_DY_SN_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_LC_DY_A T WHERE T.DT_WID='120131203000' ;
COMMIT;
DELETE W_RTL_SLS_SC_DY_A T WHERE T.DT_WID='120131203000' ;--
COMMIT;
DELETE W_RTL_SLS_SC_DY_CUR_A T WHERE T.DT_WID='120131203000' ;--
COMMIT;
DELETE W_RTL_SLS_SC_LC_DY_A T WHERE T.DT_WID='120131203000' ;--
COMMIT;
DELETE W_RTL_SLS_SC_LC_DY_CUR_A T WHERE T.DT_WID='120131203000' ;--
COMMIT;
DELETE W_RTL_SLS_CUST_IT_LC_DY_F T WHERE T.DT_WID='120131203000';
COMMIT;
