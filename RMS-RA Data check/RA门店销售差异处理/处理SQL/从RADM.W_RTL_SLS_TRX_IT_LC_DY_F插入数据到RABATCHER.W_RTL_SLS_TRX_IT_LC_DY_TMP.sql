--从RADM.W_RTL_SLS_TRX_IT_LC_DY_F插入数据到RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP
--1.先从RADM.W_RTL_SLS_TRX_IT_LC_DY_F取数到RADM.W_RTL_SLS_TRX_IT_LC_DY_F_BAK
--TRUNCATE TABLE RADM.W_RTL_SLS_TRX_IT_LC_DY_F_BAK;
--TRUNCATE TABLE RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP;
INSERT INTO RADM.W_RTL_SLS_TRX_IT_LC_DY_F_BAK
  select * from W_RTL_SLS_TRX_IT_LC_DY_F t WHERE T.DT_WID = 120150512000;
COMMIT;
--2.插入数据到RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP
insert into RABATCHER.W_RTL_SLS_TRX_IT_LC_DY_TMP T
  (ORG_WID,
   ORG_LC_WID,
   ORG_DS_WID,
   ORG_RG_WID,
   ORG_AR_WID,
   ORG_CH_WID,
   ORG_NUM,
   ORG_DS_NUM,
   ORG_RG_NUM,
   ORG_AR_NUM,
   ORG_CH_NUM,
   ORG_SCD1_WID,
   PROD_SCD1_WID,
   PROD_IT_WID,
   PROD_SC_WID,
   PROD_CL_WID,
   PROD_DP_WID,
   PROD_GP_WID,
   PROD_DV_WID,
   PROD_IT_NUM,
   PROD_SC_NUM,
   PROD_CL_NUM,
   PROD_DP_NUM,
   PROD_GP_NUM,
   PROD_DV_NUM,
   SLS_TRX_ID,
   VOUCHER_ID,
   RTL_TYPE_WID,
   RTL_TYPE_CODE,
   DT_WID,
   DAY_DT,
   MIN_WID,
   MIN_NUM,
   WK_WID,
   WK_NUM,
   PR_WID,
   PR_NUM,
   QT_WID,
   QT_NUM,
   EMPLOYEE_WID,
   SLS_QTY,
   SLS_AMT_LCL,
   SLS_PROFIT_AMT_LCL,
   SLS_MANUAL_MKDN_AMT_LCL,
   SLS_MANUAL_MKUP_AMT_LCL,
   SLS_TAX_AMT_LCL,
   SLS_EMP_DISC_AMT_LCL,
   SLS_MANUAL_COUNT,
   SLS_SCAN_COUNT,
   RET_QTY,
   RET_AMT_LCL,
   RET_PROFIT_AMT_LCL,
   RET_MANUAL_MKDN_AMT_LCL,
   RET_MANUAL_MKUP_AMT_LCL,
   RET_TAX_AMT_LCL,
   RET_EMP_DISC_AMT_LCL,
   RET_MANUAL_COUNT,
   RET_SCAN_COUNT,
   DOC_CURR_CODE,
   LOC_CURR_CODE,
   LOC_EXCHANGE_RATE,
   GLOBAL1_EXCHANGE_RATE,
   GLOBAL2_EXCHANGE_RATE,
   GLOBAL3_EXCHANGE_RATE,
   CREATED_BY_ID,
   CHANGED_BY_ID,
   AUX1_CHANGED_ON_DT,
   AUX2_CHANGED_ON_DT,
   AUX3_CHANGED_ON_DT,
   AUX4_CHANGED_ON_DT,
   DELETE_FLG,
   DATASOURCE_NUM_ID,
   TENANT_ID,
   X_CUSTOM,
   ETL_THREAD_VAL,
   BBG_ITEM_LOC_WID,
   BBG_RETAIL_TYPE_ID,
   BBG_RETAIL_TYPE_WID,
   BBG_SERVICE_SATISFACTION,
   SRC_REF_NO1,
   SRC_REF_NO2,
   SRC_REF_NO3,
   SRC_REF_NO6,
   SRC_REF_NO7,
   SRC_REF_NO8,
   BBG_REFERENCE_DO1,
   BBG_REFERENCE_DO2,
   BBG_REFERENCE_DO3,
   BBG_REFERENCE_DO4,
   BBG_REFERENCE_DO5,
   BBG_REFERENCE_FO1,
   BBG_REFERENCE_FO2,
   BBG_REFERENCE_FO3,
   BBG_REFERENCE_FO4,
   BBG_REFERENCE_FO5,
   BBG_REFERENCE_FO6,
   BBG_REFERENCE_FO7,
   BBG_REFERENCE_FO8,
   BBG_REFERENCE_FO9,
   BBG_REFERENCE_FO10,
   CREATED_ON_DT,
   CHANGED_ON_DT)
  select /*+parallel(8)*/
   W_INT_ORG_D_RTL_TMP.ORG_WID,
   W_INT_ORG_DH_RTL_TMP.ORG_LC_WID,
   W_INT_ORG_DH_RTL_TMP.ORG_DS_WID,
   W_INT_ORG_DH_RTL_TMP.ORG_RG_WID,
   W_INT_ORG_DH_RTL_TMP.ORG_AR_WID,
   W_INT_ORG_DH_RTL_TMP.ORG_CH_WID,
   W_INT_ORG_DH_RTL_TMP.ORG_NUM,
   W_INT_ORG_DH_RTL_TMP.ORG_DS_NUM,
   W_INT_ORG_DH_RTL_TMP.ORG_RG_NUM,
   W_INT_ORG_DH_RTL_TMP.ORG_AR_NUM,
   W_INT_ORG_DH_RTL_TMP.ORG_CH_NUM,
   W_INT_ORG_DH_RTL_TMP.ORG_SCD1_WID,
   W_PRODUCT_D_RTL_TMP.PROD_SCD1_WID,
   W_PRODUCT_D_RTL_TMP.PROD_IT_WID,
   W_PRODUCT_D_RTL_TMP.PROD_SC_WID,
   W_PRODUCT_D_RTL_TMP.PROD_CL_WID,
   W_PRODUCT_D_RTL_TMP.PROD_DP_WID,
   W_PRODUCT_D_RTL_TMP.PROD_GP_WID,
   W_PRODUCT_D_RTL_TMP.PROD_DV_WID,
   W_PRODUCT_D_RTL_TMP.PROD_IT_NUM,
   W_PRODUCT_D_RTL_TMP.PROD_SC_NUM,
   W_PRODUCT_D_RTL_TMP.PROD_CL_NUM,
   W_PRODUCT_D_RTL_TMP.PROD_DP_NUM,
   W_PRODUCT_D_RTL_TMP.PROD_GP_NUM,
   W_PRODUCT_D_RTL_TMP.PROD_DV_NUM,
   TRX.SLS_TRX_ID,
   TRX.VOUCHER_ID,
   W_XACT_TYPE_D.ROW_WID,
   W_XACT_TYPE_D.W_XACT_TYPE_CODE,
   W_MCAL_DAY_D.ROW_WID,
   W_MCAL_DAY_D.MCAL_DAY_DT,
   TRX.Min_Wid,
   TRX.Min_Wid,
   W_MCAL_WEEK_D.ROW_WID,
   W_MCAL_WEEK_D.MCAL_YEAR || W_MCAL_WEEK_D.MCAL_WEEK,
   W_MCAL_DAY_D.MCAL_PERIOD_WID,
   W_MCAL_DAY_D.MCAL_YEAR || W_MCAL_DAY_D.MCAL_PERIOD,
   W_MCAL_DAY_D.MCAL_QTR_WID,
   W_MCAL_DAY_D.MCAL_YEAR || W_MCAL_DAY_D.MCAL_QTR,
   1,
   TRX.SLS_QTY,
   TRX.SLS_AMT_LCL,
   TRX.SLS_PROFIT_AMT_LCL,
   TRX.SLS_MANUAL_MKDN_AMT_LCL,
   TRX.SLS_MANUAL_MKUP_AMT_LCL,
   TRX.SLS_TAX_AMT_LCL,
   TRX.SLS_EMP_DISC_AMT_LCL,
   TRX.SLS_MANUAL_COUNT,
   TRX.SLS_SCAN_COUNT,
   TRX.RET_QTY,
   TRX.RET_AMT_LCL,
   TRX.RET_PROFIT_AMT_LCL,
   TRX.RET_MANUAL_MKDN_AMT_LCL,
   TRX.RET_MANUAL_MKUP_AMT_LCL,
   TRX.RET_TAX_AMT_LCL,
   TRX.RET_EMP_DISC_AMT_LCL,
   TRX.RET_MANUAL_COUNT,
   TRX.RET_SCAN_COUNT,
   TRX.DOC_CURR_CODE,
   TRX.LOC_CURR_CODE,
   NULL,
   NULL,
   NULL,
   NULL,
   TRX.CREATED_BY_WID,
   TRX.CHANGED_BY_WID,
   TRX.AUX1_CHANGED_ON_DT,
   TRX.AUX2_CHANGED_ON_DT,
   TRX.AUX3_CHANGED_ON_DT,
   TRX.AUX4_CHANGED_ON_DT,
   TRX.DELETE_FLG,
   TRX.DATASOURCE_NUM_ID,
   TRX.TENANT_ID,
   TRX.X_CUSTOM,
   RESTART_LOC.THREAD_VAL,
   TRX.BBG_ITEM_LOC_WID,
   BBG_RA_RETAIL_TYPE_D.RETAIL_TYPE_ID,
   TRX.BBG_RETAIL_TYPE_WID,
   TRX.BBG_SERVICE_SATISFACTION,
   TRX.SRC_REF_NO1,
   TRX.SRC_REF_NO2,
   TRX.SRC_REF_NO3,
   TRX.SRC_REF_NO6,
   TRX.SRC_REF_NO7,
   TRX.SRC_REF_NO8,
   TRX.BBG_REFERENCE_DO1,
   TRX.BBG_REFERENCE_DO2,
   TRX.BBG_REFERENCE_DO3,
   TRX.BBG_REFERENCE_DO4,
   TRX.BBG_REFERENCE_DO5,
   TRX.BBG_REFERENCE_FO1,
   TRX.BBG_REFERENCE_FO2,
   TRX.BBG_REFERENCE_FO3,
   TRX.BBG_REFERENCE_FO4,
   TRX.BBG_REFERENCE_FO5,
   TRX.BBG_REFERENCE_FO6,
   TRX.BBG_REFERENCE_FO7,
   TRX.BBG_REFERENCE_FO8,
   TRX.BBG_REFERENCE_FO9,
   TRX.BBG_REFERENCE_FO10,
   SYSDATE,
   SYSDATE
    from RADM.W_GLOBAL_CURR_G           W_GLOBAL_CURR_G,
         RABATCHER.W_INT_ORG_DH_RTL_TMP W_INT_ORG_DH_RTL_TMP,
         RABATCHER.W_PRODUCT_D_RTL_TMP  W_PRODUCT_D_RTL_TMP,
         RADM.W_MCAL_WEEK_D             W_MCAL_WEEK_D,
         RADM.W_MCAL_DAY_D              W_MCAL_DAY_D,
         --RADM.W_EMPLOYEE_D              W_EMPLOYEE_D,
         --RADM.W_XACT_TYPE_D             W_XACT_TYPE_D,
         RADM.W_MCAL_CONTEXT_G         W_MCAL_CONTEXT_G,
         RABATCHER.W_INT_ORG_D_RTL_TMP W_INT_ORG_D_RTL_TMP,
         RADM.BBG_RA_RETAIL_TYPE_D     BBG_RA_RETAIL_TYPE_D,
         --RADM.BBG_RA_ITEM_LOC_D         BBG_RA_ITEM_LOC_D,
         --RADM.W_MINUTE_OF_DAY_D         W_MINUTE_OF_DAY_D,
         RADM.W_RTL_SLS_TRX_IT_LC_DY_F_BAK   TRX,
         RA_RMS.RA_RESTART_LOC@RA_RMS_DBLINK RESTART_LOC,
         RADM.W_XACT_TYPE_D                  W_XACT_TYPE_D
   where BBG_RA_RETAIL_TYPE_D.ROW_WID = TRX.BBG_RETAIL_TYPE_WID
     AND RESTART_LOC.SCENARIO_NAME = 'SDE_BBG_RETAIL_SALESTRANSACTIONFACT'
     AND RESTART_LOC.DRIVER_VALUE = W_INT_ORG_D_RTL_TMP.ORG_NUM
     AND W_INT_ORG_D_RTL_TMP.ORG_WID = TRX.ORG_WID
     AND W_MCAL_DAY_D.ROW_WID = TRX.DT_WID
     AND W_MCAL_WEEK_D.MCAL_CAL_WID = W_MCAL_CONTEXT_G.MCAL_CAL_WID
     AND TRX.DT_WID BETWEEN
         '1' || TO_CHAR(W_MCAL_WEEK_D.MCAL_WEEK_START_DT, 'YYYYMMDD') ||
         '000' AND
         '1' || TO_CHAR(W_MCAL_WEEK_D.MCAL_WEEK_END_DT, 'YYYYMMDD') ||
         '000'
     AND TRX.DATASOURCE_NUM_ID = W_MCAL_CONTEXT_G.Datasource_Num_Id
     and TRX.DATASOURCE_NUM_ID = W_GLOBAL_CURR_G.Datasource_Num_Id
     AND W_XACT_TYPE_D.DATASOURCE_NUM_ID = TRX.DATASOURCE_NUM_ID
     AND W_XACT_TYPE_D.W_XACT_CAT_CODE = 'RETAIL_TRAN_TYPE'
     AND W_XACT_TYPE_D.ROW_WID = TRX.RTL_TYPE_WID
     AND W_PRODUCT_D_RTL_TMP.PROD_IT_WID = TRX.PROD_WID
     AND W_INT_ORG_DH_RTL_TMP.ORG_LC_WID = TRX.ORG_DH_WID;
COMMIT;
